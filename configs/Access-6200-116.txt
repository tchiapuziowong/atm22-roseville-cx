Current configuration:
!
!Version ArubaOS-CX ML.10.07.0010
!export-password: default
hostname Access-6200-116
user admin group administrators password ciphertext AQBapXHO3AM2PSoZfDOui7b8KXjn/ynj7uaB9EK5ouIs8ldUYgAAAGiQmleOSA0CCg7g4HENugtaf4ZwjNTZ5L6aVBBeX43DGMgGp67B8FtjeZtoNBR0C1YSTG5Izg5GlOzBx66FDq/VM/cpJ6JMO+5jBgO8ypmYcjkaOsmXdrQnp8gvQlqhRni2
user autobot group administrators password ciphertext AQBapeQxk+yFo1/sGoS99yuSQBxi3FW9CieHMCMGXuefW3+JYgAAAONeqNjqB0tnOGHo3WT3pWwn6hxnsQL7/jFgAiJoFJSPUXR9aA7KFOs42ZGFjpfHWHel0X8COdXLulyEDRjk3t1mqaQ5lmVuzmspe3EXO9r5qWXqUiDHOY3z5G2n8R+QdiaL
clock timezone america/los_angeles
ntp server 10.80.2.219 iburst
ntp enable
!
!
!
!
!
!
ssh server vrf default
ssh server vrf mgmt
debug portaccess all
vsf member 1 
    type jl728a
vlan 1
spanning-tree
interface mgmt
    no shutdown
    ip static 192.168.0.216/24
    default-gateway 192.168.0.1
aaa authentication port-access dot1x authenticator
    enable
aaa authentication port-access mac-auth
    enable
interface lag 220
    no shutdown
    vlan access 1
    lacp mode active
interface 1/1/1
    no shutdown
    vlan access 1
interface 1/1/2
    no shutdown
    vlan access 1
interface 1/1/3
    no shutdown
    vlan access 1
interface 1/1/4
    no shutdown
    vlan access 1
interface 1/1/5
    no shutdown
    vlan access 1
interface 1/1/6
    no shutdown
    vlan access 1
interface 1/1/7
    no shutdown
    vlan access 1
interface 1/1/8
    no shutdown
    vlan access 1
interface 1/1/9
    no shutdown
    vlan access 1
interface 1/1/10
    no shutdown
    vlan access 1
interface 1/1/11
    no shutdown
    vlan access 1
interface 1/1/12
    no shutdown
    vlan access 1
interface 1/1/13
    no shutdown
    vlan access 1
interface 1/1/14
    no shutdown
    vlan access 1
interface 1/1/15
    no shutdown
    vlan access 1
interface 1/1/16
    no shutdown
    vlan access 1
interface 1/1/17
    no shutdown
    vlan access 1
interface 1/1/18
    no shutdown
    vlan access 1
interface 1/1/19
    no shutdown
    vlan access 1
interface 1/1/20
    no shutdown
    vlan access 1
interface 1/1/21
    no shutdown
    vlan access 1
interface 1/1/22
    no shutdown
    vlan access 1
interface 1/1/23
    no shutdown
    vlan access 1
interface 1/1/24
    no shutdown
    vlan access 1
interface 1/1/25
    no shutdown
    vlan access 1
interface 1/1/26
    no shutdown
    vlan access 1
interface 1/1/27
    no shutdown
    vlan access 1
interface 1/1/28
    no shutdown
    vlan access 1
interface 1/1/29
    no shutdown
    vlan access 1
interface 1/1/30
    no shutdown
    vlan access 1
interface 1/1/31
    no shutdown
    vlan access 1
interface 1/1/32
    no shutdown
    vlan access 1
interface 1/1/33
    no shutdown
    vlan access 1
interface 1/1/34
    no shutdown
    vlan access 1
interface 1/1/35
    no shutdown
    vlan access 1
interface 1/1/36
    no shutdown
    vlan access 1
interface 1/1/37
    no shutdown
    vlan access 1
interface 1/1/38
    no shutdown
    vlan access 1
interface 1/1/39
    no shutdown
    vlan access 1
interface 1/1/40
    no shutdown
    vlan access 1
interface 1/1/41
    no shutdown
    vlan access 1
interface 1/1/42
    no shutdown
    vlan access 1
interface 1/1/43
    no shutdown
    vlan access 1
interface 1/1/44
    no shutdown
    vlan access 1
interface 1/1/45
    no shutdown
    vlan access 1
interface 1/1/46
    no shutdown
    vlan access 1
interface 1/1/47
    no shutdown
    vlan access 1
interface 1/1/48
    no shutdown
    vlan access 1
interface 1/1/49
    no shutdown
    vlan access 1
interface 1/1/50
    no shutdown
    vlan access 1
interface 1/1/51
    no shutdown
    vlan access 1
interface 1/1/52
    no shutdown
    vlan access 1
interface vlan 1
    ip dhcp
ip route 0.0.0.0/0 172.25.5.251
ip dns server-address 10.80.2.219 vrf mgmt
!
!
!
!
!
https-server vrf default
https-server vrf mgmt
nae-script hardware_device_health_monitor false IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KIwojIChjKSBDb3B5cmlnaHQgMjAxOS0yMDIwIEhld2xldHQgUGFja2FyZCBFbnRlcnByaXNlIERldmVsb3BtZW50IExQCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKIwojIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywKIyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgojICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQojIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiMgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucwojIHVuZGVyIHRoZSBMaWNlbnNlLgoKZnJvbSByZXF1ZXN0cyBpbXBvcnQgZ2V0CmltcG9ydCB1dWlkCmltcG9ydCBhc3QKCk1hbmlmZXN0ID0gewogICAgJ05hbWUnOiAnaGFyZHdhcmVfZGV2aWNlX2hlYWx0aF9tb25pdG9yJywKICAgICdEZXNjcmlwdGlvbic6ICdUaGlzIHNjcmlwdCBtb25pdG9ycyB0aGUgb3ZlcmFsbCBoYXJkd2FyZSBkZXZpY2UgaGVhbHRoLicsCiAgICAnVmVyc2lvbic6ICcxLjYnLAogICAgJ1RhcmdldFNvZnR3YXJlVmVyc2lvbic6ICcxMC4wNCcsCiAgICAnVGFncyc6IFsnZGV2aWNlJ10sCiAgICAnQXV0aG9yJzogJ0FydWJhIE5ldHdvcmtzJwp9CgpQYXJhbWV0ZXJEZWZpbml0aW9ucyA9IHsKICAgICdyeF9jcmNfZXJyX3RocmVzaG9sZCc6IHsKICAgICAgICAnTmFtZSc6ICdUaHJlc2hvbGQgZm9yIGJhZCBjYWJsZSBmYXVsdCcsCiAgICAgICAgJ0Rlc2NyaXB0aW9uJzoKICAgICAgICAgICAgJ1RocmVzaG9sZCBmb3IgcmF0aW8gb2YgcmF0ZSBvZiByeF9jcmNfZXJyIHBhY2tldHMgb3ZlciB0aW1lX2ludGVydmFsIHNlY29uZHMgdG8gcmF0ZSBvZiAnCiAgICAgICAgICAgICdnb29kIGZyYW1lcyBvdmVyIDIwIHNlY29uZHMuIEZvciBsb3cgc2Vuc2l0aXZpdHkgbGV2ZWwsIHNldCB0aHJlc2hvbGQgYXMgJwogICAgICAgICAgICAnMC4wMDM2LCBmb3IgbWVkaXVtIHNlbnNpdGl2aXR5LCBzZXQgaXMgYXMgMC4wMDIxIGFuZCBmb3IgaGlnaCBzZW5zaXRpdml0eSwgc2V0IGl0IGFzIDAuMDAwNicsCiAgICAgICAgJ1R5cGUnOiAnZmxvYXQnLAogICAgICAgICdEZWZhdWx0JzogMC4wMDA2CiAgICB9LAogICAgJ2V0aGVybmV0X2ZyYWdtZW50c190aHJlc2hvbGQnOiB7CiAgICAgICAgJ05hbWUnOiAnVGhyZXNob2xkIGZvciBiYWQgdHJhbnNjZWl2ZXIgZmF1bHQnLAogICAgICAgICdEZXNjcmlwdGlvbic6CiAgICAgICAgICAgICdUaHJlc2hvbGQgZm9yIHJhdGlvIG9mIHJhdGUgb2YgZXRoZXJuZXRfZnJhZ21lbnRzIHBhY2tldHMgb3ZlciB0aW1lX2ludGVydmFsIHNlY29uZHMgdG8gcmF0ZSBvZiAnCiAgICAgICAgICAgICdnb29kIGZyYW1lcyBvdmVyIDIwIHNlY29uZHMuIEZvciBsb3cgc2Vuc2l0aXZpdHkgbGV2ZWwsIHNldCB0aHJlc2hvbGQgYXMgJwogICAgICAgICAgICAnMC4wNDUsIGZvciBtZWRpdW0gc2Vuc2l0aXZpdHksIHNldCBpcyBhcyAwLjAzIGFuZCBmb3IgaGlnaCBzZW5zaXRpdml0eSwgc2V0IGl0IGFzIDAuMDE1JywKICAgICAgICAnVHlwZSc6ICdmbG9hdCcsCiAgICAgICAgJ0RlZmF1bHQnOiAwLjAxNQogICAgfQp9CgoKVGhyZXNob2xkcyA9IHsKICAgICdyeF9jcmNfZXJyX2xvdyc6IDAuMDAzNiwgJ3J4X2NyY19lcnJfbWVkaXVtJzogMC4wMDIxLCAncnhfY3JjX2Vycl9oaWdoJzogMC4wMDA2LAogICAgJ2ZyYWdtZW50c19sb3cnOiAwLjA0NSwgJ2ZyYWdtZW50c19tZWRpdW0nOiAwLjAzLCAnZnJhZ21lbnRzX2hpZ2gnOiAwLjAxNQp9CgoKY2xhc3MgVGVtcFNlbnNvcjoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBhZ2VudCwgYWxtKToKICAgICAgICBzZWxmLm5hbWUgPSBzZWxmLl9fY2xhc3NfXy5fX25hbWVfXwogICAgICAgIHNlbGYuYWdlbnQgPSBhZ2VudAogICAgICAgIHNlbGYuYWxtID0gYWxtCiAgICAgICAgc2VsZi5tb25pdG9ycyA9IHt9CiAgICAgICAgc2VsZi5ydWxlcyA9IHt9CiAgICAgICAgc2VsZi5ncmFwaHMgPSB7fQogICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydzZW5zb3JzX2xpc3QnXSA9ICcnCgogICAgZGVmIGNyZWF0ZV9tb25pdG9ycyhzZWxmKToKICAgICAgICB1cmlfdGVtcCA9ICcvcmVzdC92MS9zeXN0ZW0vc3Vic3lzdGVtcy8qLyovdGVtcF9zZW5zb3JzLyo/YXR0cmlidXRlcz1zdGF0dXMnCiAgICAgICAgc2VsZi5tb25pdG9yc1sndGVtcF9zZW5zb3InXSA9IE1vbml0b3IodXJpX3RlbXAsICdTZW5zb3IgU3RhdHVzJykKICAgICAgICByZXR1cm4gbGlzdChzZWxmLm1vbml0b3JzLnZhbHVlcygpKQoKICAgIGRlZiBjcmVhdGVfcnVsZXMoc2VsZik6CiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX3VuaW5pdGlhbGl6ZWQnXSA9IFJ1bGUoJ1NlbnNvciAtIFVuaW5pdGlhbGl6ZWQnKQogICAgICAgIHNlbGYucnVsZXNbJ3NlbnNvcl91bmluaXRpYWxpemVkJ10uY29uZGl0aW9uKAogICAgICAgICAgICAne30gPT0gInVuaW5pdGlhbGl6ZWQiJywgW3NlbGYubW9uaXRvcnNbJ3RlbXBfc2Vuc29yJ11dKQogICAgICAgIHNlbGYucnVsZXNbJ3NlbnNvcl91bmluaXRpYWxpemVkJ10uYWN0aW9uKAogICAgICAgICAgICBzZWxmLnNlbnNvcl9hY3Rpb25fc3RhdHVzX25vcm1hbCkKCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX25vcm1hbCddID0gUnVsZSgnU2Vuc29yIC0gTm9ybWFsJykKICAgICAgICBzZWxmLnJ1bGVzWydzZW5zb3Jfbm9ybWFsJ10uY29uZGl0aW9uKAogICAgICAgICAgICAne30gPT0gIm5vcm1hbCInLCBbc2VsZi5tb25pdG9yc1sndGVtcF9zZW5zb3InXV0pCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX25vcm1hbCddLmFjdGlvbihzZWxmLnNlbnNvcl9hY3Rpb25fc3RhdHVzX25vcm1hbCkKCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX21pbiddID0gUnVsZSgnU2Vuc29yIC0gTWluJykKICAgICAgICBzZWxmLnJ1bGVzWydzZW5zb3JfbWluJ10uY29uZGl0aW9uKAogICAgICAgICAgICAne30gPT0gIm1pbiInLCBbc2VsZi5tb25pdG9yc1sndGVtcF9zZW5zb3InXV0pCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX21pbiddLmFjdGlvbihzZWxmLnNlbnNvcl9hY3Rpb25fc3RhdHVzX25vcm1hbCkKCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX21heCddID0gUnVsZSgnU2Vuc29yIC0gTWF4JykKICAgICAgICBzZWxmLnJ1bGVzWydzZW5zb3JfbWF4J10uY29uZGl0aW9uKAogICAgICAgICAgICAne30gPT0gIm1heCInLCBbc2VsZi5tb25pdG9yc1sndGVtcF9zZW5zb3InXV0pCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX21heCddLmFjdGlvbihzZWxmLnNlbnNvcl9hY3Rpb25fc3RhdHVzX25vcm1hbCkKCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX2ZhdWx0J10gPSBSdWxlKCdTZW5zb3IgLSBGYXVsdCcpCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX2ZhdWx0J10uY29uZGl0aW9uKAogICAgICAgICAgICAne30gPT0gImZhdWx0IicsIFtzZWxmLm1vbml0b3JzWyd0ZW1wX3NlbnNvciddXSkKICAgICAgICBzZWxmLnJ1bGVzWydzZW5zb3JfZmF1bHQnXS5hY3Rpb24oc2VsZi5zZW5zb3JfYWN0aW9uX3N0YXR1c19jcml0aWNhbCkKCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX2xvd19jcml0aWNhbCddID0gUnVsZSgnU2Vuc29yIC0gTG93X0NyaXRpY2FsJykKICAgICAgICBzZWxmLnJ1bGVzWydzZW5zb3JfbG93X2NyaXRpY2FsJ10uY29uZGl0aW9uKAogICAgICAgICAgICAne30gPT0gImxvd19jcml0aWNhbCInLCBbc2VsZi5tb25pdG9yc1sndGVtcF9zZW5zb3InXV0pCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX2xvd19jcml0aWNhbCddLmFjdGlvbigKICAgICAgICAgICAgc2VsZi5zZW5zb3JfYWN0aW9uX3N0YXR1c19jcml0aWNhbCkKCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX2NyaXRpY2FsJ10gPSBSdWxlKCdTZW5zb3IgLSBDcml0aWNhbCcpCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX2NyaXRpY2FsJ10uY29uZGl0aW9uKAogICAgICAgICAgICAne30gPT0gImNyaXRpY2FsIicsIFtzZWxmLm1vbml0b3JzWyd0ZW1wX3NlbnNvciddXSkKICAgICAgICBzZWxmLnJ1bGVzWydzZW5zb3JfY3JpdGljYWwnXS5hY3Rpb24oCiAgICAgICAgICAgIHNlbGYuc2Vuc29yX2FjdGlvbl9zdGF0dXNfY3JpdGljYWwpCgogICAgICAgIHNlbGYucnVsZXNbJ3NlbnNvcl9lbWVyZ2VuY3knXSA9IFJ1bGUoJ1NlbnNvciAtIEVtZXJnZW5jeScpCiAgICAgICAgc2VsZi5ydWxlc1snc2Vuc29yX2VtZXJnZW5jeSddLmNvbmRpdGlvbigKICAgICAgICAgICAgJ3t9ID09ICJlbWVyZ2VuY3kiJywgW3NlbGYubW9uaXRvcnNbJ3RlbXBfc2Vuc29yJ11dKQogICAgICAgIHNlbGYucnVsZXNbJ3NlbnNvcl9lbWVyZ2VuY3knXS5hY3Rpb24oCiAgICAgICAgICAgIHNlbGYuc2Vuc29yX2FjdGlvbl9zdGF0dXNfY3JpdGljYWwpCiAgICAgICAgcmV0dXJuIGxpc3Qoc2VsZi5ydWxlcy52YWx1ZXMoKSkKCiAgICBkZWYgY3JlYXRlX2dyYXBocyhzZWxmKToKICAgICAgICBzZWxmLmdyYXBoc1sndGVtcF9zZW5zb3InXSA9IFwKICAgICAgICAgICAgR3JhcGgoW3ZhbCBmb3IgdmFsIGluIHNlbGYubW9uaXRvcnMudmFsdWVzKCldLAogICAgICAgICAgICAgICAgICB0aXRsZT1UaXRsZSgiU2Vuc29yIFN0YXR1cyIpLAogICAgICAgICAgICAgICAgICBkYXNoYm9hcmRfZGlzcGxheT1UcnVlKQogICAgICAgIHJldHVybiBsaXN0KHNlbGYuZ3JhcGhzLnZhbHVlcygpKQoKICAgIGRlZiBzZW5zb3JfYWN0aW9uX3N0YXR1c19jcml0aWNhbChzZWxmLCBldmVudCk6CiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoJ0xBQkVMID0gJyArIGV2ZW50WydsYWJlbHMnXSkKICAgICAgICBsYWJlbCA9IGV2ZW50WydsYWJlbHMnXQogICAgICAgIHJ1bGVfZGVzY3JpcHRpb24gPSAnVGVtcCBTZW5zb3IgU3RhdHVzJwogICAgICAgIHNlbnNvcm5hbWUgPSBsYWJlbC5zcGxpdCgnLCcpWzFdLnNwbGl0KCc9JylbMV0KICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5kZWJ1ZygnU2Vuc29yIE5hbWU9ICcgKyBzZW5zb3JuYW1lKQoKICAgICAgICBpZiBzZWxmLmFnZW50LnZhcmlhYmxlc1snc2Vuc29yc19saXN0J10gIT0gJyc6CiAgICAgICAgICAgIGZpbmRzZW5zb3IgPSBzZWxmLmFnZW50LnZhcmlhYmxlc1snc2Vuc29yc19saXN0J10KICAgICAgICAgICAgaXN0cnVlID0gZmluZHNlbnNvci5maW5kKHNlbnNvcm5hbWUpCiAgICAgICAgICAgIGlmIGlzdHJ1ZSA9PSAtMToKICAgICAgICAgICAgICAgIHNlbnNvcnNfbGlzdCA9IHNlbnNvcm5hbWUgKyBcCiAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ3NlbnNvcnNfbGlzdCddCiAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1snc2Vuc29yc19saXN0J10gPSBzZW5zb3JzX2xpc3QKICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKCdsaXN0IG9mIHNlbnNvcnM6ICAnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydzZW5zb3JzX2xpc3QnXSkKICAgICAgICAgICAgICAgIHNlbGYuc2V0X2FjdGlvbnMoc2Vuc29ybmFtZSwgcnVsZV9kZXNjcmlwdGlvbikKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1snc2Vuc29yc19saXN0J10gPSBzZW5zb3JuYW1lCiAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKCdsaXN0IG9mIHNlbnNvcnM6ICAnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ3NlbnNvcnNfbGlzdCddKQogICAgICAgICAgICBzZWxmLnNldF9hY3Rpb25zKHNlbnNvcm5hbWUsIHJ1bGVfZGVzY3JpcHRpb24pCgogICAgZGVmIHNldF9hY3Rpb25zKHNlbGYsIHNlbnNvcm5hbWUsIHJ1bGVfZGVzY3JpcHRpb24pOgogICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKCIrKysgQ0FMTEJBQ0s6IFRFTVAgU0VOU09SIFNUQVRVUyAtIENSSVRJQ0FMISIpCiAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fc3lzbG9nKAogICAgICAgICAgICAnU2Vuc29yOiAnICsgc2Vuc29ybmFtZSArICcgaXMgaW4gQ3JpdGljYWwgU3RhdGUgJykKICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9jbGkoJ3Nob3cgZW52aXJvbm1lbnQgdGVtcGVyYXR1cmUnKQogICAgICAgIHNlbGYuYWxtLnB1Ymxpc2hfYWxlcnRfbGV2ZWwoCiAgICAgICAgICAgIHNlbGYubmFtZSwgcnVsZV9kZXNjcmlwdGlvbiwgJ0NSSVRJQ0FMJykKCiAgICBkZWYgc2Vuc29yX2FjdGlvbl9zdGF0dXNfbm9ybWFsKHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5kZWJ1ZygnTEFCRUwgPSAnICsgZXZlbnRbJ2xhYmVscyddKQogICAgICAgIGxhYmVsID0gZXZlbnRbJ2xhYmVscyddCiAgICAgICAgcnVsZV9kZXNjcmlwdGlvbiA9ICdUZW1wIFNlbnNvciBTdGF0dXMnCiAgICAgICAgc2Vuc29ybmFtZSA9IGxhYmVsLnNwbGl0KCcsJylbMV0uc3BsaXQoJz0nKVsxXQoKICAgICAgICAjIGRlbGV0ZSBzZW5zb3JOYW1lIHdoaWNoIG1vdmVkIHRvIG5vcm1hbCBzdGF0ZQogICAgICAgIGluZGV4ID0gMAogICAgICAgIGxlbmd0aCA9IGxlbihzZW5zb3JuYW1lKQogICAgICAgIGZpbmRzZW5zb3IgPSBzZWxmLmFnZW50LnZhcmlhYmxlc1snc2Vuc29yc19saXN0J10KICAgICAgICBpbmRleCA9IGZpbmRzZW5zb3IuZmluZChzZW5zb3JuYW1lKQogICAgICAgIGlmIGluZGV4ICE9IC0xOgogICAgICAgICAgICBmaW5kc2Vuc29yID0gZmluZHNlbnNvclswOmluZGV4XSArIGZpbmRzZW5zb3JbaW5kZXggKyBsZW5ndGg6XQogICAgICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1snc2Vuc29yc19saXN0J10gPSBmaW5kc2Vuc29yCiAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKCdTZW5zb3IgbmFtZSBkZWxldGVkOiAnICsgc2Vuc29ybmFtZSkKICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoJ0N1cnJlbnQgc2Vuc29ycyBsaXN0OiAnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ3NlbnNvcnNfbGlzdCddKQogICAgICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9zeXNsb2coCiAgICAgICAgICAgICAgICAnU2Vuc29yICcgKyBzZW5zb3JuYW1lICsgJyBiYWNrIHRvIG5vcm1hbCcpCiAgICAgICAgICAgIGlmIHNlbGYuYWdlbnQudmFyaWFibGVzWydzZW5zb3JzX2xpc3QnXSA9PSAnJzoKICAgICAgICAgICAgICAgIHNlbGYuc2V0X2FnZW50X3N0YXR1c19ub3JtYWwocnVsZV9kZXNjcmlwdGlvbikKCiAgICBkZWYgc2V0X2FnZW50X3N0YXR1c19ub3JtYWwoc2VsZiwgcnVsZV9kZXNjcmlwdGlvbik6CiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoIisrKyBDQUxMQkFDSzogVEVNUCBTRU5TT1IgU1RBVFVTIC0gTk9STUFMISIpCiAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fc3lzbG9nKAogICAgICAgICAgICAnQWxsIHRlbXBlcmF0dXJlIHNlbnNvcnMgYXJlIGluIG5vcm1hbCBzdGF0ZScpCiAgICAgICAgc2VsZi5hbG0ucHVibGlzaF9hbGVydF9sZXZlbChzZWxmLm5hbWUsIHJ1bGVfZGVzY3JpcHRpb24sICdOT05FJykKCgpjbGFzcyBGYW46CiAgICBkZWYgX19pbml0X18oc2VsZiwgYWdlbnQsIGFsbSk6CiAgICAgICAgc2VsZi5uYW1lID0gc2VsZi5fX2NsYXNzX18uX19uYW1lX18KICAgICAgICBzZWxmLmFnZW50ID0gYWdlbnQKICAgICAgICBzZWxmLmFsbSA9IGFsbQogICAgICAgIHNlbGYubW9uaXRvcnMgPSB7fQogICAgICAgIHNlbGYucnVsZXMgPSB7fQogICAgICAgIHNlbGYuZ3JhcGhzID0ge30KICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1snZmFuc19saXN0J10gPSAnJwogICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydmYXVsdHlfZmFuc19jb3VudCddID0gJzAnCgogICAgZGVmIGNyZWF0ZV9tb25pdG9ycyhzZWxmKToKICAgICAgICB1cmlfZmFuID0gJy9yZXN0L3YxL3N5c3RlbS9zdWJzeXN0ZW1zLyovKi9mYW5zLyo/YXR0cmlidXRlcz1zdGF0dXMnCiAgICAgICAgc2VsZi5tb25pdG9yc1snZmFuJ10gPSBNb25pdG9yKHVyaV9mYW4sICdGYW4gU3RhdHVzJykKICAgICAgICByZXR1cm4gbGlzdChzZWxmLm1vbml0b3JzLnZhbHVlcygpKQoKICAgIGRlZiBjcmVhdGVfcnVsZXMoc2VsZik6CiAgICAgICAgc2VsZi5ydWxlc1snZmFuX3N0YXR1cyddID0gUnVsZSgnRmFuIFN0YXR1cycpCiAgICAgICAgc2VsZi5ydWxlc1snZmFuX3N0YXR1cyddLmNvbmRpdGlvbigKICAgICAgICAgICAgJ3t9ID09ICJmYXVsdCInLCBbc2VsZi5tb25pdG9yc1snZmFuJ11dKQogICAgICAgIHNlbGYucnVsZXNbJ2Zhbl9zdGF0dXMnXS5hY3Rpb24oc2VsZi5mYW5zX3N0YXR1c19hY3Rpb25fZmF1bHQpCiAgICAgICAgc2VsZi5ydWxlc1snZmFuX3N0YXR1cyddLmNsZWFyX2NvbmRpdGlvbigKICAgICAgICAgICAgJ3t9ID09ICJvayInLCBbc2VsZi5tb25pdG9yc1snZmFuJ11dKQogICAgICAgIHNlbGYucnVsZXNbJ2Zhbl9zdGF0dXMnXS5jbGVhcl9hY3Rpb24oCiAgICAgICAgICAgIHNlbGYuZmFuc19zdGF0dXNfYWN0aW9uX25vcm1hbCkKICAgICAgICByZXR1cm4gbGlzdChzZWxmLnJ1bGVzLnZhbHVlcygpKQoKICAgIGRlZiBjcmVhdGVfZ3JhcGhzKHNlbGYpOgogICAgICAgIHNlbGYuZ3JhcGhzWydmYW4nXSA9IFwKICAgICAgICAgICAgR3JhcGgoW3ZhbCBmb3IgdmFsIGluIHNlbGYubW9uaXRvcnMudmFsdWVzKCldLAogICAgICAgICAgICAgICAgICB0aXRsZT1UaXRsZSgiRmFuIFN0YXR1cyIpLAogICAgICAgICAgICAgICAgICBkYXNoYm9hcmRfZGlzcGxheT1GYWxzZSkKICAgICAgICByZXR1cm4gbGlzdChzZWxmLmdyYXBocy52YWx1ZXMoKSkKCiAgICBkZWYgZmFuc19zdGF0dXNfYWN0aW9uX2ZhdWx0KHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5kZWJ1ZygnTEFCRUwgPSAnICsgZXZlbnRbJ2xhYmVscyddKQogICAgICAgIGxhYmVsID0gZXZlbnRbJ2xhYmVscyddCiAgICAgICAgcnVsZV9kZXNjcmlwdGlvbiA9IGV2ZW50WydydWxlX2Rlc2NyaXB0aW9uJ10KICAgICAgICBmYW5fbmFtZSA9IGxhYmVsLnNwbGl0KCcsJylbMF0uc3BsaXQoJz0nKVsxXQoKICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5kZWJ1ZygnZmFuX25hbWU9ICcgKyBmYW5fbmFtZSkKICAgICAgICBpZiBzZWxmLmFnZW50LnZhcmlhYmxlc1snZmFuc19saXN0J10gIT0gJyc6CiAgICAgICAgICAgIGZhbnNfbGlzdCA9IGZhbl9uYW1lICsgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ2ZhbnNfbGlzdCddCiAgICAgICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydmYW5zX2xpc3QnXSA9IGZhbnNfbGlzdAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydmYW5zX2xpc3QnXSA9IGZhbl9uYW1lCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoJ2xpc3Qgb2YgZmFucyA9ICAnICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1snZmFuc19saXN0J10pCiAgICAgICAgc2VsZi5zZXRfZmFuX2FjdGlvbnMoZmFuX25hbWUsIHJ1bGVfZGVzY3JpcHRpb24pCiAgICAgICAgc2VsZi5pbmNyZW1lbnRfZmF1bHR5X2ZhbnNfY291bnQoKQoKICAgIGRlZiBpbmNyZW1lbnRfZmF1bHR5X2ZhbnNfY291bnQoc2VsZik6CiAgICAgICAgZmF1bHR5X2NvdW50ID0gaW50KHNlbGYuYWdlbnQudmFyaWFibGVzWydmYXVsdHlfZmFuc19jb3VudCddKQogICAgICAgIGZhdWx0eV9jb3VudCA9IGZhdWx0eV9jb3VudCArIDEKICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1snZmF1bHR5X2ZhbnNfY291bnQnXSA9IHN0cihmYXVsdHlfY291bnQpCiAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fc3lzbG9nKAogICAgICAgICAgICAnTnVtYmVyIG9mIGZhdWx0eSBmYW5zIGFyZSA6ICcgKyBzdHIoZmF1bHR5X2NvdW50KSkKCiAgICBkZWYgc2V0X2Zhbl9hY3Rpb25zKHNlbGYsIGZhbl9uYW1lLCBydWxlX2Rlc2NyaXB0aW9uKToKICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5kZWJ1ZygiKysrIENBTExCQUNLOiBGQU4gU1RBVFVTIC0gRkFVTFQhIikKICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9zeXNsb2coJ0ZhbiAnICsgZmFuX25hbWUgKyAnIGlzIEZhdWx0eSAnKQogICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX2NsaSgnc2hvdyBlbnZpcm9ubWVudCBmYW4nKQogICAgICAgIHNlbGYuYWxtLnB1Ymxpc2hfYWxlcnRfbGV2ZWwoCiAgICAgICAgICAgIHNlbGYubmFtZSwgcnVsZV9kZXNjcmlwdGlvbiwgJ0NSSVRJQ0FMJykKCiAgICBkZWYgZmFuc19zdGF0dXNfYWN0aW9uX25vcm1hbChzZWxmLCBldmVudCk6CiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoJ0xBQkVMID0gJyArIGV2ZW50WydsYWJlbHMnXSkKICAgICAgICBsYWJlbCA9IGV2ZW50WydsYWJlbHMnXQogICAgICAgIHJ1bGVfZGVzY3JpcHRpb24gPSBldmVudFsncnVsZV9kZXNjcmlwdGlvbiddCiAgICAgICAgZmFuX25hbWUgPSBsYWJlbC5zcGxpdCgnLCcpWzBdLnNwbGl0KCc9JylbMV0KCiAgICAgICAgIyBkZWxldGUgZmFuX25hbWUgd2hpY2ggbW92ZWQgdG8gb2sgc3RhdGUKICAgICAgICBpbmRleCA9IDAKICAgICAgICBsZW5ndGggPSBsZW4oZmFuX25hbWUpCiAgICAgICAgZmluZGZhbiA9IHNlbGYuYWdlbnQudmFyaWFibGVzWydmYW5zX2xpc3QnXQogICAgICAgIGluZGV4ID0gZmluZGZhbi5maW5kKGZhbl9uYW1lKQogICAgICAgIGlmIGluZGV4ICE9IC0xOgogICAgICAgICAgICBmaW5kZmFuID0gZmluZGZhblswOmluZGV4XSArIGZpbmRmYW5baW5kZXggKyBsZW5ndGg6XQogICAgICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1snZmFuc19saXN0J10gPSBmaW5kZmFuCiAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKCdGYW4gbmFtZSBkZWxldGVkICcgKyBmYW5fbmFtZSkKICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoJ0N1cnJlbnQgZmFucyBsaXN0ICcgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1snZmFuc19saXN0J10pCiAgICAgICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX3N5c2xvZygnRmFuICcgKyBmYW5fbmFtZSArICcgYmFjayB0byBvaycpCiAgICAgICAgICAgIGZhdWx0eV9jb3VudCA9IGludChzZWxmLmFnZW50LnZhcmlhYmxlc1snZmF1bHR5X2ZhbnNfY291bnQnXSkKICAgICAgICAgICAgZmF1bHR5X2NvdW50ID0gZmF1bHR5X2NvdW50IC0gMQogICAgICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1snZmF1bHR5X2ZhbnNfY291bnQnXSA9IHN0cihmYXVsdHlfY291bnQpCiAgICAgICAgICAgIGlmIHNlbGYuYWdlbnQudmFyaWFibGVzWydmYXVsdHlfZmFuc19jb3VudCddICE9ICcwJzoKICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX3N5c2xvZygKICAgICAgICAgICAgICAgICAgICAnUmVtYWluaW5nIGZhbnMgaW4gZmF1bHR5IHN0YXR1cyBhcmUgOiAgJyArIHN0cihmYXVsdHlfY291bnQpKQogICAgICAgICAgICBpZiBzZWxmLmFnZW50LnZhcmlhYmxlc1snZmFuc19saXN0J10gPT0gJyc6CiAgICAgICAgICAgICAgICBzZWxmLnNldF9mYW5fYWdlbnRfc3RhdHVzX25vcm1hbChydWxlX2Rlc2NyaXB0aW9uKQoKICAgIGRlZiBzZXRfZmFuX2FnZW50X3N0YXR1c19ub3JtYWwoc2VsZiwgcnVsZV9kZXNjcmlwdGlvbik6CiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoIisrKyBDQUxMQkFDSzogRkFOIFNUQVRVUyAtIE5PUk1BTCEiKQogICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX3N5c2xvZygnQWxsIGZhbnMgYXJlIGluIG5vcm1hbCBzdGF0ZScpCiAgICAgICAgc2VsZi5hbG0ucHVibGlzaF9hbGVydF9sZXZlbChzZWxmLm5hbWUsIHJ1bGVfZGVzY3JpcHRpb24sICdOT05FJykKCgpjbGFzcyBGYXVsdEZpbmRlcjoKICAgIElORklOSVRZID0gZmxvYXQoImluZiIpCgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGFnZW50LCBhbG0pOgogICAgICAgIHNlbGYubmFtZSA9IHNlbGYuX19jbGFzc19fLl9fbmFtZV9fCiAgICAgICAgc2VsZi5hZ2VudCA9IGFnZW50CiAgICAgICAgc2VsZi5hbG0gPSBhbG0KICAgICAgICBzZWxmLm1vbml0b3JzID0ge30KICAgICAgICBzZWxmLnJ1bGVzID0ge30KICAgICAgICBzZWxmLmdyYXBocyA9IHt9CiAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ2xpbmtzX3dpdGhfYWxlcnQnXSA9ICcnCgogICAgZGVmIGNyZWF0ZV9tb25pdG9ycyhzZWxmKToKICAgICAgICAjIEdvb2QgZnJhbWVzCiAgICAgICAgdXJpX2ZmMiA9ICcvcmVzdC92MS9zeXN0ZW0vaW50ZXJmYWNlcy8qP2F0dHJpYnV0ZXM9c3RhdGlzdGljcy5ldGhlcm5ldF9zdGF0c19yeF9ub19lcnJvcnMnICsgXAogICAgICAgICAgICAnJmZpbHRlcj10eXBlOnN5c3RlbScKICAgICAgICBnb29kX2ZyYW1lc191cmkgPSBSYXRlKHVyaV9mZjIsICcyMCBzZWNvbmRzJykKICAgICAgICBzZWxmLm1vbml0b3JzWydmYXVsdF9maW5kZXIyJ10gPSBNb25pdG9yKAogICAgICAgICAgICBnb29kX2ZyYW1lc191cmksICdSYXRlIG9mIGludGVyZmFjZSBnb29kIGZyYW1lcyAocGFja2V0cy9zKScpCgogICAgICAgICMgUnggQ1JDIGVycm9ycwogICAgICAgIHVyaV9mZjMgPSAnL3Jlc3QvdjEvc3lzdGVtL2ludGVyZmFjZXMvKj9hdHRyaWJ1dGVzPXN0YXRpc3RpY3MucnhfY3JjX2VycicgKyBcCiAgICAgICAgICAgICcmZmlsdGVyPXR5cGU6c3lzdGVtJwogICAgICAgIHJ4X2NyY19lcnJfdXJpID0gUmF0ZSh1cmlfZmYzLCAnMjAgc2Vjb25kcycpCiAgICAgICAgc2VsZi5tb25pdG9yc1snZmF1bHRfZmluZGVyMyddID0gTW9uaXRvcigKICAgICAgICAgICAgcnhfY3JjX2Vycl91cmksICdSYXRlIG9mIFJ4IENSQyBlcnJvciBwYWNrZXRzIChwYWNrZXRzL3MpJykKCiAgICAgICAgIyBFdGhlcm5ldCBzdGF0cyBmcmFnbWVudHMKICAgICAgICB1cmlfZmY0ID0gJy9yZXN0L3YxL3N5c3RlbS9pbnRlcmZhY2VzLyo/YXR0cmlidXRlcz1zdGF0aXN0aWNzLmV0aGVybmV0X3N0YXRzX2ZyYWdtZW50cycgKyBcCiAgICAgICAgICAgICcmZmlsdGVyPXR5cGU6c3lzdGVtJwogICAgICAgIGV0aGVybmV0X3N0YXRzX2ZyYWdtZW50c191cmkgPSBSYXRlKHVyaV9mZjQsICcyMCBzZWNvbmRzJykKICAgICAgICBzZWxmLm1vbml0b3JzWydmYXVsdF9maW5kZXI0J10gPSBNb25pdG9yKAogICAgICAgICAgICBldGhlcm5ldF9zdGF0c19mcmFnbWVudHNfdXJpLCAnUmF0ZSBvZiBldGhlcm5ldCBzdGF0cyBmcmFnbWVudHMgZXJyb3IgcGFja2V0cyAocGFja2V0cy9zKScpCiAgICAgICAgcmV0dXJuIGxpc3Qoc2VsZi5tb25pdG9ycy52YWx1ZXMoKSkKCiAgICBkZWYgY3JlYXRlX3J1bGVzKHNlbGYpOgogICAgICAgIHNlbGYucnVsZXNbJ2JhZF9jYWJsZV9mYXVsdCddID0gUnVsZSgnQmFkIGNhYmxlIGZhdWx0JykKICAgICAgICBzZWxmLnJ1bGVzWydiYWRfY2FibGVfZmF1bHQnXS5jb25kaXRpb24oCiAgICAgICAgICAgICdyYXRpbyBvZiB7fSBhbmQge30gPj0ge30nLCBbc2VsZi5tb25pdG9yc1snZmF1bHRfZmluZGVyMyddLCBzZWxmLm1vbml0b3JzWydmYXVsdF9maW5kZXIyJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5wYXJhbXNbJ3J4X2NyY19lcnJfdGhyZXNob2xkJ11dKQogICAgICAgIHNlbGYucnVsZXNbJ2JhZF9jYWJsZV9mYXVsdCddLmFjdGlvbigKICAgICAgICAgICAgc2VsZi5hY3Rpb25fcnhfY3JjX2Vycl9zZW5zaXRpdml0eSkKICAgICAgICBzZWxmLnJ1bGVzWydiYWRfY2FibGVfZmF1bHQnXS5jbGVhcl9jb25kaXRpb24oCiAgICAgICAgICAgICdyYXRpbyBvZiB7fSBhbmQge30gPCB7fScsIFtzZWxmLm1vbml0b3JzWydmYXVsdF9maW5kZXIzJ10sIHNlbGYubW9uaXRvcnNbJ2ZhdWx0X2ZpbmRlcjInXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQucGFyYW1zWydyeF9jcmNfZXJyX3RocmVzaG9sZCddXSkKICAgICAgICBzZWxmLnJ1bGVzWydiYWRfY2FibGVfZmF1bHQnXS5jbGVhcl9hY3Rpb24oCiAgICAgICAgICAgIHNlbGYuYWN0aW9uX2NsZWFyX3J4X2NyY19lcnJfc2Vuc2l0aXZpdHkpCgogICAgICAgIHNlbGYucnVsZXNbJ2JhZF90cmFuc2NlaXZlcl9mYXVsdCddID0gUnVsZSgnQmFkIHRyYW5zY2VpdmVyIGZhdWx0JykKICAgICAgICBzZWxmLnJ1bGVzWydiYWRfdHJhbnNjZWl2ZXJfZmF1bHQnXS5jb25kaXRpb24oCiAgICAgICAgICAgICdyYXRpbyBvZiB7fSBhbmQge30gPj0ge30nLCBbc2VsZi5tb25pdG9yc1snZmF1bHRfZmluZGVyNCddLCBzZWxmLm1vbml0b3JzWydmYXVsdF9maW5kZXIyJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5wYXJhbXNbJ2V0aGVybmV0X2ZyYWdtZW50c190aHJlc2hvbGQnXV0pCiAgICAgICAgc2VsZi5ydWxlc1snYmFkX3RyYW5zY2VpdmVyX2ZhdWx0J10uYWN0aW9uKAogICAgICAgICAgICBzZWxmLmFjdGlvbl9mcmFnbWVudHNfc2Vuc2l0aXZpdHkpCiAgICAgICAgc2VsZi5ydWxlc1snYmFkX3RyYW5zY2VpdmVyX2ZhdWx0J10uY2xlYXJfY29uZGl0aW9uKAogICAgICAgICAgICAncmF0aW8gb2Yge30gYW5kIHt9IDwge30nLCBbc2VsZi5tb25pdG9yc1snZmF1bHRfZmluZGVyNCddLCBzZWxmLm1vbml0b3JzWydmYXVsdF9maW5kZXIyJ10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnBhcmFtc1snZXRoZXJuZXRfZnJhZ21lbnRzX3RocmVzaG9sZCddXSkKICAgICAgICBzZWxmLnJ1bGVzWydiYWRfdHJhbnNjZWl2ZXJfZmF1bHQnXS5jbGVhcl9hY3Rpb24oCiAgICAgICAgICAgIHNlbGYuYWN0aW9uX2NsZWFyX2ZyYWdtZW50c19zZW5zaXRpdml0eSkKICAgICAgICByZXR1cm4gbGlzdChzZWxmLnJ1bGVzLnZhbHVlcygpKQoKICAgIGRlZiBjcmVhdGVfZ3JhcGhzKHNlbGYpOgogICAgICAgIHNlbGYuZ3JhcGhzWydmYXVsdF9maW5kZXInXSA9IFwKICAgICAgICAgICAgR3JhcGgoW3ZhbCBmb3IgdmFsIGluIHNlbGYubW9uaXRvcnMudmFsdWVzKCldLAogICAgICAgICAgICAgICAgICB0aXRsZT1UaXRsZSgiRmF1bHQgRmluZGVyIC0gSC9XIiksCiAgICAgICAgICAgICAgICAgIGRhc2hib2FyZF9kaXNwbGF5PUZhbHNlKQogICAgICAgIHJldHVybiBsaXN0KHNlbGYuZ3JhcGhzLnZhbHVlcygpKQoKICAgIGRlZiBnZXRfaW50ZXJmYWNlKHNlbGYsIGV2ZW50KToKICAgICAgICBsYWJlbCA9IGV2ZW50WydsYWJlbHMnXQogICAgICAgIGZpcnN0ID0gJz0nCiAgICAgICAgbGFzdCA9ICcsVGltZUludGVydmFsJwogICAgICAgIHRyeToKICAgICAgICAgICAgc3RhcnQgPSBsYWJlbC5pbmRleChmaXJzdCkgKyBsZW4oZmlyc3QpCiAgICAgICAgICAgIGVuZCA9IGxhYmVsLmluZGV4KGxhc3QsIHN0YXJ0KQogICAgICAgICAgICByZXR1cm4gbGFiZWxbc3RhcnQ6ZW5kXQogICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgYWRkX2ludGVyZmFjZV90b19hbGVydF9saXN0KHNlbGYsIGludGVyZmFjZV9pZCk6CiAgICAgICAgbGlua3Nfd2l0aF9hbGVydCA9IHNlbGYuYWdlbnQudmFyaWFibGVzWydsaW5rc193aXRoX2FsZXJ0J10gKyBcCiAgICAgICAgICAgIGludGVyZmFjZV9pZCArICc6JwogICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydsaW5rc193aXRoX2FsZXJ0J10gPSBsaW5rc193aXRoX2FsZXJ0CgogICAgZGVmIGFjdGlvbl9yeF9jcmNfZXJyX3NlbnNpdGl2aXR5KHNlbGYsIGV2ZW50KToKICAgICAgICB2YWx1ZSA9IGV2ZW50Wyd2YWx1ZSddCiAgICAgICAgdGhyZXNob2xkID0gc2VsZi5hZ2VudC5wYXJhbXNbJ3J4X2NyY19lcnJfdGhyZXNob2xkJ10udmFsdWUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlucHV0X3ZhbHVlID0gZmxvYXQodmFsdWUpCiAgICAgICAgICAgIHRocmVzaG9sZF92YWx1ZSA9IGZsb2F0KHRocmVzaG9sZCkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoIk5vdCBhIG51bWVyaWNhbCB2YWx1ZSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGlucHV0X3ZhbHVlID09IHNlbGYuSU5GSU5JVFk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGlucHV0X3ZhbHVlID49IHRocmVzaG9sZF92YWx1ZSA+PSBUaHJlc2hvbGRzWyJyeF9jcmNfZXJyX2xvdyJdOgogICAgICAgICAgICBzZWxmLmFjdGlvbl9sb3dfc2Vuc2l0aXZpdHkoZXZlbnQsIGlucHV0X3ZhbHVlKQogICAgICAgIGVsaWYgVGhyZXNob2xkc1sicnhfY3JjX2Vycl9tZWRpdW0iXSA8PSB0aHJlc2hvbGRfdmFsdWUgPCBUaHJlc2hvbGRzWyJyeF9jcmNfZXJyX2xvdyJdIFwKICAgICAgICAgICAgICAgIGFuZCBpbnB1dF92YWx1ZSA+PSB0aHJlc2hvbGRfdmFsdWU6CiAgICAgICAgICAgIHNlbGYuYWN0aW9uX21lZGl1bV9zZW5zaXRpdml0eShldmVudCwgaW5wdXRfdmFsdWUpCiAgICAgICAgZWxpZiBUaHJlc2hvbGRzWyJyeF9jcmNfZXJyX2hpZ2giXSA8PSB0aHJlc2hvbGRfdmFsdWUgPCBUaHJlc2hvbGRzWyJyeF9jcmNfZXJyX21lZGl1bSJdIFwKICAgICAgICAgICAgICAgIGFuZCBpbnB1dF92YWx1ZSA+PSB0aHJlc2hvbGRfdmFsdWU6CiAgICAgICAgICAgIHNlbGYuYWN0aW9uX2hpZ2hfc2Vuc2l0aXZpdHkoZXZlbnQsIGlucHV0X3ZhbHVlKQoKICAgIGRlZiBhY3Rpb25fY2xlYXJfcnhfY3JjX2Vycl9zZW5zaXRpdml0eShzZWxmLCBldmVudCk6CiAgICAgICAgdmFsdWUgPSBldmVudFsndmFsdWUnXQogICAgICAgIHRocmVzaG9sZCA9IHNlbGYuYWdlbnQucGFyYW1zWydyeF9jcmNfZXJyX3RocmVzaG9sZCddLnZhbHVlCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpbnB1dF92YWx1ZSA9IGZsb2F0KHZhbHVlKQogICAgICAgICAgICB0aHJlc2hvbGRfdmFsdWUgPSBmbG9hdCh0aHJlc2hvbGQpCiAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgIHByaW50KCJOb3QgYSBudW1lcmljYWwgdmFsdWUiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBpZiBpbnB1dF92YWx1ZSA8IHRocmVzaG9sZF92YWx1ZToKICAgICAgICAgICAgc2VsZi5jbGVhcl9hbGVydF9sZXZlbChldmVudCkKCiAgICBkZWYgYWN0aW9uX2ZyYWdtZW50c19zZW5zaXRpdml0eShzZWxmLCBldmVudCk6CiAgICAgICAgdmFsdWUgPSBldmVudFsndmFsdWUnXQogICAgICAgIHRocmVzaG9sZCA9IHNlbGYuYWdlbnQucGFyYW1zWydldGhlcm5ldF9mcmFnbWVudHNfdGhyZXNob2xkJ10udmFsdWUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlucHV0X3ZhbHVlID0gZmxvYXQodmFsdWUpCiAgICAgICAgICAgIHRocmVzaG9sZF92YWx1ZSA9IGZsb2F0KHRocmVzaG9sZCkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoIk5vdCBhIG51bWVyaWNhbCB2YWx1ZSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGlucHV0X3ZhbHVlID09IHNlbGYuSU5GSU5JVFk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGlucHV0X3ZhbHVlID49IHRocmVzaG9sZF92YWx1ZSA+PSBUaHJlc2hvbGRzWyJmcmFnbWVudHNfbG93Il06CiAgICAgICAgICAgIHNlbGYuYWN0aW9uX2xvd19zZW5zaXRpdml0eShldmVudCwgaW5wdXRfdmFsdWUpCiAgICAgICAgZWxpZiBUaHJlc2hvbGRzWyJmcmFnbWVudHNfbWVkaXVtIl0gPD0gdGhyZXNob2xkX3ZhbHVlIDwgVGhyZXNob2xkc1siZnJhZ21lbnRzX2xvdyJdIFwKICAgICAgICAgICAgICAgIGFuZCBpbnB1dF92YWx1ZSA+PSB0aHJlc2hvbGRfdmFsdWU6CiAgICAgICAgICAgIHNlbGYuYWN0aW9uX21lZGl1bV9zZW5zaXRpdml0eShldmVudCwgaW5wdXRfdmFsdWUpCiAgICAgICAgZWxpZiBUaHJlc2hvbGRzWyJmcmFnbWVudHNfaGlnaCJdIDw9IHRocmVzaG9sZF92YWx1ZSA8IFRocmVzaG9sZHNbImZyYWdtZW50c19tZWRpdW0iXSBcCiAgICAgICAgICAgICAgICBhbmQgaW5wdXRfdmFsdWUgPj0gdGhyZXNob2xkX3ZhbHVlOgogICAgICAgICAgICBzZWxmLmFjdGlvbl9oaWdoX3NlbnNpdGl2aXR5KGV2ZW50LCBpbnB1dF92YWx1ZSkKCiAgICBkZWYgYWN0aW9uX2NsZWFyX2ZyYWdtZW50c19zZW5zaXRpdml0eShzZWxmLCBldmVudCk6CiAgICAgICAgdmFsdWUgPSBldmVudFsndmFsdWUnXQogICAgICAgIHRocmVzaG9sZCA9IHNlbGYuYWdlbnQucGFyYW1zWydldGhlcm5ldF9mcmFnbWVudHNfdGhyZXNob2xkJ10udmFsdWUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlucHV0X3ZhbHVlID0gZmxvYXQodmFsdWUpCiAgICAgICAgICAgIHRocmVzaG9sZF92YWx1ZSA9IGZsb2F0KHRocmVzaG9sZCkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoIk5vdCBhIG51bWVyaWNhbCB2YWx1ZSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGlucHV0X3ZhbHVlIDwgdGhyZXNob2xkX3ZhbHVlOgogICAgICAgICAgICBzZWxmLmNsZWFyX2FsZXJ0X2xldmVsKGV2ZW50KQoKICAgIGRlZiBhY3Rpb25faGlnaF9zZW5zaXRpdml0eShzZWxmLCBldmVudCwgdmFsdWUpOgogICAgICAgIGludGVyZmFjZV9pZCA9IHNlbGYuZ2V0X2ludGVyZmFjZShldmVudCkKICAgICAgICBydWxlX2Rlc2NyaXB0aW9uID0gZXZlbnRbJ3J1bGVfZGVzY3JpcHRpb24nXQogICAgICAgIGxpbmtzX3dpdGhfYWxlcnQgPSBzZWxmLmFnZW50LnZhcmlhYmxlc1snbGlua3Nfd2l0aF9hbGVydCddCiAgICAgICAgaWYgKGludGVyZmFjZV9pZCArICc6Jykgbm90IGluIGxpbmtzX3dpdGhfYWxlcnQ6CiAgICAgICAgICAgIHNlbGYuYWRkX2ludGVyZmFjZV90b19hbGVydF9saXN0KGludGVyZmFjZV9pZCkKICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9zeXNsb2coJ3t9IGRldGVjdGVkIG9uIGludGVyZmFjZSB7fSBhdCBoaWdoIHNlbnNpdGl2aXR5IGxldmVsOiByYXRlIGF0IHt9IHBhY2tldHMvc2VjJy5mb3JtYXQoCiAgICAgICAgICAgIHJ1bGVfZGVzY3JpcHRpb24sIGludGVyZmFjZV9pZCwgdmFsdWUpKQogICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX2NsaSgic2hvdyBpbnRlcmZhY2Uge30iLmZvcm1hdCgKICAgICAgICAgICAgaW50ZXJmYWNlX2lkKSkKICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9jbGkoCiAgICAgICAgICAgICJzaG93IGludGVyZmFjZSB7fSBleHRlbmRlZCIuZm9ybWF0KGludGVyZmFjZV9pZCkpCiAgICAgICAgc2VsZi5hbG0ucHVibGlzaF9hbGVydF9sZXZlbCgKICAgICAgICAgICAgc2VsZi5uYW1lLCBydWxlX2Rlc2NyaXB0aW9uLCAnTUlOT1InKQoKICAgIGRlZiBhY3Rpb25fbWVkaXVtX3NlbnNpdGl2aXR5KHNlbGYsIGV2ZW50LCB2YWx1ZSk6CiAgICAgICAgaW50ZXJmYWNlX2lkID0gc2VsZi5nZXRfaW50ZXJmYWNlKGV2ZW50KQogICAgICAgIHJ1bGVfZGVzY3JpcHRpb24gPSBldmVudFsncnVsZV9kZXNjcmlwdGlvbiddCiAgICAgICAgbGlua3Nfd2l0aF9hbGVydCA9IHNlbGYuYWdlbnQudmFyaWFibGVzWydsaW5rc193aXRoX2FsZXJ0J10KICAgICAgICBpZiAoaW50ZXJmYWNlX2lkICsgJzonKSBub3QgaW4gbGlua3Nfd2l0aF9hbGVydDoKICAgICAgICAgICAgc2VsZi5hZGRfaW50ZXJmYWNlX3RvX2FsZXJ0X2xpc3QoaW50ZXJmYWNlX2lkKQogICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX3N5c2xvZygne30gZGV0ZWN0ZWQgb24gaW50ZXJmYWNlIHt9IGF0IG1lZGl1bSBzZW5zaXRpdml0eSBsZXZlbDogcmF0ZSBhdCB7fSBwYWNrZXRzL3NlYycuZm9ybWF0KAogICAgICAgICAgICBydWxlX2Rlc2NyaXB0aW9uLCBpbnRlcmZhY2VfaWQsIHZhbHVlKSkKICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9jbGkoInNob3cgaW50ZXJmYWNlIHt9Ii5mb3JtYXQoCiAgICAgICAgICAgIGludGVyZmFjZV9pZCkpCiAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fY2xpKAogICAgICAgICAgICAic2hvdyBpbnRlcmZhY2Uge30gZXh0ZW5kZWQiLmZvcm1hdChpbnRlcmZhY2VfaWQpKQogICAgICAgIHNlbGYuYWxtLnB1Ymxpc2hfYWxlcnRfbGV2ZWwoCiAgICAgICAgICAgIHNlbGYubmFtZSwgcnVsZV9kZXNjcmlwdGlvbiwgJ01BSk9SJykKCiAgICBkZWYgYWN0aW9uX2xvd19zZW5zaXRpdml0eShzZWxmLCBldmVudCwgdmFsdWUpOgogICAgICAgIGludGVyZmFjZV9pZCA9IHNlbGYuZ2V0X2ludGVyZmFjZShldmVudCkKICAgICAgICBydWxlX2Rlc2NyaXB0aW9uID0gZXZlbnRbJ3J1bGVfZGVzY3JpcHRpb24nXQogICAgICAgIGxpbmtzX3dpdGhfYWxlcnQgPSBzZWxmLmFnZW50LnZhcmlhYmxlc1snbGlua3Nfd2l0aF9hbGVydCddCiAgICAgICAgaWYgKGludGVyZmFjZV9pZCArICc6Jykgbm90IGluIGxpbmtzX3dpdGhfYWxlcnQ6CiAgICAgICAgICAgIHNlbGYuYWRkX2ludGVyZmFjZV90b19hbGVydF9saXN0KGludGVyZmFjZV9pZCkKICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9zeXNsb2coJ3t9IGRldGVjdGVkIG9uIGludGVyZmFjZSB7fSBhdCBsb3cgc2Vuc2l0aXZpdHkgbGV2ZWw6IHJhdGUgYXQge30gcGFja2V0cy9zZWMnLmZvcm1hdCgKICAgICAgICAgICAgcnVsZV9kZXNjcmlwdGlvbiwgaW50ZXJmYWNlX2lkLCB2YWx1ZSkpCiAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fY2xpKCJzaG93IGludGVyZmFjZSB7fSIuZm9ybWF0KAogICAgICAgICAgICBpbnRlcmZhY2VfaWQpKQogICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX2NsaSgKICAgICAgICAgICAgInNob3cgaW50ZXJmYWNlIHt9IGV4dGVuZGVkIi5mb3JtYXQoaW50ZXJmYWNlX2lkKSkKICAgICAgICBzZWxmLmFsbS5wdWJsaXNoX2FsZXJ0X2xldmVsKAogICAgICAgICAgICBzZWxmLm5hbWUsIHJ1bGVfZGVzY3JpcHRpb24sICdDUklUSUNBTCcpCgogICAgZGVmIGNsZWFyX2FsZXJ0X2xldmVsKHNlbGYsIGV2ZW50KToKICAgICAgICBpbnRlcmZhY2VfaWQgPSBzZWxmLmdldF9pbnRlcmZhY2UoZXZlbnQpCiAgICAgICAgcnVsZV9kZXNjcmlwdGlvbiA9IGV2ZW50WydydWxlX2Rlc2NyaXB0aW9uJ10KICAgICAgICBsaW5rc193aXRoX2FsZXJ0ID0gc2VsZi5hZ2VudC52YXJpYWJsZXNbJ2xpbmtzX3dpdGhfYWxlcnQnXQogICAgICAgIGludGVyZmFjZSA9IGludGVyZmFjZV9pZCArICc6JwogICAgICAgIGlmIGludGVyZmFjZSBpbiBsaW5rc193aXRoX2FsZXJ0OgogICAgICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9zeXNsb2coJ3t9IG9uIGludGVyZmFjZSB7fSBpcyBiYWNrIHRvIG5vcm1hbCcuZm9ybWF0KAogICAgICAgICAgICAgICAgcnVsZV9kZXNjcmlwdGlvbiwgaW50ZXJmYWNlX2lkKSkKICAgICAgICAgICAgc2VsZi5hbG0ucHVibGlzaF9hbGVydF9sZXZlbCgKICAgICAgICAgICAgICAgIHNlbGYubmFtZSwgcnVsZV9kZXNjcmlwdGlvbiwgJ05PTkUnKQoKCmNsYXNzIEFsZXJ0TWFuYWdlcjoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBhZ2VudCk6CiAgICAgICAgc2VsZi5hZ2VudCA9IGFnZW50CgogICAgZGVmIHB1Ymxpc2hfYWxlcnRfbGV2ZWwoc2VsZiwgbWV0cmljX2Rlc2MsIHJ1bGVfZGVzYywgbGV2ZWwpOgogICAgICAgIGlmICdtZXRyaWNzJyBub3QgaW4gc2VsZi5hZ2VudC52YXJpYWJsZXMua2V5cygpOgogICAgICAgICAgICBtZXRyaWNzID0ge30KICAgICAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ21ldHJpY3MnXSA9IHN0cihtZXRyaWNzKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG1ldHJpY3MgPSBkaWN0KGFzdC5saXRlcmFsX2V2YWwoc2VsZi5hZ2VudC52YXJpYWJsZXNbJ21ldHJpY3MnXSkpCgogICAgICAgIGlmIG1ldHJpY19kZXNjIG5vdCBpbiBtZXRyaWNzLmtleXMoKToKICAgICAgICAgICAgbWV0cmljc1ttZXRyaWNfZGVzY10gPSB7fQogICAgICAgIG1ldHJpY3NbbWV0cmljX2Rlc2NdW3J1bGVfZGVzY10gPSBsZXZlbAogICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydtZXRyaWNzJ10gPSBzdHIobWV0cmljcykKICAgICAgICBsZXZlbHMgPSBbXQoKICAgICAgICBpZiBsZXZlbCA9PSAnQ1JJVElDQUwnOgogICAgICAgICAgICBmb3IgbWV0cmljLCBydWxlcyBpbiBtZXRyaWNzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBmb3IgcnVsZSBpbiBydWxlczoKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpICE9IEFsZXJ0TGV2ZWwuQ1JJVElDQUw6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1ldHJpYyA9PSBtZXRyaWNfZGVzYzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKG1ldHJpYyArICIgQ1JJVElDQUwiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5kZWJ1ZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZXR0aW5nIENSSVRJQ0FMIGFsZXJ0IGxldmVsIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5zZXRfYWxlcnRfbGV2ZWwoQWxlcnRMZXZlbC5DUklUSUNBTCkKICAgICAgICBlbGlmIGxldmVsID09ICdNQUpPUic6CiAgICAgICAgICAgIGZvciBtZXRyaWMsIHJ1bGVzIGluIG1ldHJpY3MuaXRlbXMoKToKICAgICAgICAgICAgICAgIGZvciBydWxlIGluIHJ1bGVzOgogICAgICAgICAgICAgICAgICAgIGlmIHJ1bGVzW3J1bGVdID09ICdDUklUSUNBTCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuYWdlbnQuZ2V0X2FsZXJ0X2xldmVsKCkgIT0gQWxlcnRMZXZlbC5DUklUSUNBTDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQuc2V0X2FsZXJ0X2xldmVsKEFsZXJ0TGV2ZWwuQ1JJVElDQUwpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IChzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuQ1JJVElDQUwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuTUFKT1IpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWV0cmljID09IG1ldHJpY19kZXNjOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKG1ldHJpYyArICIgTUFKT1IiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNldHRpbmcgTUFKT1IgYWxlcnQgbGV2ZWwiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5zZXRfYWxlcnRfbGV2ZWwoQWxlcnRMZXZlbC5NQUpPUikKICAgICAgICBlbGlmIGxldmVsID09ICdNSU5PUic6CiAgICAgICAgICAgIGZvciBtZXRyaWMsIHJ1bGVzIGluIG1ldHJpY3MuaXRlbXMoKToKICAgICAgICAgICAgICAgIGZvciBydWxlIGluIHJ1bGVzOgogICAgICAgICAgICAgICAgICAgIGlmIHJ1bGVzW3J1bGVdID09ICdDUklUSUNBTCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuYWdlbnQuZ2V0X2FsZXJ0X2xldmVsKCkgIT0gQWxlcnRMZXZlbC5DUklUSUNBTDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQuc2V0X2FsZXJ0X2xldmVsKEFsZXJ0TGV2ZWwuQ1JJVElDQUwpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBydWxlc1tydWxlXSA9PSAnTUFKT1InOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgKHNlbGYuYWdlbnQuZ2V0X2FsZXJ0X2xldmVsKCkgPT0gQWxlcnRMZXZlbC5DUklUSUNBTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIHNlbGYuYWdlbnQuZ2V0X2FsZXJ0X2xldmVsKCkgPT0gQWxlcnRMZXZlbC5NQUpPUik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnNldF9hbGVydF9sZXZlbChBbGVydExldmVsLk1BSk9SKQogICAgICAgICAgICAgICAgICAgIGVsaWYgcnVsZXNbcnVsZV0gPT0gJ01JTk9SJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IChzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuQ1JJVElDQUwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuTUFKT1IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuTUlOT1IpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWV0cmljID09IG1ldHJpY19kZXNjOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKG1ldHJpYyArICIgTUlOT1IiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNldHRpbmcgTUlOT1IgYWxlcnQgbGV2ZWwiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5zZXRfYWxlcnRfbGV2ZWwoQWxlcnRMZXZlbC5NSU5PUikKICAgICAgICBlbGlmIGxldmVsID09ICdOT05FJzoKICAgICAgICAgICAgZm9yIG1ldHJpYywgcnVsZXMgaW4gbWV0cmljcy5pdGVtcygpOgogICAgICAgICAgICAgICAgZm9yIHJ1bGUgaW4gcnVsZXM6CiAgICAgICAgICAgICAgICAgICAgbGV2ZWxzLmFwcGVuZChydWxlc1tydWxlXSkKICAgICAgICAgICAgICAgICAgICBpZiBydWxlc1tydWxlXSA9PSAnQ1JJVElDQUwnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpICE9IEFsZXJ0TGV2ZWwuQ1JJVElDQUw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnNldF9hbGVydF9sZXZlbChBbGVydExldmVsLkNSSVRJQ0FMKQogICAgICAgICAgICAgICAgICAgIGVsaWYgcnVsZXNbcnVsZV0gPT0gJ01BSk9SJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IChzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuQ1JJVElDQUwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuTUFKT1IpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5zZXRfYWxlcnRfbGV2ZWwoQWxlcnRMZXZlbC5NQUpPUikKICAgICAgICAgICAgICAgICAgICBlbGlmIHJ1bGVzW3J1bGVdID09ICdNSU5PUic6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCAoc2VsZi5hZ2VudC5nZXRfYWxlcnRfbGV2ZWwoKSA9PSBBbGVydExldmVsLkNSSVRJQ0FMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3Igc2VsZi5hZ2VudC5nZXRfYWxlcnRfbGV2ZWwoKSA9PSBBbGVydExldmVsLk1BSk9SCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3Igc2VsZi5hZ2VudC5nZXRfYWxlcnRfbGV2ZWwoKSA9PSBBbGVydExldmVsLk1JTk9SKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQuc2V0X2FsZXJ0X2xldmVsKEFsZXJ0TGV2ZWwuTUlOT1IpCiAgICAgICAgICAgICMgUmVtb3ZlIGFsZXJ0IGxldmVsIGlmIGFsbCBzdWItc2NyaXB0cyBhcmUgbm9ybWFsCiAgICAgICAgICAgIGlmIGxldmVscy5jb3VudCgnTk9ORScpID09IGxlbihsZXZlbHMpOgogICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICAgICAgICAgIlJlbW92aW5nIGFsZXJ0IGxldmVsIHNpbmNlIGFsbCBtZXRyaWNzIGFyZSBub3JtYWwiKQogICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5yZW1vdmVfYWxlcnRfbGV2ZWwoKQoKCmNsYXNzIEFnZW50KE5BRSk6CgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIGFsbSA9IEFsZXJ0TWFuYWdlcihzZWxmKQogICAgICAgIHNlbGYudGVtcF9zZW5zb3IgPSBUZW1wU2Vuc29yKHNlbGYsIGFsbSkKICAgICAgICBzZWxmLmZhbl9zdGF0dXMgPSBGYW4oc2VsZiwgYWxtKQogICAgICAgIHNlbGYuZmF1bHRfZmluZGVyID0gRmF1bHRGaW5kZXIoc2VsZiwgYWxtKQoKICAgICAgICBzZWxmLl9fbWVyZ2Uoc2VsZi50ZW1wX3NlbnNvcikKICAgICAgICBzZWxmLl9fbWVyZ2Uoc2VsZi5mYW5fc3RhdHVzKQogICAgICAgIHNlbGYuX19tZXJnZShzZWxmLmZhdWx0X2ZpbmRlcikKCiAgICBkZWYgX19tZXJnZShzZWxmLCBzY3JpcHQpOgogICAgICAgIHNlbGYuX19tZXJnZV9tb25pdG9ycyhzY3JpcHQuY3JlYXRlX21vbml0b3JzKCkpCiAgICAgICAgc2VsZi5fX21lcmdlX3J1bGVzKHNjcmlwdC5jcmVhdGVfcnVsZXMoKSkKICAgICAgICBzZWxmLl9fbWVyZ2VfZ3JhcGhzKHNjcmlwdC5jcmVhdGVfZ3JhcGhzKCkpCgogICAgZGVmIF9fbWVyZ2VfbW9uaXRvcnMoc2VsZiwgbW9uaXRvcnMpOgogICAgICAgIGZvciBpLCBfIGluIGVudW1lcmF0ZShtb25pdG9ycyk6CiAgICAgICAgICAgIGlkID0gdXVpZC51dWlkNCgpLmhleAogICAgICAgICAgICBtb24gPSAnbW9uaXRvcl97fScuZm9ybWF0KGlkKQogICAgICAgICAgICBzZXRhdHRyKHNlbGYsIG1vbiwgbW9uaXRvcnNbaV0pCiAgICAgICAgcmV0dXJuIG1vbml0b3JzCgogICAgZGVmIF9fbWVyZ2VfcnVsZXMoc2VsZiwgcnVsZXMpOgogICAgICAgIGZvciBpLCBfIGluIGVudW1lcmF0ZShydWxlcyk6CiAgICAgICAgICAgIGlkID0gdXVpZC51dWlkNCgpLmhleAogICAgICAgICAgICBydWxlID0gJ3J1bGVfe30nLmZvcm1hdChpZCkKICAgICAgICAgICAgc2V0YXR0cihzZWxmLCBydWxlLCBydWxlc1tpXSkKICAgICAgICByZXR1cm4gcnVsZXMKCiAgICBkZWYgX19tZXJnZV9ncmFwaHMoc2VsZiwgZ3JhcGhzKToKICAgICAgICBmb3IgaSwgXyBpbiBlbnVtZXJhdGUoZ3JhcGhzKToKICAgICAgICAgICAgaWQgPSB1dWlkLnV1aWQ0KCkuaGV4CiAgICAgICAgICAgIGdyYXBoID0gJ2dyYXBoX3t9Jy5mb3JtYXQoaWQpCiAgICAgICAgICAgIHNldGF0dHIoc2VsZiwgZ3JhcGgsIGdyYXBoc1tpXSkKICAgICAgICByZXR1cm4gZ3JhcGhzCgogICAgIyBDbGFzc3dpc2Ugd3JhcHBlciBtZXRob2RzIHRvIHRyaWdnZXIgY2FsbGJhY2sgYWN0aW9ucwogICAgZGVmIGFjdGlvbl9zeXNsb2coc2VsZiwgbWV0cmljX2FyZ3MpOgogICAgICAgIEFjdGlvblN5c2xvZyhtZXRyaWNfYXJncywgc2V2ZXJpdHk9U1lTTE9HX1dBUk5JTkcpCgogICAgZGVmIGFjdGlvbl9jbGkoc2VsZiwgbWV0cmljX2FyZ3MpOgogICAgICAgIEFjdGlvbkNMSShtZXRyaWNfYXJncykKCiAgICBkZWYgc2Vuc29yX2FjdGlvbl9zdGF0dXNfbm9ybWFsKHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLnRlbXBfc2Vuc29yLnNlbnNvcl9hY3Rpb25fc3RhdHVzX25vcm1hbCgKICAgICAgICAgICAgZXZlbnQpCgogICAgZGVmIHNlbnNvcl9hY3Rpb25fc3RhdHVzX2NyaXRpY2FsKHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLnRlbXBfc2Vuc29yLnNlbnNvcl9hY3Rpb25fc3RhdHVzX2NyaXRpY2FsKAogICAgICAgICAgICBldmVudCkKCiAgICBkZWYgZmFuc19zdGF0dXNfYWN0aW9uX25vcm1hbChzZWxmLCBldmVudCk6CiAgICAgICAgc2VsZi5mYW5fc3RhdHVzLmZhbnNfc3RhdHVzX2FjdGlvbl9ub3JtYWwoCiAgICAgICAgICAgIGV2ZW50KQoKICAgIGRlZiBmYW5zX3N0YXR1c19hY3Rpb25fZmF1bHQoc2VsZiwgZXZlbnQpOgogICAgICAgIHNlbGYuZmFuX3N0YXR1cy5mYW5zX3N0YXR1c19hY3Rpb25fZmF1bHQoCiAgICAgICAgICAgIGV2ZW50KQoKICAgIGRlZiBhY3Rpb25fcnhfY3JjX2Vycl9zZW5zaXRpdml0eShzZWxmLCBldmVudCk6CiAgICAgICAgc2VsZi5mYXVsdF9maW5kZXIuYWN0aW9uX3J4X2NyY19lcnJfc2Vuc2l0aXZpdHkoCiAgICAgICAgICAgIGV2ZW50KQoKICAgIGRlZiBhY3Rpb25fY2xlYXJfcnhfY3JjX2Vycl9zZW5zaXRpdml0eShzZWxmLCBldmVudCk6CiAgICAgICAgc2VsZi5mYXVsdF9maW5kZXIuYWN0aW9uX2NsZWFyX3J4X2NyY19lcnJfc2Vuc2l0aXZpdHkoCiAgICAgICAgICAgIGV2ZW50KQoKICAgIGRlZiBhY3Rpb25fZnJhZ21lbnRzX3NlbnNpdGl2aXR5KHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLmZhdWx0X2ZpbmRlci5hY3Rpb25fZnJhZ21lbnRzX3NlbnNpdGl2aXR5KAogICAgICAgICAgICBldmVudCkKCiAgICBkZWYgYWN0aW9uX2NsZWFyX2ZyYWdtZW50c19zZW5zaXRpdml0eShzZWxmLCBldmVudCk6CiAgICAgICAgc2VsZi5mYXVsdF9maW5kZXIuYWN0aW9uX2NsZWFyX2ZyYWdtZW50c19zZW5zaXRpdml0eSgKICAgICAgICAgICAgZXZlbnQp
nae-script interface_link_state_monitor false IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0NCiMNCiMgQ29weXJpZ2h0IChjKSAyMDE3IEhld2xldHQgUGFja2FyZCBFbnRlcnByaXNlIERldmVsb3BtZW50IExQDQojDQojIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOw0KIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuDQojIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KIw0KIyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjANCiMNCiMgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLA0KIyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbg0KIyAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkNCiMgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUNCiMgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucw0KIyB1bmRlciB0aGUgTGljZW5zZS4NCg0KTWFuaWZlc3QgPSB7DQogICAgJ05hbWUnOiAnaW50ZXJmYWNlX2xpbmtfc3RhdGVfbW9uaXRvcicsDQogICAgJ0Rlc2NyaXB0aW9uJzogJ0ludGVyZmFjZSBMaW5rIFN0YXR1cyBNb25pdG9yaW5nIEFnZW50JywNCiAgICAnVmVyc2lvbic6ICcxLjAnLA0KICAgICdBdXRob3InOiAnQXJ1YmEgTmV0d29ya3MnDQp9DQoNCg0KY2xhc3MgUG9saWN5KE5BRSk6DQoNCiAgICBkZWYgX19pbml0X18oc2VsZik6DQogICAgICAgICMgSW50ZXJmYWNlIHN0YXR1cw0KICAgICAgICB1cmkxID0gJy9yZXN0L3YxL3N5c3RlbS9pbnRlcmZhY2VzLyo/YXR0cmlidXRlcz1saW5rX3N0YXRlJw0KICAgICAgICBzZWxmLm0xID0gTW9uaXRvcigNCiAgICAgICAgICAgIHVyaTEsDQogICAgICAgICAgICAnSW50ZXJmYWNlIExpbmsgc3RhdHVzJykNCiAgICAgICAgc2VsZi5yMSA9IFJ1bGUoJ0xpbmsgV2VudCBEb3duJykNCiAgICAgICAgc2VsZi5yMS5jb25kaXRpb24oJ3RyYW5zaXRpb24ge30gZnJvbSAidXAiIHRvICJkb3duIicsIFtzZWxmLm0xXSkNCiAgICAgICAgc2VsZi5yMS5hY3Rpb24oc2VsZi5hY3Rpb25faW50ZXJmYWNlX2Rvd24pDQoNCiAgICAgICAgIyBSZXNldCBwb2xpY3kgc3RhdHVzIHdoZW4gbGluayBpcyB1cA0KICAgICAgICBzZWxmLnIyID0gUnVsZSgnTGluayBDYW1lIFVQJykNCiAgICAgICAgc2VsZi5yMi5jb25kaXRpb24oJ3RyYW5zaXRpb24ge30gZnJvbSAiZG93biIgdG8gInVwIicsIFtzZWxmLm0xXSkNCiAgICAgICAgc2VsZi5yMi5hY3Rpb24oc2VsZi5hY3Rpb25faW50ZXJmYWNlX3VwKQ0KDQogICAgICAgICMgdmFyaWFibGVzDQogICAgICAgIHNlbGYudmFyaWFibGVzWydsaW5rc19kb3duJ10gPSAnJw0KDQogICAgZGVmIGFjdGlvbl9pbnRlcmZhY2VfZG93bihzZWxmLCBldmVudCk6DQogICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCI9PT09PT09PT09PT09PT09IERvd24gPT09PT09PT09PT09PT09PSIpDQogICAgICAgIGxhYmVsID0gZXZlbnRbJ2xhYmVscyddDQogICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCdsYWJlbDogWycgKyBsYWJlbCArICddJykNCiAgICAgICAgXywgaW50ZXJmYWNlX2lkID0gbGFiZWwuc3BsaXQoJywnKVswXS5zcGxpdCgnPScpDQogICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCdpbnRlcmZhY2VfaWQgLSAnICsgaW50ZXJmYWNlX2lkKQ0KICAgICAgICBsaW5rc19kb3duID0gc2VsZi52YXJpYWJsZXNbJ2xpbmtzX2Rvd24nXQ0KICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygnbGlua3NfZG93biBiZWZvcmU6IFsnDQogICAgICAgICAgICAgICAgICAgICAgICAgICsgbGlua3NfZG93biArICddJykNCiAgICAgICAgaWYgKGludGVyZmFjZV9pZCArICc6Jykgbm90IGluIGxpbmtzX2Rvd246DQogICAgICAgICAgICBsaW5rc19kb3duID0gbGlua3NfZG93biArIGludGVyZmFjZV9pZCArICc6Jw0KICAgICAgICAgICAgc2VsZi52YXJpYWJsZXNbJ2xpbmtzX2Rvd24nXSA9IGxpbmtzX2Rvd24NCiAgICAgICAgICAgIEFjdGlvblN5c2xvZygnSW50ZXJmYWNlICcgKyBpbnRlcmZhY2VfaWQgKyAnIExpbmsgZ29uZSBkb3duJykNCiAgICAgICAgICAgIEFjdGlvbkNMSSgic2hvdyBsbGRwIGNvbmZpZ3VyYXRpb24gIiArIGludGVyZmFjZV9pZCkNCiAgICAgICAgICAgIEFjdGlvbkNMSSgic2hvdyBpbnRlcmZhY2UgIiArIGludGVyZmFjZV9pZCArICIgZXh0ZW5kZWQiKQ0KICAgICAgICAgICAgaWYgc2VsZi5nZXRfYWxlcnRfbGV2ZWwoKSAhPSBBbGVydExldmVsLkNSSVRJQ0FMOg0KICAgICAgICAgICAgICAgIHNlbGYuc2V0X2FsZXJ0X2xldmVsKEFsZXJ0TGV2ZWwuQ1JJVElDQUwpDQogICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCdsaW5rc19kb3duIGFmdGVyOiBbJw0KICAgICAgICAgICAgICAgICAgICAgICAgICArIGxpbmtzX2Rvd24gKyAnXScpDQogICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCI9PT09PT09PT09PT09PT09IC9Eb3duID09PT09PT09PT09PT09PT0iKQ0KDQogICAgZGVmIGFjdGlvbl9pbnRlcmZhY2VfdXAoc2VsZiwgZXZlbnQpOg0KICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygiPT09PT09PT09PT09PT09PSBVcCA9PT09PT09PT09PT09PT09IikNCiAgICAgICAgbGFiZWwgPSBldmVudFsnbGFiZWxzJ10NCiAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoJ2xhYmVsOiBbJyArIGxhYmVsICsgJ10nKQ0KICAgICAgICBfLCBpbnRlcmZhY2VfaWQgPSBsYWJlbC5zcGxpdCgnLCcpWzBdLnNwbGl0KCc9JykNCiAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoJ2ludGVyZmFjZV9pZCAtICcgKyBpbnRlcmZhY2VfaWQpDQogICAgICAgIGxpbmtzX2Rvd24gPSBzZWxmLnZhcmlhYmxlc1snbGlua3NfZG93biddDQogICAgICAgIHNlbGYubG9nZ2VyLmRlYnVnKCdsaW5rc19kb3duIGJlZm9yZTogWycNCiAgICAgICAgICAgICAgICAgICAgICAgICAgKyBsaW5rc19kb3duICsgJ10nKQ0KICAgICAgICBpZiAoaW50ZXJmYWNlX2lkICsgJzonKSBpbiBsaW5rc19kb3duOg0KICAgICAgICAgICAgbGlua3NfZG93biA9IGxpbmtzX2Rvd24ucmVwbGFjZSgoaW50ZXJmYWNlX2lkICsgJzonKSwgJycpDQogICAgICAgICAgICBzZWxmLnZhcmlhYmxlc1snbGlua3NfZG93biddID0gbGlua3NfZG93bg0KICAgICAgICAgICAgc2VsZi5sb2dnZXIuZGVidWcoJ2xpbmtzX2Rvd24gYWZ0ZXI6IFsnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGxpbmtzX2Rvd24gKyAnXScpDQogICAgICAgICAgICBBY3Rpb25TeXNsb2coJ0ludGVyZmFjZSAnICsgaW50ZXJmYWNlX2lkICsgJyBMaW5rIGNhbWUgdXAnKQ0KICAgICAgICAgICAgaWYgbm90IGxpbmtzX2Rvd246DQogICAgICAgICAgICAgICAgaWYgc2VsZi5nZXRfYWxlcnRfbGV2ZWwoKSBpcyBub3QgTm9uZToNCiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZW1vdmVfYWxlcnRfbGV2ZWwoKQ0KICAgICAgICBzZWxmLmxvZ2dlci5kZWJ1ZygiPT09PT09PT09PT09PT09PSAvVXAgPT09PT09PT09PT09PT09PSIp
nae-script interface_tx_rx_stats_monitor false IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KIwojIChjKSBDb3B5cmlnaHQgMjAxNy0yMDE5IEhld2xldHQgUGFja2FyZCBFbnRlcnByaXNlIERldmVsb3BtZW50IExQCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKIwojIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywKIyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgojICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQojIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiMgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucwojIHVuZGVyIHRoZSBMaWNlbnNlLgoKTWFuaWZlc3QgPSB7CiAgICAnTmFtZSc6ICdpbnRlcmZhY2VfdHhfcnhfc3RhdHNfbW9uaXRvcicsCiAgICAnRGVzY3JpcHRpb24nOiAnUGh5c2ljYWwgSW50ZXJmYWNlIFR4L1J4IHN0YXRpc3RpY3MgbW9uaXRvcmluZyBhZ2VudCcKICAgICAgICAgICAgICAgICAgICcgdXNpbmcgbXVsdGktZ3JhcGgnLAogICAgJ1ZlcnNpb24nOiAnMi4zJywKICAgICdUYXJnZXRTb2Z0d2FyZVZlcnNpb24nOiAnMTAuMDQnLAogICAgJ0F1dGhvcic6ICdBcnViYSBOZXR3b3JrcycKfQoKUGFyYW1ldGVyRGVmaW5pdGlvbnMgPSB7CiAgICAncnhfcGFja2V0c190aHJlc2hvbGQnOiB7CiAgICAgICAgJ05hbWUnOiAnVGhyZXNob2xkIGZvciBSeCBwYWNrZXRzJywKICAgICAgICAnRGVzY3JpcHRpb24nOiAnVGhyZXNob2xkIGZvciBudW1iZXIgb2YgUnggcGFja2V0cyByZWNlaXZlZCcsCiAgICAgICAgJ1R5cGUnOiAnaW50ZWdlcicsCiAgICAgICAgJ1JlcXVpcmVkJzogVHJ1ZQogICAgfSwKICAgICd0eF9wYWNrZXRzX3RocmVzaG9sZCc6IHsKICAgICAgICAnTmFtZSc6ICdUaHJlc2hvbGQgZm9yIFR4IHBhY2tldHMnLAogICAgICAgICdEZXNjcmlwdGlvbic6ICdUaHJlc2hvbGQgZm9yIG51bWJlciBvZiBUeCBwYWNrZXRzIHRyYW5zbWl0dGVkJywKICAgICAgICAnVHlwZSc6ICdpbnRlZ2VyJywKICAgICAgICAnUmVxdWlyZWQnOiBUcnVlCiAgICB9Cn0KCgpjbGFzcyBBZ2VudChOQUUpOgoKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICAjIHJ4IHBhY2tldHMKICAgICAgICB1cmkxID0gJy9yZXN0L3YxL3N5c3RlbS9pbnRlcmZhY2VzLyo/YXR0cmlidXRlcz1zdGF0aXN0aWNzLnJ4X3BhY2tldHMnICsgXAogICAgICAgICAgICAnJmZpbHRlcj10eXBlOnN5c3RlbScKICAgICAgICByYXRlX20xID0gUmF0ZSh1cmkxLCAiMjAgc2Vjb25kcyIpCiAgICAgICAgc2VsZi5tMSA9IE1vbml0b3IocmF0ZV9tMSwgJ1J4IFBhY2tldHMgKHBhY2tldHMgcGVyIHNlY29uZCknKQogICAgICAgIHNlbGYucjEgPSBSdWxlKCdSdWxlIHRvIE1vbml0b3IgSW50ZXJmYWNlIHJ4IFBhY2tldHMnKQogICAgICAgIHNlbGYucjEuY29uZGl0aW9uKAogICAgICAgICAgICAne30gPiB7fScsIFtzZWxmLm0xLCBzZWxmLnBhcmFtc1sncnhfcGFja2V0c190aHJlc2hvbGQnXV0pCiAgICAgICAgc2VsZi5yMS5jbGVhcl9jb25kaXRpb24oCiAgICAgICAgICAgICd7fSA8IHt9JywgW3NlbGYubTEsIHNlbGYucGFyYW1zWydyeF9wYWNrZXRzX3RocmVzaG9sZCddXSkKICAgICAgICBzZWxmLnIxLmFjdGlvbigiQUxFUlRfTEVWRUwiLCBBbGVydExldmVsLkNSSVRJQ0FMKQogICAgICAgIHNlbGYucjEuY2xlYXJfYWN0aW9uKCJBTEVSVF9MRVZFTCIsIEFsZXJ0TGV2ZWwuTk9ORSkKCiAgICAgICAgIyByeCBwYWNrZXRzIGRyb3BwZWQKICAgICAgICB1cmkyID0gJy9yZXN0L3YxL3N5c3RlbS9pbnRlcmZhY2VzLyo/YXR0cmlidXRlcz1zdGF0aXN0aWNzLnJ4X2Ryb3BwZWQnICsgXAogICAgICAgICAgICAnJmZpbHRlcj10eXBlOnN5c3RlbScKICAgICAgICBzZWxmLm0yID0gTW9uaXRvcigKICAgICAgICAgICAgdXJpMiwKICAgICAgICAgICAgJ1J4IFBhY2tldHMgRHJvcHBlZCAocGFja2V0cyknKQoKICAgICAgICAjIHR4IHBhY2tldHMKICAgICAgICB1cmkzID0gJy9yZXN0L3YxL3N5c3RlbS9pbnRlcmZhY2VzLyo/YXR0cmlidXRlcz1zdGF0aXN0aWNzLnR4X3BhY2tldHMnICsgXAogICAgICAgICAgICAnJmZpbHRlcj10eXBlOnN5c3RlbScKICAgICAgICByYXRlX20zID0gUmF0ZSh1cmkzLCAiMjAgc2Vjb25kcyIpCiAgICAgICAgc2VsZi5tMyA9IE1vbml0b3IocmF0ZV9tMywgJ1R4IFBhY2tldHMgKHBhY2tldHMgcGVyIHNlY29uZCknKQogICAgICAgIHNlbGYucjMgPSBSdWxlKCdSdWxlIHRvIE1vbml0b3IgSW50ZXJmYWNlIHR4IFBhY2tldHMnKQoKICAgICAgICBzZWxmLnIzLmNvbmRpdGlvbigKICAgICAgICAgICAgJ3t9ID4ge30nLCBbc2VsZi5tMywgc2VsZi5wYXJhbXNbJ3R4X3BhY2tldHNfdGhyZXNob2xkJ11dKQogICAgICAgIHNlbGYucjMuY2xlYXJfY29uZGl0aW9uKAogICAgICAgICAgICAne30gPCB7fScsIFtzZWxmLm0zLCBzZWxmLnBhcmFtc1sndHhfcGFja2V0c190aHJlc2hvbGQnXV0pCiAgICAgICAgc2VsZi5yMy5hY3Rpb24oIkFMRVJUX0xFVkVMIiwgQWxlcnRMZXZlbC5DUklUSUNBTCkKICAgICAgICBzZWxmLnIzLmNsZWFyX2FjdGlvbigiQUxFUlRfTEVWRUwiLCBBbGVydExldmVsLk5PTkUpCgogICAgICAgICMgdHggcGFja2V0cyBkcm9wcGVkCiAgICAgICAgdXJpNCA9ICcvcmVzdC92MS9zeXN0ZW0vaW50ZXJmYWNlcy8qP2F0dHJpYnV0ZXM9c3RhdGlzdGljcy50eF9kcm9wcGVkJyArIFwKICAgICAgICAgICAgJyZmaWx0ZXI9dHlwZTpzeXN0ZW0nCiAgICAgICAgc2VsZi5tNCA9IE1vbml0b3IoCiAgICAgICAgICAgIHVyaTQsCiAgICAgICAgICAgICdUeCBQYWNrZXRzIERyb3BwZWQgKHBhY2tldHMpJykKCiAgICAgICAgIyBncmFwaCBkaXNwbGF5IGZvciBjaGFuZ2Ugb2YgdHJhZmZpYyBhbmQgcGFja2V0cyBkcm9wCiAgICAgICAgc2VsZi5ncmFwaF90eF9yeF9wYWNrZXRzID0gXAogICAgICAgICAgICBHcmFwaChbc2VsZi5tMSwgc2VsZi5tM10sCiAgICAgICAgICAgICAgICAgIHRpdGxlPVRpdGxlKAogICAgICAgICAgICAgICAgICAgICAgIlJhdGUgb2YgY2hhbmdlIG9mIEludGVyZmFjZSBUeC9SeCBwYWNrZXRzIChpbiBzZWNvbmRzKSIpLAogICAgICAgICAgICAgICAgICBkYXNoYm9hcmRfZGlzcGxheT1UcnVlKQogICAgICAgIHNlbGYuZ3JhcGhfdHhfcnhfZHJvcCA9IFwKICAgICAgICAgICAgR3JhcGgoW3NlbGYubTIsIHNlbGYubTRdLAogICAgICAgICAgICAgICAgICB0aXRsZT1UaXRsZSgiSW50ZXJmYWNlIFR4L1J4IHBhY2tldHMgZHJvcCBjb3VudCIpLAogICAgICAgICAgICAgICAgICBkYXNoYm9hcmRfZGlzcGxheT1GYWxzZSk=
nae-script network_health_monitor false ...
nae-script software_device_health_monitor false IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KIwojIChjKSBDb3B5cmlnaHQgMjAxOS0yMDIwIEhld2xldHQgUGFja2FyZCBFbnRlcnByaXNlIERldmVsb3BtZW50IExQCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKIwojIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywKIyBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbgojICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQojIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiMgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucwojIHVuZGVyIHRoZSBMaWNlbnNlLgoKZnJvbSByZXF1ZXN0cyBpbXBvcnQgZ2V0CmltcG9ydCB1dWlkCmltcG9ydCBhc3QKCk1hbmlmZXN0ID0gewogICAgJ05hbWUnOiAnc29mdHdhcmVfZGV2aWNlX2hlYWx0aF9tb25pdG9yJywKICAgICdEZXNjcmlwdGlvbic6ICdUaGlzIHNjcmlwdCBtb25pdG9ycyBvdmVyYWxsIHNvZnR3YXJlIGRldmljZSBoZWFsdGguJywKICAgICdWZXJzaW9uJzogJzEuOCcsCiAgICAnVGFyZ2V0U29mdHdhcmVWZXJzaW9uJzogJzEwLjA0JywKICAgICdUYWdzJzogWydkZXZpY2UnXSwKICAgICdBdXRob3InOiAnQXJ1YmEgTmV0d29ya3MnCn0KClBhcmFtZXRlckRlZmluaXRpb25zID0gewogICAgJ3RocmVzaG9sZCc6IHsKICAgICAgICAnTmFtZSc6ICdUb3RhbCBNQUMgYWRkcmVzcyBjb3VudCB0aHJlc2hvbGQnLAogICAgICAgICdEZXNjcmlwdGlvbic6ICdUaGlzIHBhcmFtZXRlciByZXByZXNlbnRzIHRoZSB0aHJlc2hvbGQgdmFsdWUgYWJvdmUgJwogICAgICAgICAgICAgICAgICAgICAgICd3aGljaCB0aGUgdG90YWwgY291bnQgb2YgTUFDIGFkZHJlc3NlcyBvbiB0aGUgJwogICAgICAgICAgICAgICAgICAgICAgICdzd2l0Y2gsIGdlbmVyYXRlcyBhbiBhbGVydC4nLAogICAgICAgICdUeXBlJzogJ0ludGVnZXInLAogICAgICAgICdEZWZhdWx0JzogMTcwMAogICAgfSwKICAgICdjcHVfdGhyZXNob2xkJzogewogICAgICAgICdOYW1lJzogJ0hpZ2ggQ1BVIHRocmVzaG9sZCB2YWx1ZSBpbiBwZXJjZW50YWdlJywKICAgICAgICAnRGVzY3JpcHRpb24nOiAnQWdlbnQgd2lsbCBhbGVydCB3aGVuIGFueSBtb25pdG9yZWQgU3lzdGVtIGRhZW1vbiAnCiAgICAgICAgICAgICAgICAgICAgICAgJ0NQVSB1dGlsaXphdGlvbiBjcm9zc2VzIHRoaXMgdGhyZXNob2xkIHZhbHVlJywKICAgICAgICAnVHlwZSc6ICdpbnRlZ2VyJywKICAgICAgICAnRGVmYXVsdCc6IDkwCiAgICB9LAogICAgJ21lbW9yeV90aHJlc2hvbGQnOiB7CiAgICAgICAgJ05hbWUnOiAnSGlnaCBNZW1vcnkgdGhyZXNob2xkIHZhbHVlIGluIHBlcmNlbnRhZ2UnLAogICAgICAgICdEZXNjcmlwdGlvbic6ICdBZ2VudCB3aWxsIGFsZXJ0IHdoZW4gYW55IG1vbml0b3JlZCBTeXN0ZW0gZGFlbW9uICcKICAgICAgICAgICAgICAgICAgICAgICAnTWVtb3J5IHV0aWxpemF0aW9uIGNyb3NzZXMgdGhpcyB0aHJlc2hvbGQgdmFsdWUnLAogICAgICAgICdUeXBlJzogJ2ludGVnZXInLAogICAgICAgICdEZWZhdWx0JzogOTAKICAgIH0sCiAgICAndGltZV9pbnRlcnZhbCc6IHsKICAgICAgICAnTmFtZSc6ICdUaW1lIGludGVydmFsIGluIHNlY29uZHMgdG8gY29uc2lkZXIgQ1BVL01lbW9yeSB1dGlsaXphdGlvbicsCiAgICAgICAgJ0Rlc2NyaXB0aW9uJzogJ1RpbWUgaW50ZXJ2YWwgaW4gc2Vjb25kcyB0byBjb25zaWRlciAnCiAgICAgICAgICAgICAgICAgICAgICAgJ1N5c3RlbSBkYWVtb24gQ1BVIHV0aWxpemF0aW9uJywKICAgICAgICAnVHlwZSc6ICdpbnRlZ2VyJywKICAgICAgICAnRGVmYXVsdCc6IDMwCiAgICB9LAogICAgJ2RhZW1vbl8xJzogewogICAgICAgICdOYW1lJzogJ1N5c3RlbSBkYWVtb24gbmFtZSAxJywKICAgICAgICAnRGVzY3JpcHRpb24nOiAnU3lzdGVtIGRhZW1vbiBuYW1lIDEgdG8gbW9uaXRvciBDUFUgYW5kIE1lbW9yeSAnCiAgICAgICAgICAgICAgICAgICAgICAgJ3V0aWxpemF0aW9uJywKICAgICAgICAnVHlwZSc6ICdzdHJpbmcnLAogICAgICAgICdEZWZhdWx0JzogJ29wcy1zd2l0Y2hkJwogICAgfSwKICAgICdkYWVtb25fMic6IHsKICAgICAgICAnTmFtZSc6ICdTeXN0ZW0gZGFlbW9uIG5hbWUgMicsCiAgICAgICAgJ0Rlc2NyaXB0aW9uJzogJ1N5c3RlbSBkYWVtb24gbmFtZSAyIHRvIG1vbml0b3IgQ1BVIGFuZCBNZW1vcnkgJwogICAgICAgICAgICAgICAgICAgICAgICd1dGlsaXphdGlvbicsCiAgICAgICAgJ1R5cGUnOiAnc3RyaW5nJywKICAgICAgICAnRGVmYXVsdCc6ICdvdnNkYi1zZXJ2ZXInCiAgICB9LAogICAgJ2RhZW1vbl8zJzogewogICAgICAgICdOYW1lJzogJ1N5c3RlbSBkYWVtb24gbmFtZSAzJywKICAgICAgICAnRGVzY3JpcHRpb24nOiAnU3lzdGVtIGRhZW1vbiBuYW1lIDMgdG8gbW9uaXRvciBDUFUgYW5kIE1lbW9yeSAnCiAgICAgICAgICAgICAgICAgICAgICAgJ3V0aWxpemF0aW9uJywKICAgICAgICAnVHlwZSc6ICdzdHJpbmcnLAogICAgICAgICdEZWZhdWx0JzogJ2hwZS1yb3V0aW5nJwogICAgfSwKICAgICdkYWVtb25fNCc6IHsKICAgICAgICAnTmFtZSc6ICdTeXN0ZW0gZGFlbW9uIG5hbWUgNCcsCiAgICAgICAgJ0Rlc2NyaXB0aW9uJzogJ1N5c3RlbSBkYWVtb24gbmFtZSA0IHRvIG1vbml0b3IgQ1BVIGFuZCBNZW1vcnkgJwogICAgICAgICAgICAgICAgICAgICAgICd1dGlsaXphdGlvbicsCiAgICAgICAgJ1R5cGUnOiAnc3RyaW5nJywKICAgICAgICAnRGVmYXVsdCc6ICduZG1kJwogICAgfSwKICAgICdyb3V0ZXNfY291bnRfcmF0aW9fbG93ZXJfdGhyZXNob2xkJzogewogICAgICAgICdOYW1lJzogJ1JvdXRlIGNvdW50IGRldmlhdGlvbiBsb3dlciB0aHJlc2hvbGQgJywKICAgICAgICAnRGVzY3JpcHRpb24nOiAnVGhpcyBwYXJhbWV0ZXIgcmVwcmVzZW50IHRoZSBsb3dlciB0aHJlc2hvbGQgdmFsdWUgdXAgdG8gJwogICAgICAgICAgICAgICAgICAgICAgICd3aGljaCB0aGUgcmF0aW8gYmV0d2VlbiByb3V0ZSBjb3VudCBvbiB0aGUgc3dpdGNoICcKICAgICAgICAgICAgICAgICAgICAgICAnYW5kIHJvdXRlIGNvdW50IG9uIHRoZSBWU1ggcGVlciBzd2l0Y2ggaXMgYWxsb3dlZCB0bycKICAgICAgICAgICAgICAgICAgICAgICAnIGRldmlhdGUuJywKICAgICAgICAnVHlwZSc6ICdmbG9hdCcsCiAgICAgICAgJ0RlZmF1bHQnOiAnMC45NScsCiAgICB9LAogICAgJ3JvdXRlc19jb3VudF9yYXRpb191cHBlcl90aHJlc2hvbGQnOiB7CiAgICAgICAgJ05hbWUnOiAnUm91dGUgY291bnQgZGV2aWF0aW9uIHVwcGVyIHRocmVzaG9sZCAnLAogICAgICAgICdEZXNjcmlwdGlvbic6ICdUaGlzIHBhcmFtZXRlciByZXByZXNlbnQgdGhlIHVwcGVyIHRocmVzaG9sZCB2YWx1ZSB1cCB0byAnCiAgICAgICAgICAgICAgICAgICAgICAgJ3doaWNoIHRoZSByYXRpbyBiZXR3ZWVuIHJvdXRlIGNvdW50IG9uIHRoZSBzd2l0Y2ggJwogICAgICAgICAgICAgICAgICAgICAgICdhbmQgcm91dGUgY291bnQgb24gdGhlIFZTWCBwZWVyIHN3aXRjaCBpcyBhbGxvd2VkIHRvJwogICAgICAgICAgICAgICAgICAgICAgICcgZGV2aWF0ZS4nLAogICAgICAgICdUeXBlJzogJ2Zsb2F0JywKICAgICAgICAnRGVmYXVsdCc6ICcxLjA1JywKICAgIH0sCiAgICAnbmVpZ2hib3JzX2NvdW50X3JhdGlvX2xvd2VyX3RocmVzaG9sZCc6IHsKICAgICAgICAnTmFtZSc6ICdOZWlnaGJvcnMgY291bnQgZGV2aWF0aW9uIHRocmVzaG9sZCAnLAogICAgICAgICdEZXNjcmlwdGlvbic6ICdUaGlzIHBhcmFtZXRlciByZXByZXNlbnQgdGhlIGxvd2VyIHRocmVzaG9sZCB2YWx1ZSB1cCB0byAnCiAgICAgICAgICAgICAgICAgICAgICAgJ3doaWNoIHRoZSByYXRpbyBiZXR3ZWVuIG5laWdoYm9ycyBjb3VudCBvbiB0aGUgJwogICAgICAgICAgICAgICAgICAgICAgICdzd2l0Y2ggYW5kIG5laWdoYm9ycyBjb3VudCBvbiB0aGUgVlNYIHBlZXIgc3dpdGNoIGlzICcKICAgICAgICAgICAgICAgICAgICAgICAnYWxsb3dlZCB0byBkZXZpYXRlLicsCiAgICAgICAgJ1R5cGUnOiAnZmxvYXQnLAogICAgICAgICdEZWZhdWx0JzogJzAuOTUnLAogICAgfSwKICAgICduZWlnaGJvcnNfY291bnRfcmF0aW9fdXBwZXJfdGhyZXNob2xkJzogewogICAgICAgICdOYW1lJzogJ05laWdoYm9ycyBjb3VudCBkZXZpYXRpb24gdGhyZXNob2xkICcsCiAgICAgICAgJ0Rlc2NyaXB0aW9uJzogJ1RoaXMgcGFyYW1ldGVyIHJlcHJlc2VudCB0aGUgdXBwZXIgdGhyZXNob2xkIHZhbHVlIHVwIHRvICcKICAgICAgICAgICAgICAgICAgICAgICAnd2hpY2ggdGhlIHJhdGlvIGJldHdlZW4gbmVpZ2hib3JzIGNvdW50IG9uIHRoZSAnCiAgICAgICAgICAgICAgICAgICAgICAgJ3N3aXRjaCBhbmQgbmVpZ2hib3JzIGNvdW50IG9uIHRoZSBWU1ggcGVlciBzd2l0Y2ggaXMgJwogICAgICAgICAgICAgICAgICAgICAgICdhbGxvd2VkIHRvIGRldmlhdGUuJywKICAgICAgICAnVHlwZSc6ICdmbG9hdCcsCiAgICAgICAgJ0RlZmF1bHQnOiAnMS4wNScsCiAgICB9LAogICAgJ21hY19hZGRyZXNzZXNfY291bnRfcmF0aW9fbG93ZXJfdGhyZXNob2xkJzogewogICAgICAgICdOYW1lJzogJ01BQyBhZGRyZXNzZXMgY291bnQgZGV2aWF0aW9uIGxvd2VyIHRocmVzaG9sZCAnLAogICAgICAgICdEZXNjcmlwdGlvbic6ICdUaGlzIHBhcmFtZXRlciByZXByZXNlbnQgdGhlIGxvd2VyIHRocmVzaG9sZCB2YWx1ZSB1cCB0byAnCiAgICAgICAgICAgICAgICAgICAgICAgJ3doaWNoIHRoZSByYXRpbyBiZXR3ZWVuIE1BQyBhZGRyZXNzZXMgY291bnQgb24gdGhlICcKICAgICAgICAgICAgICAgICAgICAgICAnc3dpdGNoIGFuZCBNQUMgYWRkcmVzc2VzIGNvdW50IG9uIHRoZSBWU1ggcGVlciBzd2l0Y2ggJwogICAgICAgICAgICAgICAgICAgICAgICdpcyBhbGxvd2VkIHRvIGRldmlhdGUuJywKICAgICAgICAnVHlwZSc6ICdmbG9hdCcsCiAgICAgICAgJ0RlZmF1bHQnOiAnMC45NScsCiAgICB9LAogICAgJ21hY19hZGRyZXNzZXNfY291bnRfcmF0aW9fdXBwZXJfdGhyZXNob2xkJzogewogICAgICAgICdOYW1lJzogJ01BQyBhZGRyZXNzZXMgY291bnQgZGV2aWF0aW9uIHVwcGVyIHRocmVzaG9sZCAnLAogICAgICAgICdEZXNjcmlwdGlvbic6ICdUaGlzIHBhcmFtZXRlciByZXByZXNlbnQgdGhlIHVwcGVyIHRocmVzaG9sZCB2YWx1ZSB1cCB0byAnCiAgICAgICAgICAgICAgICAgICAgICAgJ3doaWNoIHRoZSByYXRpbyBiZXR3ZWVuIE1BQyBhZGRyZXNzZXMgY291bnQgb24gdGhlICcKICAgICAgICAgICAgICAgICAgICAgICAnc3dpdGNoIGFuZCBNQUMgYWRkcmVzc2VzIGNvdW50IG9uIHRoZSBWU1ggcGVlciBzd2l0Y2ggJwogICAgICAgICAgICAgICAgICAgICAgICdpcyBhbGxvd2VkIHRvIGRldmlhdGUuJywKICAgICAgICAnVHlwZSc6ICdmbG9hdCcsCiAgICAgICAgJ0RlZmF1bHQnOiAnMS4wNScsCiAgICB9LAoKICAgICdyYXRlX29mX2RlY3JlYXNlX3RocmVzaG9sZCc6IHsKICAgICAgICAnTmFtZSc6ICdSYXRlIG9mIGRlY3JlYXNlIHRocmVzaG9sZCAoaW4gcGVyY2VudGFnZSknLAogICAgICAgICdEZXNjcmlwdGlvbic6ICdUaGlzIHBhcmFtZXRlciByZXByZXNlbnRzIHRoZSB0aHJlc2hvbGQgdmFsdWUgYWJvdmUgJwogICAgICAgICAgICAgICAgICAgICAgICd3aGljaCB0aGUgcmF0ZSBvZiBkZWNyZWFzZSBvZiBNQUMgYWRkcmVzc2VzIG9uIHRoZSAnCiAgICAgICAgICAgICAgICAgICAgICAgJ3N3aXRjaCBpcyBzdXBwb3NlZCB0byBnZW5lcmF0ZSBhbiBhbGVydC4nCiAgICAgICAgICAgICAgICAgICAgICAgJ1RoZSB0aHJlc2hvbGQgdmFsdWUgaXMgY2FsY3VsYXRlZCBhcyBhIHBlcmNlbnRhZ2Ugb2YnCiAgICAgICAgICAgICAgICAgICAgICAgJ3RoZSBNQUMgYWRkcmVzcyBjb3VudCBhdCB0aGUgYmVnaW5uaW5nIG9mIHRoZSB0aW1lICcKICAgICAgICAgICAgICAgICAgICAgICAnaW50ZXJ2YWwgZHVyaW5nIHdoaWNoIHRoZSByYXRlIGlzIGNhbGN1bGF0ZWQuJywKICAgICAgICAnVHlwZSc6ICdJbnRlZ2VyJywKICAgICAgICAnRGVmYXVsdCc6IDEwCiAgICB9LAogICAgJ3RpbWVfaW50ZXJ2YWxfbWFjJzogewogICAgICAgICdOYW1lJzogJ1RpbWUgaW50ZXJ2YWwgZm9yIGNhbGN1bGF0aW5nIHJhdGUgb2YgZGVjcmVhc2UnLAogICAgICAgICdEZXNjcmlwdGlvbic6ICdUaGlzIHBhcmFtZXRlciByZXByZXNlbnRzIHRoZSB0aW1lIGludGVydmFsIG92ZXIgJwogICAgICAgICAgICAgICAgICAgICAgICd3aGljaCB0aGUgcmF0ZSBvZiBkZWNyZWFzZSBvZiBNQUMgYWRkcmVzc2VzIGNvdW50IGlzJwogICAgICAgICAgICAgICAgICAgICAgICd0byBiZSBjYWxjdWxhdGVkLicsCiAgICAgICAgJ1R5cGUnOiAnSW50ZWdlcicsCiAgICAgICAgJ0RlZmF1bHQnOiAxCiAgICB9LAogICAgJ2Jyb2FkY2FzdF90aHJlc2hvbGQnOiB7CiAgICAgICAgJ05hbWUnOiAnVGhyZXNob2xkIGZvciBicm9hZGNhc3Qgc3Rvcm0gZmF1bHQnLAogICAgICAgICdEZXNjcmlwdGlvbic6CiAgICAgICAgICAgICdUaHJlc2hvbGQgZm9yIHJhdGUgb2YgY2hhbmdlIG9mIGJyb2FkY2FzdCBwYWNrZXRzIG92ZXIgdGltZV9pbnRlcnZhbCBzZWNvbmRzJwogICAgICAgICAgICAnRm9yIGxvdyBzZW5zaXRpdml0eSBsZXZlbCwgc2V0IHRocmVzaG9sZCBhcyAxNzA1MDAsIGZvciBtZWRpdW0gc2Vuc2l0aXZpdHksIHNldCB0aHJlc2hvbGQgJwogICAgICAgICAgICAnYXMgMTAwMDAwLCBmb3IgaGlnaCBzZW5zaXRpdml0eSwgc2V0IHRocmVzaG9sZCBhcyAyOTUwMCcsCiAgICAgICAgJ1R5cGUnOiAnaW50ZWdlcicsCiAgICAgICAgJ0RlZmF1bHQnOiAyOTUwMAogICAgfSwKICAgICd0eF9kcm9wc190aHJlc2hvbGQnOiB7CiAgICAgICAgJ05hbWUnOiAnVGhyZXNob2xkIGZvciB0eCBkcm9wcycsCiAgICAgICAgJ0Rlc2NyaXB0aW9uJzoKICAgICAgICAgICAgJ1RocmVzaG9sZCBmb3IgcmF0aW8gb2YgcmF0ZSBvZiB0eCBkcm9wIHBhY2tldHMob3ZlciBiYW5kd2lkdGgpIG92ZXIgdGltZV9pbnRlcnZhbCBzZWNvbmRzIHRvIHJhdGUgb2YgJwogICAgICAgICAgICAnZ29vZCBmcmFtZXMgb3ZlciAyMCBzZWNvbmRzLiBGb3IgbG93IHNlbnNpdGl2aXR5IGxldmVsLCBzZXQgdGhyZXNob2xkIGFzICcKICAgICAgICAgICAgJzAuMDQ0OSwgZm9yIG1lZGl1bSBzZW5zaXRpdml0eSwgc2V0IGlzIGFzIDAuMDI1NyBhbmQgZm9yIGhpZ2ggc2Vuc2l0aXZpdHksIHNldCBpdCBhcyAwLjAwNjUnLAogICAgICAgICdUeXBlJzogJ2Zsb2F0JywKICAgICAgICAnRGVmYXVsdCc6IDAuMDA2NQogICAgfQp9CgpUaHJlc2hvbGRzID0gewogICAgJ2Jyb2FkY2FzdF9sb3cnOiAxNzA1MDAsCiAgICAnYnJvYWRjYXN0X21lZGl1bSc6IDEwMDAwMCwKICAgICdicm9hZGNhc3RfaGlnaCc6IDI5NTAwLAogICAgJ3R4X2Ryb3BfbG93JzogMC4wNDQ5LAogICAgJ3R4X2Ryb3BfbWVkaXVtJzogMC4wMjU3LAogICAgJ3R4X2Ryb3BfaGlnaCc6IDAuMDA2NX0KCgpjbGFzcyBNQUNDb3VudDoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBhZ2VudCwgYWxtKToKICAgICAgICBzZWxmLm5hbWUgPSBzZWxmLl9fY2xhc3NfXy5fX25hbWVfXwogICAgICAgIHNlbGYuYWdlbnQgPSBhZ2VudAogICAgICAgIHNlbGYuYWxtID0gYWxtCiAgICAgICAgc2VsZi5tb25pdG9ycyA9IHt9CiAgICAgICAgc2VsZi5ydWxlcyA9IHt9CiAgICAgICAgc2VsZi5ncmFwaHMgPSB7fQoKICAgIGRlZiBjcmVhdGVfbW9uaXRvcnMoc2VsZik6CiAgICAgICAgdXJpX21hYyA9ICcvcmVzdC92MS9zeXN0ZW0vdmxhbnMvKi9tYWNzLz9jb3VudCZmaWx0ZXI9c2VsZWN0ZWQ6dHJ1ZScKICAgICAgICBzdW1fbSA9IFN1bSh1cmlfbWFjKQogICAgICAgIHNlbGYubW9uaXRvcnNbJ21hY19jb3VudCddID0gTW9uaXRvcigKICAgICAgICAgICAgc3VtX20sICdUb3RhbCBNQUMgQWRkcmVzc2VzIGNvdW50JykKICAgICAgICByZXR1cm4gbGlzdChzZWxmLm1vbml0b3JzLnZhbHVlcygpKQoKICAgIGRlZiBjcmVhdGVfcnVsZXMoc2VsZik6CiAgICAgICAgc2VsZi5ydWxlc1sndG90YWxfbWFjX2NvdW50J10gPSBSdWxlKCdUb3RhbCBNQUMgQWRkcmVzc2VzIENvdW50JykKICAgICAgICBzZWxmLnJ1bGVzWyd0b3RhbF9tYWNfY291bnQnXS5jb25kaXRpb24oCiAgICAgICAgICAgICd7fSA+IHt9JywgW3NlbGYubW9uaXRvcnNbJ21hY19jb3VudCddLCBzZWxmLmFnZW50LnBhcmFtc1sndGhyZXNob2xkJ11dKQogICAgICAgIHNlbGYucnVsZXNbJ3RvdGFsX21hY19jb3VudCddLmFjdGlvbihzZWxmLnNldF9hbGVydF9hY3Rpb24pCgogICAgICAgIHNlbGYucnVsZXNbJ3RvdGFsX21hY19jb3VudCddLmNsZWFyX2NvbmRpdGlvbigKICAgICAgICAgICAgJ3t9IDwge30nLCBbc2VsZi5tb25pdG9yc1snbWFjX2NvdW50J10sIHNlbGYuYWdlbnQucGFyYW1zWyd0aHJlc2hvbGQnXV0pCiAgICAgICAgc2VsZi5ydWxlc1sndG90YWxfbWFjX2NvdW50J10uY2xlYXJfYWN0aW9uKHNlbGYuY2xlYXJfYWxlcnRfYWN0aW9uKQogICAgICAgIHJldHVybiBsaXN0KHNlbGYucnVsZXMudmFsdWVzKCkpCgogICAgZGVmIGNyZWF0ZV9ncmFwaHMoc2VsZik6CiAgICAgICAgc2VsZi5ncmFwaHNbJ21hY19jb3VudCddID0gXAogICAgICAgICAgICBHcmFwaChbdmFsIGZvciB2YWwgaW4gc2VsZi5tb25pdG9ycy52YWx1ZXMoKV0sCiAgICAgICAgICAgICAgICAgIHRpdGxlPVRpdGxlKCJUb3RhbCBNQUMgYWRkcmVzc2VzIGNvdW50IiksCiAgICAgICAgICAgICAgICAgIGRhc2hib2FyZF9kaXNwbGF5PVRydWUpCiAgICAgICAgcmV0dXJuIGxpc3Qoc2VsZi5ncmFwaHMudmFsdWVzKCkpCgogICAgZGVmIHNldF9hbGVydF9hY3Rpb24oc2VsZiwgZXZlbnQpOgogICAgICAgIHJ1bGVfZGVzY3JpcHRpb24gPSBldmVudFsncnVsZV9kZXNjcmlwdGlvbiddCiAgICAgICAgbWVzc2FnZSA9ICJUaGUgdG90YWwgY291bnQgb2YgTUFDIEFkZHJlc3NlcyBvbiB0aGUgc3dpdGNoIGlzIHt9ICIgXAogICAgICAgICAgICAgICAgICAid2hpY2ggaXMgYWJvdmUgdGhlIHRocmVzaG9sZCB2YWx1ZSBvZiB7fSIuXAogICAgICAgICAgICBmb3JtYXQoZXZlbnRbJ3ZhbHVlJ10sIHN0cihzZWxmLmFnZW50LnBhcmFtc1sndGhyZXNob2xkJ10pKQogICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmluZm8obWVzc2FnZSkKICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9zeXNsb2cobWVzc2FnZSkKICAgICAgICBzZWxmLmFsbS5wdWJsaXNoX2FsZXJ0X2xldmVsKHNlbGYubmFtZSwgcnVsZV9kZXNjcmlwdGlvbiwgJ0NSSVRJQ0FMJykKCiAgICBkZWYgY2xlYXJfYWxlcnRfYWN0aW9uKHNlbGYsIGV2ZW50KToKICAgICAgICBydWxlX2Rlc2NyaXB0aW9uID0gZXZlbnRbJ3J1bGVfZGVzY3JpcHRpb24nXQogICAgICAgIG1lc3NhZ2UgPSAiVGhlIHRvdGFsIGNvdW50IG9mIE1BQyBBZGRyZXNzZXMgaXMgYmFjayB0byBub3JtYWw6IHt9Ii4gXAogICAgICAgICAgICBmb3JtYXQoZXZlbnRbJ3ZhbHVlJ10pCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX3N5c2xvZyhtZXNzYWdlKQogICAgICAgIHNlbGYuYWxtLnB1Ymxpc2hfYWxlcnRfbGV2ZWwoc2VsZi5uYW1lLCBydWxlX2Rlc2NyaXB0aW9uLCAnTk9ORScpCgoKY2xhc3MgTUFDRGVjcmVhc2VSYXRlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGFnZW50LCBhbG0pOgogICAgICAgIHNlbGYubmFtZSA9IHNlbGYuX19jbGFzc19fLl9fbmFtZV9fCiAgICAgICAgc2VsZi5hZ2VudCA9IGFnZW50CiAgICAgICAgc2VsZi5hbG0gPSBhbG0KICAgICAgICBzZWxmLm1vbml0b3JzID0ge30KICAgICAgICBzZWxmLnJ1bGVzID0ge30KICAgICAgICBzZWxmLmdyYXBocyA9IHt9CiAgICAgICAgc2VsZi5VUkkgPSAnL3Jlc3QvdjEvc3lzdGVtL3ZsYW5zLyovbWFjcz9jb3VudCZmaWx0ZXI9c2VsZWN0ZWQ6dHJ1ZScKICAgICAgICAjIEdldCB0aGUgaW5pdGlhbCBNQUMgQWRkcmVzc2VzIGNvdW50IG9uIHRoZSBzd2l0Y2guCiAgICAgICAgaW5pdGlhbF9tYWNfYWRkcmVzc2VzX2NvdW50ID0gc2VsZi5nZXRfcmVzb3VyY2VfY291bnQoKQogICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydyZXNvdXJjZV9jb3VudF92YWx1ZSddID0gc3RyKAogICAgICAgICAgICBpbml0aWFsX21hY19hZGRyZXNzZXNfY291bnQpCgogICAgZGVmIHJlc3RfZ2V0KHNlbGYsIHVybCk6CiAgICAgICAgcmV0dXJuIGdldChIVFRQX0FERFJFU1MgKyB1cmwsIHZlcmlmeT1GYWxzZSwKICAgICAgICAgICAgICAgICAgIHByb3hpZXM9eydodHRwJzogTm9uZSwgJ2h0dHBzJzogTm9uZX0pCgogICAgZGVmIGNyZWF0ZV9tb25pdG9ycyhzZWxmKToKICAgICAgICBzZWxmLm1vbml0b3JzWydtYWNfZGVjcmVhc2UnXSA9IE1vbml0b3IoCiAgICAgICAgICAgIFN1bShzZWxmLlVSSSksICdNQUMgQWRkcmVzcyBjb3VudCBtb25pdG9yJykKICAgICAgICByZXR1cm4gbGlzdChzZWxmLm1vbml0b3JzLnZhbHVlcygpKQoKICAgIGRlZiBjcmVhdGVfcnVsZXMoc2VsZik6CiAgICAgICAgc2VsZi5ydWxlc1snbWFjX3JhdGVfZGVjcmVhc2UnXSA9IFJ1bGUoCiAgICAgICAgICAgICdSYXRlIG9mIGRlY3JlYXNlIG9mIE1BQyBhZGRyZXNzZXMgY291bnQgb24gdGhlIHN3aXRjaCcpCiAgICAgICAgc2VsZi5ydWxlc1snbWFjX3JhdGVfZGVjcmVhc2UnXS5jb25kaXRpb24oCiAgICAgICAgICAgICdldmVyeSB7fSBtaW51dGVzJywgW3NlbGYuYWdlbnQucGFyYW1zWyd0aW1lX2ludGVydmFsX21hYyddXSkKICAgICAgICBzZWxmLnJ1bGVzWydtYWNfcmF0ZV9kZWNyZWFzZSddLmFjdGlvbihzZWxmLmNhbGN1bGF0ZV9kZWNyZWFzZV9yYXRlKQogICAgICAgIHJldHVybiBsaXN0KHNlbGYucnVsZXMudmFsdWVzKCkpCgogICAgZGVmIGNyZWF0ZV9ncmFwaHMoc2VsZik6CiAgICAgICAgc2VsZi5ncmFwaHNbJ21hY19kZWNyZWFzZSddID0gXAogICAgICAgICAgICBHcmFwaChbdmFsIGZvciB2YWwgaW4gc2VsZi5tb25pdG9ycy52YWx1ZXMoKV0sCiAgICAgICAgICAgICAgICAgIHRpdGxlPVRpdGxlKCJNQUMgZGVjcmVhc2UgcmF0ZSIpLAogICAgICAgICAgICAgICAgICBkYXNoYm9hcmRfZGlzcGxheT1GYWxzZSkKICAgICAgICByZXR1cm4gbGlzdChzZWxmLmdyYXBocy52YWx1ZXMoKSkKCiAgICBkZWYgY2FsY3VsYXRlX2RlY3JlYXNlX3JhdGUoc2VsZiwgZXZlbnQpOgogICAgICAgIHJ1bGVfZGVzY3JpcHRpb24gPSBldmVudFsncnVsZV9kZXNjcmlwdGlvbiddCiAgICAgICAgcHJldmlvdXNfY291bnRfdmFsdWUgPSBpbnQoCiAgICAgICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydyZXNvdXJjZV9jb3VudF92YWx1ZSddKQogICAgICAgIGN1cnJlbnRfY291bnRfdmFsdWUgPSBzZWxmLmdldF9yZXNvdXJjZV9jb3VudCgpCiAgICAgICAgY291bnRfZGVjcmVhc2UgPSBwcmV2aW91c19jb3VudF92YWx1ZSAtIGN1cnJlbnRfY291bnRfdmFsdWUKICAgICAgICBkZWNyZWFzZV9yYXRlID0gKGNvdW50X2RlY3JlYXNlIC8gaW50KHN0cihzZWxmLmFnZW50LnBhcmFtc1sKICAgICAgICAgICAgJ3RpbWVfaW50ZXJ2YWxfbWFjJ10pKSkKICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1sncmVzb3VyY2VfY291bnRfdmFsdWUnXSA9IHN0cihjdXJyZW50X2NvdW50X3ZhbHVlKQogICAgICAgIHNlbGYudXBkYXRlX2FsZXJ0X2xldmVsKAogICAgICAgICAgICBydWxlX2Rlc2NyaXB0aW9uLCBkZWNyZWFzZV9yYXRlLCBwcmV2aW91c19jb3VudF92YWx1ZSkKCiAgICBkZWYgdXBkYXRlX2FsZXJ0X2xldmVsKAogICAgICAgICAgICBzZWxmLAogICAgICAgICAgICBydWxlX2Rlc2NyaXB0aW9uLAogICAgICAgICAgICBkZWNyZWFzZV9yYXRlLAogICAgICAgICAgICBwcmV2aW91c19jb3VudF92YWx1ZSk6CiAgICAgICAgaWYgZGVjcmVhc2VfcmF0ZSA8IDA6CiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBpZiBkZWNyZWFzZV9yYXRlID09IDA6CiAgICAgICAgICAgIHJ1bGVfYWxlcnRfbGV2ZWwgPSBzZWxmLmFsbS5nZXRfcnVsZV9hbGVydF9sZXZlbCgKICAgICAgICAgICAgICAgIHNlbGYubmFtZSwgcnVsZV9kZXNjcmlwdGlvbikKICAgICAgICAgICAgaWYgcnVsZV9hbGVydF9sZXZlbCA9PSAnTk9ORSc6CiAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAgICAgZGVjcmVhc2VfcGVyY2VudGFnZSA9ICgKICAgICAgICAgICAgZGVjcmVhc2VfcmF0ZSAvCiAgICAgICAgICAgIGZsb2F0KHByZXZpb3VzX2NvdW50X3ZhbHVlKSAqCiAgICAgICAgICAgIDEwMCkKICAgICAgICBpZiBkZWNyZWFzZV9wZXJjZW50YWdlID4gaW50KHN0cigKICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQucGFyYW1zWydyYXRlX29mX2RlY3JlYXNlX3RocmVzaG9sZCddKSk6CiAgICAgICAgICAgIG1lc3NhZ2UgPSAnVGhlIHJhdGUgb2YgZGVjcmVhc2Ugb2YgdGhlIE1BQyBhZGRyZXNzZXMgb24gJyBcCiAgICAgICAgICAgICAgICAndGhlIHN3aXRjaCB3aGljaCBpcyB7fSBpcyBncmVhdGVyIHRoYW4gdGhlICcgXAogICAgICAgICAgICAgICAgJ3RocmVzaG9sZCB2YWx1ZSAnIFwKICAgICAgICAgICAgICAgICdvZiB7fScuZm9ybWF0KHN0cihkZWNyZWFzZV9wZXJjZW50YWdlKSwgc3RyKAogICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQucGFyYW1zWydyYXRlX29mX2RlY3JlYXNlX3RocmVzaG9sZCddKSkKICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9jdXN0b21fcmVwb3J0KG1lc3NhZ2UpCiAgICAgICAgICAgIHNlbGYuYWxtLnB1Ymxpc2hfYWxlcnRfbGV2ZWwoCiAgICAgICAgICAgICAgICBzZWxmLm5hbWUsIHJ1bGVfZGVzY3JpcHRpb24sICdDUklUSUNBTCcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbWVzc2FnZSA9ICdUaGUgcmF0ZSBvZiBkZWNyZWFzZSBvZiB0aGUgTUFDIGFkZHJlc3NlcyBvbiAnIFwKICAgICAgICAgICAgICAgICAgICAgICd0aGUgc3dpdGNoIHdoaWNoIGlzIHt9IGlzIGxlc3NlciB0aGFuIHRoZSAnIFwKICAgICAgICAgICAgICAgICAgICAgICd0aHJlc2hvbGQgdmFsdWUgJyBcCiAgICAgICAgICAgICAgICAgICAgICAnb2Yge30nLmZvcm1hdChzdHIoZGVjcmVhc2VfcGVyY2VudGFnZSksIHN0cigKICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnBhcmFtc1sncmF0ZV9vZl9kZWNyZWFzZV90aHJlc2hvbGQnXSkpCiAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmluZm8obWVzc2FnZSkKICAgICAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fY3VzdG9tX3JlcG9ydChtZXNzYWdlKQogICAgICAgICAgICBzZWxmLmFsbS5wdWJsaXNoX2FsZXJ0X2xldmVsKHNlbGYubmFtZSwgcnVsZV9kZXNjcmlwdGlvbiwgJ05PTkUnKQoKICAgIGRlZiBnZXRfcmVzb3VyY2VfY291bnQoc2VsZik6CiAgICAgICAgY291bnQgPSAwCiAgICAgICAgdHJ5OgogICAgICAgICAgICByID0gc2VsZi5yZXN0X2dldChzZWxmLlVSSSkKICAgICAgICAgICAgci5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgY291bnQgPSByLmpzb24oKVsiY291bnQiXQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoIkVycm9yIHdoaWxlIG1ha2luZyBSRVNUIGNhbGwgdG8gVVJJICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInt9IDoge30iLmZvcm1hdChzZWxmLlVSSSwgc3RyKGUpKSkKICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZXJyb3IoIkVycm9yIHdoaWxlIG1ha2luZyBSRVNUIGNhbGwgdG8gVVJJICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInt9Ii5mb3JtYXQoc2VsZi5VUkkpKQogICAgICAgIHJldHVybiBjb3VudAoKCmNsYXNzIERhZW1vblJlc291cmNlOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGFnZW50LCBhbG0pOgogICAgICAgIHNlbGYubmFtZSA9IHNlbGYuX19jbGFzc19fLl9fbmFtZV9fCiAgICAgICAgc2VsZi5hZ2VudCA9IGFnZW50CiAgICAgICAgc2VsZi5hbG0gPSBhbG0KICAgICAgICBzZWxmLm1vbml0b3JzID0ge30KICAgICAgICBzZWxmLnJ1bGVzID0ge30KICAgICAgICBzZWxmLmdyYXBocyA9IHt9CiAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ2hpZ2hfY3B1X2RhZW1vbnMnXSA9ICcnCiAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ2hpZ2hfbWVtb3J5X2RhZW1vbnMnXSA9ICcnCiAgICAgICAgc2VsZi5jcHVfdXJpID0gJy9yZXN0L3YxL3N5c3RlbS9zdWJzeXN0ZW1zLyovKi9kYWVtb25zL3t9PycgXAogICAgICAgICAgICAnYXR0cmlidXRlcz1yZXNvdXJjZV91dGlsaXphdGlvbi5jcHUmZmlsdGVyPW5hbWU6e30nCiAgICAgICAgc2VsZi5tZW1fdXJpID0gJy9yZXN0L3YxL3N5c3RlbS9zdWJzeXN0ZW1zLyovKi9kYWVtb25zL3t9PycgXAogICAgICAgICAgICAnYXR0cmlidXRlcz1yZXNvdXJjZV91dGlsaXphdGlvbi5tZW1vcnkmZmlsdGVyPW5hbWU6e30nCgogICAgZGVmIGNyZWF0ZV9tb25pdG9ycyhzZWxmKToKICAgICAgICBmb3IgaSBpbiByYW5nZSgxLCA1KToKICAgICAgICAgICAgZGFlbW9uX25hbWVfdmFyID0gJ2RhZW1vbl8nICsgc3RyKGkpCiAgICAgICAgICAgIGRhZW1vbl9uYW1lID0gc2VsZi5hZ2VudC5wYXJhbXNbZGFlbW9uX25hbWVfdmFyXS52YWx1ZQogICAgICAgICAgICBkYWVtb25fbmFtZSA9IGRhZW1vbl9uYW1lLnN0cmlwKCkKICAgICAgICAgICAgaWYgbm90IGRhZW1vbl9uYW1lOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGNwdV9tb24gPSAibW9uaXRvcl9kYWVtb25fIiArIHN0cihpKSArICJfY3B1IgogICAgICAgICAgICBtZW1fbW9uID0gIm1vbml0b3JfZGFlbW9uXyIgKyBzdHIoaSkgKyAiX21lbSIKICAgICAgICAgICAgc2VsZi5tb25pdG9yc1tjcHVfbW9uXSA9IE1vbml0b3IoCiAgICAgICAgICAgICAgICBzZWxmLmNwdV91cmksIGRhZW1vbl9uYW1lX3ZhciArCiAgICAgICAgICAgICAgICAnIENQVSAoQ1BVL01lbW9yeSB1dGlsaXphdGlvbiBpbiAlKScsCiAgICAgICAgICAgICAgICBbc2VsZi5hZ2VudC5wYXJhbXNbZGFlbW9uX25hbWVfdmFyXSwgc2VsZi5hZ2VudC5wYXJhbXNbZGFlbW9uX25hbWVfdmFyXV0pCiAgICAgICAgICAgIHNlbGYubW9uaXRvcnNbbWVtX21vbl0gPSBNb25pdG9yKAogICAgICAgICAgICAgICAgc2VsZi5tZW1fdXJpLCBkYWVtb25fbmFtZV92YXIgKwogICAgICAgICAgICAgICAgJyBNZW1vcnkgKENQVS9NZW1vcnkgdXRpbGl6YXRpb24gaW4gJSknLAogICAgICAgICAgICAgICAgW3NlbGYuYWdlbnQucGFyYW1zW2RhZW1vbl9uYW1lX3Zhcl0sIHNlbGYuYWdlbnQucGFyYW1zW2RhZW1vbl9uYW1lX3Zhcl1dKQogICAgICAgIHJldHVybiBsaXN0KHNlbGYubW9uaXRvcnMudmFsdWVzKCkpCgogICAgZGVmIGNyZWF0ZV9ydWxlcyhzZWxmKToKICAgICAgICBmb3IgaSBpbiByYW5nZSgxLCA1KToKICAgICAgICAgICAgZGFlbW9uX25hbWVfdmFyID0gJ2RhZW1vbl8nICsgc3RyKGkpCiAgICAgICAgICAgIGRhZW1vbl9uYW1lID0gc2VsZi5hZ2VudC5wYXJhbXNbZGFlbW9uX25hbWVfdmFyXS52YWx1ZQogICAgICAgICAgICBkYWVtb25fbmFtZSA9IGRhZW1vbl9uYW1lLnN0cmlwKCkKICAgICAgICAgICAgaWYgbm90IGRhZW1vbl9uYW1lOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGNwdV9tb24gPSAibW9uaXRvcl9kYWVtb25fIiArIHN0cihpKSArICJfY3B1IgogICAgICAgICAgICBjcHVfcnVsZSA9ICJoaWdoX2NwdV9kYWVtb24iICsgc3RyKGkpCiAgICAgICAgICAgIHNlbGYucnVsZXNbY3B1X3J1bGVdID0gUnVsZSgKICAgICAgICAgICAgICAgICdIaWdoIENQVSB1dGlsaXphdGlvbiBieSAnICsgZGFlbW9uX25hbWUpCiAgICAgICAgICAgIHNlbGYucnVsZXNbY3B1X3J1bGVdLmNvbmRpdGlvbigKICAgICAgICAgICAgICAgICd7fSA+PSB7fSBmb3Ige30gc2Vjb25kcycsCiAgICAgICAgICAgICAgICBbc2VsZi5tb25pdG9yc1tjcHVfbW9uXSwKICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnBhcmFtc1snY3B1X3RocmVzaG9sZCddLAogICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQucGFyYW1zWyd0aW1lX2ludGVydmFsJ11dKQogICAgICAgICAgICBzZWxmLnJ1bGVzW2NwdV9ydWxlXS5hY3Rpb24oc2VsZi5hY3Rpb25faGlnaF9jcHUpCiAgICAgICAgICAgIHNlbGYucnVsZXNbY3B1X3J1bGVdLmNsZWFyX2NvbmRpdGlvbigne30gPCB7fSBmb3Ige30gc2Vjb25kcycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbc2VsZi5tb25pdG9yc1tjcHVfbW9uXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnBhcmFtc1snY3B1X3RocmVzaG9sZCddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQucGFyYW1zWyd0aW1lX2ludGVydmFsJ11dKQogICAgICAgICAgICBzZWxmLnJ1bGVzW2NwdV9ydWxlXS5jbGVhcl9hY3Rpb24oc2VsZi5hY3Rpb25fbm9ybWFsX2NwdSkKCiAgICAgICAgICAgIG1lbV9tb24gPSAibW9uaXRvcl9kYWVtb25fIiArIHN0cihpKSArICJfbWVtIgogICAgICAgICAgICBtZW1fcnVsZSA9ICJoaWdoX21lbV9kYWVtb25fIiArIHN0cihpKQogICAgICAgICAgICBzZWxmLnJ1bGVzW21lbV9ydWxlXSA9IFJ1bGUoCiAgICAgICAgICAgICAgICAnSGlnaCBNZW1vcnkgdXRpbGl6YXRpb24gYnkgJyArIGRhZW1vbl9uYW1lKQogICAgICAgICAgICBzZWxmLnJ1bGVzW21lbV9ydWxlXS5jb25kaXRpb24oCiAgICAgICAgICAgICAgICAne30gPj0ge30gZm9yIHt9IHNlY29uZHMnLAogICAgICAgICAgICAgICAgW3NlbGYubW9uaXRvcnNbbWVtX21vbl0sCiAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5wYXJhbXNbJ21lbW9yeV90aHJlc2hvbGQnXSwKICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnBhcmFtc1sndGltZV9pbnRlcnZhbCddXSkKICAgICAgICAgICAgc2VsZi5ydWxlc1ttZW1fcnVsZV0uYWN0aW9uKHNlbGYuYWN0aW9uX2hpZ2hfbWVtb3J5KQogICAgICAgICAgICBzZWxmLnJ1bGVzW21lbV9ydWxlXS5jbGVhcl9jb25kaXRpb24oCiAgICAgICAgICAgICAgICAne30gPCB7fSBmb3Ige30gc2Vjb25kcycsCiAgICAgICAgICAgICAgICBbc2VsZi5tb25pdG9yc1ttZW1fbW9uXSwKICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnBhcmFtc1snbWVtb3J5X3RocmVzaG9sZCddLAogICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQucGFyYW1zWyd0aW1lX2ludGVydmFsJ11dKQogICAgICAgICAgICBzZWxmLnJ1bGVzW21lbV9ydWxlXS5jbGVhcl9hY3Rpb24oc2VsZi5hY3Rpb25fbm9ybWFsX21lbW9yeSkKICAgICAgICByZXR1cm4gbGlzdChzZWxmLnJ1bGVzLnZhbHVlcygpKQoKICAgIGRlZiBjcmVhdGVfZ3JhcGhzKHNlbGYpOgogICAgICAgIHNlbGYuZ3JhcGhzWydkYWVtb25fcmVzb3VyY2UnXSA9IFwKICAgICAgICAgICAgR3JhcGgoW3ZhbCBmb3IgdmFsIGluIHNlbGYubW9uaXRvcnMudmFsdWVzKCldLAogICAgICAgICAgICAgICAgICB0aXRsZT1UaXRsZSgiRGFlbW9uIFJlc291cmNlIE1vbml0b3IiKSwKICAgICAgICAgICAgICAgICAgZGFzaGJvYXJkX2Rpc3BsYXk9RmFsc2UpCiAgICAgICAgcmV0dXJuIGxpc3Qoc2VsZi5ncmFwaHMudmFsdWVzKCkpCgogICAgZGVmIGFjdGlvbl9oaWdoX2NwdShzZWxmLCBldmVudCk6CiAgICAgICAgcnVsZV9kZXNjcmlwdGlvbiA9IGV2ZW50WydydWxlX2Rlc2NyaXB0aW9uJ10KICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5kZWJ1ZygiPT09PT09PSBISUdIIENQVSA9PT09PT09PT09PT0iKQogICAgICAgIGxhYmVsID0gZXZlbnRbJ2xhYmVscyddCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoJ2xhYmVsOiBbJyArIGxhYmVsICsgJ10nKQogICAgICAgIF8sIGRhZW1vbiA9IGxhYmVsLnNwbGl0KCcsJylbMF0uc3BsaXQoJz0nKQogICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKCdkYWVtb24gLSAnICsgZGFlbW9uKQogICAgICAgIGhpZ2hfY3B1X2RhZW1vbnMgPSBzZWxmLmFnZW50LnZhcmlhYmxlc1snaGlnaF9jcHVfZGFlbW9ucyddCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICdoaWdoX2NwdV9kYWVtb25zIGJlZm9yZTogWycgKyBoaWdoX2NwdV9kYWVtb25zICsgJ10nKQogICAgICAgIGlmIGRhZW1vbiBub3QgaW4gaGlnaF9jcHVfZGFlbW9uczoKICAgICAgICAgICAgaGlnaF9jcHVfZGFlbW9ucyA9IGhpZ2hfY3B1X2RhZW1vbnMgKyBkYWVtb24KICAgICAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ2hpZ2hfY3B1X2RhZW1vbnMnXSA9IGhpZ2hfY3B1X2RhZW1vbnMKICAgICAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fc3lzbG9nKAogICAgICAgICAgICAgICAgJ0hpZ2ggQ1BVIHV0aWxpemF0aW9uIGJ5IGRhZW1vbiAnICsgZGFlbW9uKQogICAgICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9jbGkoCiAgICAgICAgICAgICAgICAnc2hvdyBzeXN0ZW0gcmVzb3VyY2UtdXRpbGl6YXRpb24gZGFlbW9uICcgKyBkYWVtb24pCiAgICAgICAgICAgIHNlbGYuYWxtLnB1Ymxpc2hfYWxlcnRfbGV2ZWwoCiAgICAgICAgICAgICAgICBzZWxmLm5hbWUsIHJ1bGVfZGVzY3JpcHRpb24sICdDUklUSUNBTCcpCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICdoaWdoX2NwdV9kYWVtb25zIGFmdGVyOiBbJyArIGhpZ2hfY3B1X2RhZW1vbnMgKyAnXScpCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoIj09PT09PT0gL0hJR0ggQ1BVID09PT09PT09PT09IikKCiAgICBkZWYgYWN0aW9uX25vcm1hbF9jcHUoc2VsZiwgZXZlbnQpOgogICAgICAgIHJ1bGVfZGVzY3JpcHRpb24gPSBldmVudFsncnVsZV9kZXNjcmlwdGlvbiddCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoIj09PT09PT0gTm9ybWFsIENQVSA9PT09PT09PT0iKQogICAgICAgIGxhYmVsID0gZXZlbnRbJ2xhYmVscyddCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoJ2xhYmVsOiBbJyArIGxhYmVsICsgJ10nKQogICAgICAgIF8sIGRhZW1vbiA9IGxhYmVsLnNwbGl0KCcsJylbMF0uc3BsaXQoJz0nKQogICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKCdkYWVtb24gLSAnICsgZGFlbW9uKQogICAgICAgIGhpZ2hfY3B1X2RhZW1vbnMgPSBzZWxmLmFnZW50LnZhcmlhYmxlc1snaGlnaF9jcHVfZGFlbW9ucyddCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICdoaWdoX2NwdV9kYWVtb25zIGJlZm9yZTogWycgKyBoaWdoX2NwdV9kYWVtb25zICsgJ10nKQogICAgICAgIGlmIGRhZW1vbiBpbiBoaWdoX2NwdV9kYWVtb25zOgogICAgICAgICAgICBoaWdoX2NwdV9kYWVtb25zID0gaGlnaF9jcHVfZGFlbW9ucy5yZXBsYWNlKGRhZW1vbiwgJycpCiAgICAgICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydoaWdoX2NwdV9kYWVtb25zJ10gPSBoaWdoX2NwdV9kYWVtb25zCiAgICAgICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX3N5c2xvZygKICAgICAgICAgICAgICAgICdDUFUgdXRpbGl6YXRpb24gYmFjayB0byBOb3JtYWwgZm9yIGRhZW1vbiAnICsgZGFlbW9uKQogICAgICAgICAgICBzZWxmLmFsbS5wdWJsaXNoX2FsZXJ0X2xldmVsKAogICAgICAgICAgICAgICAgc2VsZi5uYW1lLCBydWxlX2Rlc2NyaXB0aW9uLCAnTk9ORScpCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICdoaWdoX2NwdV9kYWVtb25zIGFmdGVyOiBbJyArIGhpZ2hfY3B1X2RhZW1vbnMgKyAnXScpCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoIj09PT09PT09PSAvTm9ybWFsIENQVSA9PT09PT09PSIpCgogICAgZGVmIGFjdGlvbl9oaWdoX21lbW9yeShzZWxmLCBldmVudCk6CiAgICAgICAgcnVsZV9kZXNjcmlwdGlvbiA9IGV2ZW50WydydWxlX2Rlc2NyaXB0aW9uJ10KICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5kZWJ1ZygiPT09PT09PSBIaWdoIE1lbW9yeSA9PT09PT09PT09PT0iKQogICAgICAgIGxhYmVsID0gZXZlbnRbJ2xhYmVscyddCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoJ2xhYmVsOiBbJyArIGxhYmVsICsgJ10nKQogICAgICAgIF8sIGRhZW1vbiA9IGxhYmVsLnNwbGl0KCcsJylbMF0uc3BsaXQoJz0nKQogICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKCdkYWVtb24gLSAnICsgZGFlbW9uKQogICAgICAgIGhpZ2hfbWVtb3J5X2RhZW1vbnMgPSBzZWxmLmFnZW50LnZhcmlhYmxlc1snaGlnaF9tZW1vcnlfZGFlbW9ucyddCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICdoaWdoX21lbW9yeV9kYWVtb25zIGJlZm9yZTogWycgKyBoaWdoX21lbW9yeV9kYWVtb25zICsgJ10nKQogICAgICAgIGlmIGRhZW1vbiBub3QgaW4gaGlnaF9tZW1vcnlfZGFlbW9uczoKICAgICAgICAgICAgaGlnaF9tZW1vcnlfZGFlbW9ucyA9IGhpZ2hfbWVtb3J5X2RhZW1vbnMgKyBkYWVtb24KICAgICAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ2hpZ2hfbWVtb3J5X2RhZW1vbnMnXSA9IGhpZ2hfbWVtb3J5X2RhZW1vbnMKICAgICAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fc3lzbG9nKAogICAgICAgICAgICAgICAgJ0hpZ2ggTWVtb3J5IHV0aWxpemF0aW9uIGJ5IGRhZW1vbiAnICsgZGFlbW9uKQogICAgICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9jbGkoCiAgICAgICAgICAgICAgICAnc2hvdyBzeXN0ZW0gcmVzb3VyY2UtdXRpbGl6YXRpb24gZGFlbW9uICcgKyBkYWVtb24pCiAgICAgICAgICAgIHNlbGYuYWxtLnB1Ymxpc2hfYWxlcnRfbGV2ZWwoCiAgICAgICAgICAgICAgICBzZWxmLm5hbWUsIHJ1bGVfZGVzY3JpcHRpb24sICdDUklUSUNBTCcpCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICdoaWdoX21lbW9yeV9kYWVtb25zIGFmdGVyOiBbJyArIGhpZ2hfbWVtb3J5X2RhZW1vbnMgKyAnXScpCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoIj09PT09PT0gL0hpZ2ggTWVtb3J5ID09PT09PT09PT09IikKCiAgICBkZWYgYWN0aW9uX25vcm1hbF9tZW1vcnkoc2VsZiwgZXZlbnQpOgogICAgICAgIHJ1bGVfZGVzY3JpcHRpb24gPSBldmVudFsncnVsZV9kZXNjcmlwdGlvbiddCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoIj09PT09PT0gTm9ybWFsIE1lbW9yeSA9PT09PT09PT0iKQogICAgICAgIGxhYmVsID0gZXZlbnRbJ2xhYmVscyddCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoJ2xhYmVsOiBbJyArIGxhYmVsICsgJ10nKQogICAgICAgIF8sIGRhZW1vbiA9IGxhYmVsLnNwbGl0KCcsJylbMF0uc3BsaXQoJz0nKQogICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKCdkYWVtb24gLSAnICsgZGFlbW9uKQogICAgICAgIGhpZ2hfbWVtb3J5X2RhZW1vbnMgPSBzZWxmLmFnZW50LnZhcmlhYmxlc1snaGlnaF9tZW1vcnlfZGFlbW9ucyddCiAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICdoaWdoX21lbW9yeV9kYWVtb25zIGJlZm9yZTogWycgKyBoaWdoX21lbW9yeV9kYWVtb25zICsgJ10nKQogICAgICAgIGlmIGRhZW1vbiBpbiBoaWdoX21lbW9yeV9kYWVtb25zOgogICAgICAgICAgICBoaWdoX21lbW9yeV9kYWVtb25zID0gaGlnaF9tZW1vcnlfZGFlbW9ucy5yZXBsYWNlKGRhZW1vbiwgJycpCiAgICAgICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydoaWdoX21lbW9yeV9kYWVtb25zJ10gPSBoaWdoX21lbW9yeV9kYWVtb25zCiAgICAgICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX3N5c2xvZygKICAgICAgICAgICAgICAgICdNZW1vcnkgdXRpbGl6YXRpb24gYmFjayB0byBOb3JtYWwgZm9yIGRhZW1vbiAnICsKICAgICAgICAgICAgICAgIGRhZW1vbikKICAgICAgICAgICAgc2VsZi5hbG0ucHVibGlzaF9hbGVydF9sZXZlbCgKICAgICAgICAgICAgICAgIHNlbGYubmFtZSwgcnVsZV9kZXNjcmlwdGlvbiwgJ05PTkUnKQogICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKAogICAgICAgICAgICAnaGlnaF9tZW1vcnlfZGFlbW9ucyBhZnRlcjogWycgKyBoaWdoX21lbW9yeV9kYWVtb25zICsgJ10nKQogICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKCI9PT09PT09PT0gL05vcm1hbCBNZW1vcnkgPT09PT09PT0iKQoKCmNsYXNzIEZhdWx0RmluZGVyOgogICAgSU5GSU5JVFkgPSBmbG9hdCgiaW5mIikKCiAgICBkZWYgX19pbml0X18oc2VsZiwgYWdlbnQsIGFsbSk6CiAgICAgICAgc2VsZi5uYW1lID0gc2VsZi5fX2NsYXNzX18uX19uYW1lX18KICAgICAgICBzZWxmLmFnZW50ID0gYWdlbnQKICAgICAgICBzZWxmLmFsbSA9IGFsbQogICAgICAgIHNlbGYubW9uaXRvcnMgPSB7fQogICAgICAgIHNlbGYucnVsZXMgPSB7fQogICAgICAgIHNlbGYuZ3JhcGhzID0ge30KICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1snbGlua3Nfd2l0aF9hbGVydCddID0gJycKCiAgICBkZWYgY3JlYXRlX21vbml0b3JzKHNlbGYpOgogICAgICAgICMgQnJvYWRjYXN0IHBhY2tldHMKICAgICAgICB1cmkxID0gJy9yZXN0L3YxL3N5c3RlbS9pbnRlcmZhY2VzLyo/YXR0cmlidXRlcz1zdGF0aXN0aWNzLmlmX2hjX2luX2Jyb2FkY2FzdF9wYWNrZXRzJyArIFwKICAgICAgICAgICAgJyZmaWx0ZXI9dHlwZTpzeXN0ZW0nCiAgICAgICAgYnJvYWRjYXN0X3VyaSA9IFJhdGUodXJpMSwgJzYwIHNlY29uZHMnKQogICAgICAgIHNlbGYubW9uaXRvcnNbJ2ZhdWx0X2ZpbmRlcjEnXSA9IE1vbml0b3IoCiAgICAgICAgICAgIGJyb2FkY2FzdF91cmksICdSYXRlIG9mIGludGVyZmFjZSBicm9hZGNhc3QgcGFja2V0cyAocGFja2V0cy9zKScpCgogICAgICAgICMgT3ZlciBiYW5kd2lkdGgKICAgICAgICB1cmk1ID0gJy9yZXN0L3YxL3N5c3RlbS9pbnRlcmZhY2VzLyo/YXR0cmlidXRlcz1zdGF0aXN0aWNzLnR4X2Ryb3BwZWQnICsgXAogICAgICAgICAgICAnJmZpbHRlcj10eXBlOnN5c3RlbScKICAgICAgICB0eF9kcm9wX3VyaSA9IFJhdGUodXJpNSwgJzIwIHNlY29uZHMnKQogICAgICAgIHNlbGYubW9uaXRvcnNbJ2ZhdWx0X2ZpbmRlcjUnXSA9IE1vbml0b3IoCiAgICAgICAgICAgIHR4X2Ryb3BfdXJpLCAnUmF0ZSBvZiB0eCBkcm9wIHBhY2tldHMgKHBhY2tldHMvcyknKQogICAgICAgICMgR29vZCBmcmFtZXModHhfbm9fZXJyb3JzKQogICAgICAgIHVyaTYgPSAnL3Jlc3QvdjEvc3lzdGVtL2ludGVyZmFjZXMvKj9hdHRyaWJ1dGVzPXN0YXRpc3RpY3MuZXRoZXJuZXRfc3RhdHNfdHhfbm9fZXJyb3JzJyArIFwKICAgICAgICAgICAgJyZmaWx0ZXI9dHlwZTpzeXN0ZW0nCiAgICAgICAgZ29vZF9mcmFtZXNfdXJpX3R4ID0gUmF0ZSh1cmk2LCAnMjAgc2Vjb25kcycpCiAgICAgICAgc2VsZi5tb25pdG9yc1snZmF1bHRfZmluZGVyNiddID0gTW9uaXRvcigKICAgICAgICAgICAgZ29vZF9mcmFtZXNfdXJpX3R4LCAnUmF0ZSBvZiBpbnRlcmZhY2UgdHggZ29vZCBmcmFtZXMgKHBhY2tldHMvcyknKQogICAgICAgIHJldHVybiBsaXN0KHNlbGYubW9uaXRvcnMudmFsdWVzKCkpCgogICAgZGVmIGNyZWF0ZV9ydWxlcyhzZWxmKToKICAgICAgICBzZWxmLnJ1bGVzWydicm9hZGNhc3Rfc3Rvcm1fZmF1bHQnXSA9IFJ1bGUoJ0Jyb2FkY2FzdCBzdG9ybSBmYXVsdCcpCiAgICAgICAgc2VsZi5ydWxlc1snYnJvYWRjYXN0X3N0b3JtX2ZhdWx0J10uY29uZGl0aW9uKAogICAgICAgICAgICAne30gPj0ge30nLCBbCiAgICAgICAgICAgICAgICBzZWxmLm1vbml0b3JzWydmYXVsdF9maW5kZXIxJ10sIHNlbGYuYWdlbnQucGFyYW1zWydicm9hZGNhc3RfdGhyZXNob2xkJ11dKQogICAgICAgIHNlbGYucnVsZXNbJ2Jyb2FkY2FzdF9zdG9ybV9mYXVsdCddLmFjdGlvbigKICAgICAgICAgICAgc2VsZi5hY3Rpb25fYnJvYWRjYXN0X3NlbnNpdGl2aXR5KQogICAgICAgIHNlbGYucnVsZXNbJ2Jyb2FkY2FzdF9zdG9ybV9mYXVsdCddLmNsZWFyX2NvbmRpdGlvbigKICAgICAgICAgICAgJ3t9IDwge30nLCBbCiAgICAgICAgICAgICAgICBzZWxmLm1vbml0b3JzWydmYXVsdF9maW5kZXIxJ10sIHNlbGYuYWdlbnQucGFyYW1zWydicm9hZGNhc3RfdGhyZXNob2xkJ11dKQogICAgICAgIHNlbGYucnVsZXNbJ2Jyb2FkY2FzdF9zdG9ybV9mYXVsdCddLmNsZWFyX2FjdGlvbigKICAgICAgICAgICAgc2VsZi5hY3Rpb25fY2xlYXJfYnJvYWRjYXN0X3NlbnNpdGl2aXR5KQoKICAgICAgICBzZWxmLnJ1bGVzWydvdmVyX2JhbmR3aWR0aF9mYXVsdCddID0gUnVsZSgnT3ZlciBiYW5kd2lkdGggZmF1bHQnKQogICAgICAgIHNlbGYucnVsZXNbJ292ZXJfYmFuZHdpZHRoX2ZhdWx0J10uY29uZGl0aW9uKAogICAgICAgICAgICAncmF0aW8gb2Yge30gYW5kIHt9ID49IHt9JywgW3NlbGYubW9uaXRvcnNbJ2ZhdWx0X2ZpbmRlcjUnXSwgc2VsZi5tb25pdG9yc1snZmF1bHRfZmluZGVyNiddLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQucGFyYW1zWyd0eF9kcm9wc190aHJlc2hvbGQnXV0pCiAgICAgICAgc2VsZi5ydWxlc1snb3Zlcl9iYW5kd2lkdGhfZmF1bHQnXS5hY3Rpb24oCiAgICAgICAgICAgIHNlbGYuYWN0aW9uX292ZXJfYmFuZHdpZHRoX3NlbnNpdGl2aXR5KQogICAgICAgIHNlbGYucnVsZXNbJ292ZXJfYmFuZHdpZHRoX2ZhdWx0J10uY2xlYXJfY29uZGl0aW9uKAogICAgICAgICAgICAncmF0aW8gb2Yge30gYW5kIHt9IDwge30nLCBbc2VsZi5tb25pdG9yc1snZmF1bHRfZmluZGVyNSddLCBzZWxmLm1vbml0b3JzWydmYXVsdF9maW5kZXI2J10sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnBhcmFtc1sndHhfZHJvcHNfdGhyZXNob2xkJ11dKQogICAgICAgIHNlbGYucnVsZXNbJ292ZXJfYmFuZHdpZHRoX2ZhdWx0J10uY2xlYXJfYWN0aW9uKAogICAgICAgICAgICBzZWxmLmFjdGlvbl9jbGVhcl9vdmVyX2JhbmR3aWR0aF9zZW5zaXRpdml0eSkKICAgICAgICByZXR1cm4gbGlzdChzZWxmLnJ1bGVzLnZhbHVlcygpKQoKICAgIGRlZiBjcmVhdGVfZ3JhcGhzKHNlbGYpOgogICAgICAgIHNlbGYuZ3JhcGhzWydmYXVsdF9maW5kZXInXSA9IFwKICAgICAgICAgICAgR3JhcGgoW3ZhbCBmb3IgdmFsIGluIHNlbGYubW9uaXRvcnMudmFsdWVzKCldLAogICAgICAgICAgICAgICAgICB0aXRsZT1UaXRsZSgiRmF1bHQgRmluZGVyIC0gUy9XIiksCiAgICAgICAgICAgICAgICAgIGRhc2hib2FyZF9kaXNwbGF5PUZhbHNlKQogICAgICAgIHJldHVybiBsaXN0KHNlbGYuZ3JhcGhzLnZhbHVlcygpKQoKICAgIGRlZiBnZXRfaW50ZXJmYWNlKHNlbGYsIGV2ZW50KToKICAgICAgICBsYWJlbCA9IGV2ZW50WydsYWJlbHMnXQogICAgICAgIGZpcnN0ID0gJz0nCiAgICAgICAgbGFzdCA9ICcsVGltZUludGVydmFsJwogICAgICAgIHRyeToKICAgICAgICAgICAgc3RhcnQgPSBsYWJlbC5pbmRleChmaXJzdCkgKyBsZW4oZmlyc3QpCiAgICAgICAgICAgIGVuZCA9IGxhYmVsLmluZGV4KGxhc3QsIHN0YXJ0KQogICAgICAgICAgICByZXR1cm4gbGFiZWxbc3RhcnQ6ZW5kXQogICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICByZXR1cm4gIiIKCiAgICBkZWYgYWN0aW9uX2Jyb2FkY2FzdF9zZW5zaXRpdml0eShzZWxmLCBldmVudCk6CiAgICAgICAgdmFsdWUgPSBldmVudFsndmFsdWUnXQogICAgICAgIHRocmVzaG9sZCA9IHNlbGYuYWdlbnQucGFyYW1zWydicm9hZGNhc3RfdGhyZXNob2xkJ10udmFsdWUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlucHV0X3ZhbHVlID0gZmxvYXQodmFsdWUpCiAgICAgICAgICAgIHRocmVzaG9sZF92YWx1ZSA9IGZsb2F0KHRocmVzaG9sZCkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoIk5vdCBhIG51bWVyaWNhbCB2YWx1ZSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGlucHV0X3ZhbHVlID49IHRocmVzaG9sZF92YWx1ZSA+PSBUaHJlc2hvbGRzWyJicm9hZGNhc3RfbG93Il06CiAgICAgICAgICAgIHNlbGYuYWN0aW9uX2xvd19zZW5zaXRpdml0eShldmVudCwgaW5wdXRfdmFsdWUpCiAgICAgICAgZWxpZiBUaHJlc2hvbGRzWyJicm9hZGNhc3RfbWVkaXVtIl0gPD0gdGhyZXNob2xkX3ZhbHVlIDwgVGhyZXNob2xkc1siYnJvYWRjYXN0X2xvdyJdIFwKICAgICAgICAgICAgICAgIGFuZCBpbnB1dF92YWx1ZSA+PSB0aHJlc2hvbGRfdmFsdWU6CiAgICAgICAgICAgIHNlbGYuYWN0aW9uX21lZGl1bV9zZW5zaXRpdml0eShldmVudCwgaW5wdXRfdmFsdWUpCiAgICAgICAgZWxpZiBUaHJlc2hvbGRzWyJicm9hZGNhc3RfaGlnaCJdIDw9IHRocmVzaG9sZF92YWx1ZSA8IFRocmVzaG9sZHNbImJyb2FkY2FzdF9tZWRpdW0iXSBcCiAgICAgICAgICAgICAgICBhbmQgaW5wdXRfdmFsdWUgPj0gdGhyZXNob2xkX3ZhbHVlOgogICAgICAgICAgICBzZWxmLmFjdGlvbl9oaWdoX3NlbnNpdGl2aXR5KGV2ZW50LCBpbnB1dF92YWx1ZSkKCiAgICBkZWYgYWN0aW9uX2NsZWFyX2Jyb2FkY2FzdF9zZW5zaXRpdml0eShzZWxmLCBldmVudCk6CiAgICAgICAgdmFsdWUgPSBldmVudFsndmFsdWUnXQogICAgICAgIHRocmVzaG9sZCA9IHNlbGYuYWdlbnQucGFyYW1zWydicm9hZGNhc3RfdGhyZXNob2xkJ10udmFsdWUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlucHV0X3ZhbHVlID0gZmxvYXQodmFsdWUpCiAgICAgICAgICAgIHRocmVzaG9sZF92YWx1ZSA9IGZsb2F0KHRocmVzaG9sZCkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoIk5vdCBhIG51bWVyaWNhbCB2YWx1ZSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGlucHV0X3ZhbHVlIDwgdGhyZXNob2xkX3ZhbHVlOgogICAgICAgICAgICBzZWxmLmNsZWFyX2FsZXJ0X2xldmVsKGV2ZW50KQoKICAgIGRlZiBhY3Rpb25fb3Zlcl9iYW5kd2lkdGhfc2Vuc2l0aXZpdHkoc2VsZiwgZXZlbnQpOgogICAgICAgIHZhbHVlID0gZXZlbnRbJ3ZhbHVlJ10KICAgICAgICB0aHJlc2hvbGQgPSBzZWxmLmFnZW50LnBhcmFtc1sndHhfZHJvcHNfdGhyZXNob2xkJ10udmFsdWUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlucHV0X3ZhbHVlID0gZmxvYXQodmFsdWUpCiAgICAgICAgICAgIHRocmVzaG9sZF92YWx1ZSA9IGZsb2F0KHRocmVzaG9sZCkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoIk5vdCBhIG51bWVyaWNhbCB2YWx1ZSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGlucHV0X3ZhbHVlID09IHNlbGYuSU5GSU5JVFk6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGlucHV0X3ZhbHVlID49IHRocmVzaG9sZF92YWx1ZSA+PSBUaHJlc2hvbGRzWyJ0eF9kcm9wX2xvdyJdOgogICAgICAgICAgICBzZWxmLmFjdGlvbl9sb3dfc2Vuc2l0aXZpdHkoZXZlbnQsIGlucHV0X3ZhbHVlKQogICAgICAgIGVsaWYgVGhyZXNob2xkc1sidHhfZHJvcF9tZWRpdW0iXSA8PSB0aHJlc2hvbGRfdmFsdWUgPCBUaHJlc2hvbGRzWyJ0eF9kcm9wX2xvdyJdIFwKICAgICAgICAgICAgICAgIGFuZCBpbnB1dF92YWx1ZSA+PSB0aHJlc2hvbGRfdmFsdWU6CiAgICAgICAgICAgIHNlbGYuYWN0aW9uX21lZGl1bV9zZW5zaXRpdml0eShldmVudCwgaW5wdXRfdmFsdWUpCiAgICAgICAgZWxpZiBUaHJlc2hvbGRzWyJ0eF9kcm9wX2hpZ2giXSA8PSB0aHJlc2hvbGRfdmFsdWUgPCBUaHJlc2hvbGRzWyJ0eF9kcm9wX21lZGl1bSJdIFwKICAgICAgICAgICAgICAgIGFuZCBpbnB1dF92YWx1ZSA+PSB0aHJlc2hvbGRfdmFsdWU6CiAgICAgICAgICAgIHNlbGYuYWN0aW9uX2hpZ2hfc2Vuc2l0aXZpdHkoZXZlbnQsIGlucHV0X3ZhbHVlKQoKICAgIGRlZiBhY3Rpb25fY2xlYXJfb3Zlcl9iYW5kd2lkdGhfc2Vuc2l0aXZpdHkoc2VsZiwgZXZlbnQpOgogICAgICAgIHZhbHVlID0gZXZlbnRbJ3ZhbHVlJ10KICAgICAgICB0aHJlc2hvbGQgPSBzZWxmLmFnZW50LnBhcmFtc1sndHhfZHJvcHNfdGhyZXNob2xkJ10udmFsdWUKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlucHV0X3ZhbHVlID0gZmxvYXQodmFsdWUpCiAgICAgICAgICAgIHRocmVzaG9sZF92YWx1ZSA9IGZsb2F0KHRocmVzaG9sZCkKICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgcHJpbnQoIk5vdCBhIG51bWVyaWNhbCB2YWx1ZSIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGlmIGlucHV0X3ZhbHVlIDwgdGhyZXNob2xkX3ZhbHVlOgogICAgICAgICAgICBzZWxmLmNsZWFyX2FsZXJ0X2xldmVsKGV2ZW50KQoKICAgIGRlZiBhY3Rpb25faGlnaF9zZW5zaXRpdml0eShzZWxmLCBldmVudCwgdmFsdWUpOgogICAgICAgIGludGVyZmFjZV9pZCA9IHNlbGYuZ2V0X2ludGVyZmFjZShldmVudCkKICAgICAgICBydWxlX2Rlc2NyaXB0aW9uID0gZXZlbnRbJ3J1bGVfZGVzY3JpcHRpb24nXQogICAgICAgIGxpbmtzX3dpdGhfYWxlcnQgPSBzZWxmLmFnZW50LnZhcmlhYmxlc1snbGlua3Nfd2l0aF9hbGVydCddCiAgICAgICAgaWYgKGludGVyZmFjZV9pZCArICc6Jykgbm90IGluIGxpbmtzX3dpdGhfYWxlcnQ6CiAgICAgICAgICAgIHNlbGYuYWRkX2ludGVyZmFjZV90b19hbGVydF9saXN0KGludGVyZmFjZV9pZCkKICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9zeXNsb2coCiAgICAgICAgICAgICd7fSBkZXRlY3RlZCBvbiBpbnRlcmZhY2Uge30gYXQgaGlnaCBzZW5zaXRpdml0eSBsZXZlbDogcmF0ZSBhdCB7fSBwYWNrZXRzL3NlYycuZm9ybWF0KAogICAgICAgICAgICAgICAgcnVsZV9kZXNjcmlwdGlvbiwgaW50ZXJmYWNlX2lkLCB2YWx1ZSkpCiAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fY2xpKCJzaG93IGludGVyZmFjZSB7fSIuZm9ybWF0KAogICAgICAgICAgICBpbnRlcmZhY2VfaWQpKQogICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX2NsaSgKICAgICAgICAgICAgInNob3cgaW50ZXJmYWNlIHt9IGV4dGVuZGVkIi5mb3JtYXQoaW50ZXJmYWNlX2lkKSkKICAgICAgICBzZWxmLmFsbS5wdWJsaXNoX2FsZXJ0X2xldmVsKHNlbGYubmFtZSwgcnVsZV9kZXNjcmlwdGlvbiwgJ01JTk9SJykKCiAgICBkZWYgYWN0aW9uX21lZGl1bV9zZW5zaXRpdml0eShzZWxmLCBldmVudCwgdmFsdWUpOgogICAgICAgIGludGVyZmFjZV9pZCA9IHNlbGYuZ2V0X2ludGVyZmFjZShldmVudCkKICAgICAgICBydWxlX2Rlc2NyaXB0aW9uID0gZXZlbnRbJ3J1bGVfZGVzY3JpcHRpb24nXQogICAgICAgIGxpbmtzX3dpdGhfYWxlcnQgPSBzZWxmLmFnZW50LnZhcmlhYmxlc1snbGlua3Nfd2l0aF9hbGVydCddCiAgICAgICAgaWYgKGludGVyZmFjZV9pZCArICc6Jykgbm90IGluIGxpbmtzX3dpdGhfYWxlcnQ6CiAgICAgICAgICAgIHNlbGYuYWRkX2ludGVyZmFjZV90b19hbGVydF9saXN0KGludGVyZmFjZV9pZCkKICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9zeXNsb2coCiAgICAgICAgICAgICd7fSBkZXRlY3RlZCBvbiBpbnRlcmZhY2Uge30gYXQgbWVkaXVtIHNlbnNpdGl2aXR5IGxldmVsOiByYXRlIGF0IHt9IHBhY2tldHMvc2VjJy5mb3JtYXQoCiAgICAgICAgICAgICAgICBydWxlX2Rlc2NyaXB0aW9uLCBpbnRlcmZhY2VfaWQsIHZhbHVlKSkKICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9jbGkoInNob3cgaW50ZXJmYWNlIHt9Ii5mb3JtYXQoCiAgICAgICAgICAgIGludGVyZmFjZV9pZCkpCiAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fY2xpKAogICAgICAgICAgICAic2hvdyBpbnRlcmZhY2Uge30gZXh0ZW5kZWQiLmZvcm1hdChpbnRlcmZhY2VfaWQpKQogICAgICAgIHNlbGYuYWxtLnB1Ymxpc2hfYWxlcnRfbGV2ZWwoc2VsZi5uYW1lLCBydWxlX2Rlc2NyaXB0aW9uLCAnTUFKT1InKQoKICAgIGRlZiBhY3Rpb25fbG93X3NlbnNpdGl2aXR5KHNlbGYsIGV2ZW50LCB2YWx1ZSk6CiAgICAgICAgaW50ZXJmYWNlX2lkID0gc2VsZi5nZXRfaW50ZXJmYWNlKGV2ZW50KQogICAgICAgIHJ1bGVfZGVzY3JpcHRpb24gPSBldmVudFsncnVsZV9kZXNjcmlwdGlvbiddCiAgICAgICAgbGlua3Nfd2l0aF9hbGVydCA9IHNlbGYuYWdlbnQudmFyaWFibGVzWydsaW5rc193aXRoX2FsZXJ0J10KICAgICAgICBpZiAoaW50ZXJmYWNlX2lkICsgJzonKSBub3QgaW4gbGlua3Nfd2l0aF9hbGVydDoKICAgICAgICAgICAgc2VsZi5hZGRfaW50ZXJmYWNlX3RvX2FsZXJ0X2xpc3QoaW50ZXJmYWNlX2lkKQogICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX3N5c2xvZygKICAgICAgICAgICAgJ3t9IGRldGVjdGVkIG9uIGludGVyZmFjZSB7fSBhdCBsb3cgc2Vuc2l0aXZpdHkgbGV2ZWw6IHJhdGUgYXQge30gcGFja2V0cy9zZWMnLmZvcm1hdCgKICAgICAgICAgICAgICAgIHJ1bGVfZGVzY3JpcHRpb24sIGludGVyZmFjZV9pZCwgdmFsdWUpKQogICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX2NsaSgic2hvdyBpbnRlcmZhY2Uge30iLmZvcm1hdCgKICAgICAgICAgICAgaW50ZXJmYWNlX2lkKSkKICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9jbGkoCiAgICAgICAgICAgICJzaG93IGludGVyZmFjZSB7fSBleHRlbmRlZCIuZm9ybWF0KGludGVyZmFjZV9pZCkpCiAgICAgICAgc2VsZi5hbG0ucHVibGlzaF9hbGVydF9sZXZlbChzZWxmLm5hbWUsIHJ1bGVfZGVzY3JpcHRpb24sICdDUklUSUNBTCcpCgogICAgZGVmIGNsZWFyX2FsZXJ0X2xldmVsKHNlbGYsIGV2ZW50KToKICAgICAgICBpbnRlcmZhY2VfaWQgPSBzZWxmLmdldF9pbnRlcmZhY2UoZXZlbnQpCiAgICAgICAgcnVsZV9kZXNjcmlwdGlvbiA9IGV2ZW50WydydWxlX2Rlc2NyaXB0aW9uJ10KICAgICAgICBsaW5rc193aXRoX2FsZXJ0ID0gc2VsZi5hZ2VudC52YXJpYWJsZXNbJ2xpbmtzX3dpdGhfYWxlcnQnXQogICAgICAgIGludGVyZmFjZSA9IGludGVyZmFjZV9pZCArICc6JwogICAgICAgIGlmIGludGVyZmFjZSBpbiBsaW5rc193aXRoX2FsZXJ0OgogICAgICAgICAgICBzZWxmLmFnZW50LmFjdGlvbl9zeXNsb2coCiAgICAgICAgICAgICAgICAne30gb24gaW50ZXJmYWNlIHt9IGlzIGJhY2sgdG8gbm9ybWFsJy5mb3JtYXQoCiAgICAgICAgICAgICAgICAgICAgcnVsZV9kZXNjcmlwdGlvbiwgaW50ZXJmYWNlX2lkKSkKICAgICAgICAgICAgc2VsZi5hbG0ucHVibGlzaF9hbGVydF9sZXZlbCgKICAgICAgICAgICAgICAgIHNlbGYubmFtZSwgcnVsZV9kZXNjcmlwdGlvbiwgJ05PTkUnKQoKICAgIGRlZiBhZGRfaW50ZXJmYWNlX3RvX2FsZXJ0X2xpc3Qoc2VsZiwgaW50ZXJmYWNlX2lkKToKICAgICAgICBsaW5rc193aXRoX2FsZXJ0ID0gc2VsZi5hZ2VudC52YXJpYWJsZXNbJ2xpbmtzX3dpdGhfYWxlcnQnXSArIFwKICAgICAgICAgICAgaW50ZXJmYWNlX2lkICsgJzonCiAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ2xpbmtzX3dpdGhfYWxlcnQnXSA9IGxpbmtzX3dpdGhfYWxlcnQKCgpjbGFzcyBWU1hIZWFsdGg6CiAgICBkZWYgX19pbml0X18oc2VsZiwgYWdlbnQsIGFsbSk6CiAgICAgICAgc2VsZi5uYW1lID0gc2VsZi5fX2NsYXNzX18uX19uYW1lX18KICAgICAgICBzZWxmLmFnZW50ID0gYWdlbnQKICAgICAgICBzZWxmLmFsbSA9IGFsbQogICAgICAgIHNlbGYubW9uaXRvcnMgPSB7fQogICAgICAgIHNlbGYucnVsZXMgPSB7fQogICAgICAgIHNlbGYuZ3JhcGhzID0ge30KCiAgICAgICAgc2VsZi5WU1hfUEVFUiA9ICcvdnN4LXBlZXInCiAgICAgICAgc2VsZi5SRVNPVVJDRV9VUklfTUFQID0gewogICAgICAgICAgICAncm91dGVzJzogJy9yZXN0L3YxL3N5c3RlbS92cmZzLyovcm91dGVzP2NvdW50JywKICAgICAgICAgICAgJ25laWdoYm9ycyc6ICcvcmVzdC92MS9zeXN0ZW0vdnJmcy8qL25laWdoYm9ycz9jb3VudCcsCiAgICAgICAgICAgICdtYWNfYWRkcmVzc2VzJzogJy9yZXN0L3YxL3N5c3RlbS92bGFucy8qL21hY3M/Y291bnQmZmlsdGVyPXNlbGVjdGVkOnRydWUnfQogICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydyb3V0ZXNfcmF0aW8nXSA9ICdOb3JtYWwnCiAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ25laWdoYm9yc19yYXRpbyddID0gJ05vcm1hbCcKICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1snbWFjX2FkZHJlc3Nlc19yYXRpbyddID0gJ05vcm1hbCcKCiAgICBkZWYgY3JlYXRlX21vbml0b3JzKHNlbGYpOgogICAgICAgIGZvciBtb24gaW4gc2VsZi5SRVNPVVJDRV9VUklfTUFQOgogICAgICAgICAgICB1cmkgPSBzZWxmLlJFU09VUkNFX1VSSV9NQVBbbW9uXQogICAgICAgICAgICBzd2l0Y2hfdmFyID0gbW9uICsgJ19zd2l0Y2gnCiAgICAgICAgICAgIHZzeF92YXIgPSBtb24gKyAnX3ZzeCcKICAgICAgICAgICAgc2VsZi5tb25pdG9yc1tzd2l0Y2hfdmFyXSA9IE1vbml0b3IoCiAgICAgICAgICAgICAgICBTdW0odXJpKSwgJ3t9IGNvdW50IG1vbml0b3InLmZvcm1hdChtb24pKQogICAgICAgICAgICBzZWxmLm1vbml0b3JzW3ZzeF92YXJdID0gTW9uaXRvcigKICAgICAgICAgICAgICAgIFN1bShzZWxmLlZTWF9QRUVSICsgdXJpKSwgJ3t9IGNvdW50IG9uIFZTWCBwZWVyJyAnIG1vbml0b3InLmZvcm1hdChtb24pKQogICAgICAgIHJldHVybiBsaXN0KHNlbGYubW9uaXRvcnMudmFsdWVzKCkpCgogICAgZGVmIGNyZWF0ZV9ydWxlcyhzZWxmKToKICAgICAgICBmb3IgcnVsZSBpbiBzZWxmLlJFU09VUkNFX1VSSV9NQVA6CiAgICAgICAgICAgIHN3aXRjaF92YXIgPSBydWxlICsgJ19zd2l0Y2gnCiAgICAgICAgICAgIHZzeF92YXIgPSBydWxlICsgJ192c3gnCiAgICAgICAgICAgIHN3aXRjaF9tb25pdG9yID0gc2VsZi5tb25pdG9yc1tzd2l0Y2hfdmFyXQogICAgICAgICAgICB2c3hfcGVlcl9tb25pdG9yID0gc2VsZi5tb25pdG9yc1t2c3hfdmFyXQogICAgICAgICAgICB1cHBlcl90aHJlc2hvbGRfcnVsZSA9ICd1cHBlcl90aHJlc2hvbGRfcnVsZScgKyBydWxlCiAgICAgICAgICAgICMgQ2FsY3VsYXRlIHRoZSBhbGxvd2VkIGRldmlhdGlvbiByYW5nZS4KICAgICAgICAgICAgbG93ZXJfa2V5ID0gJ3t9X2NvdW50X3JhdGlvX2xvd2VyX3RocmVzaG9sZCcuZm9ybWF0KHJ1bGUpCiAgICAgICAgICAgIHVwcGVyX2tleSA9ICd7fV9jb3VudF9yYXRpb191cHBlcl90aHJlc2hvbGQnLmZvcm1hdChydWxlKQogICAgICAgICAgICBzZWxmLnJ1bGVzW3VwcGVyX3RocmVzaG9sZF9ydWxlXSA9IFJ1bGUoCiAgICAgICAgICAgICAgICAnUmF0aW8gb2Yge30gb24gdGhlIHN3aXRjaCB0byBWU1gnCiAgICAgICAgICAgICAgICAnLXBlZXIgcnVsZScuZm9ybWF0KHJ1bGUpKQogICAgICAgICAgICBzZWxmLnJ1bGVzW3VwcGVyX3RocmVzaG9sZF9ydWxlXS5jb25kaXRpb24oCiAgICAgICAgICAgICAgICAncmF0aW8gb2Yge30gYW5kIHt9ID4ge30nLAogICAgICAgICAgICAgICAgW3N3aXRjaF9tb25pdG9yLCB2c3hfcGVlcl9tb25pdG9yLCBzZWxmLmFnZW50LnBhcmFtc1t1cHBlcl9rZXldXSkKCiAgICAgICAgICAgIHNlbGYucnVsZXNbdXBwZXJfdGhyZXNob2xkX3J1bGVdLmFjdGlvbihzZWxmLmNyaXRpY2FsX2FjdGlvbikKICAgICAgICAgICAgc2VsZi5ydWxlc1t1cHBlcl90aHJlc2hvbGRfcnVsZV0uY2xlYXJfY29uZGl0aW9uKAogICAgICAgICAgICAgICAgJ3JhdGlvIG9mIHt9IGFuZCB7fSA8IHt9JywKICAgICAgICAgICAgICAgIFtzd2l0Y2hfbW9uaXRvciwgdnN4X3BlZXJfbW9uaXRvciwgc2VsZi5hZ2VudC5wYXJhbXNbdXBwZXJfa2V5XV0pCgogICAgICAgICAgICBzZWxmLnJ1bGVzW3VwcGVyX3RocmVzaG9sZF9ydWxlXS5jbGVhcl9hY3Rpb24oc2VsZi5ub3JtYWxfYWN0aW9uKQoKICAgICAgICAgICAgIyBSdWxlIHRvIGFsZXJ0IGlmIHRoZSBOQUUgTW9uaXRvciB2YWx1ZSBnb2VzIGJlbG93IHRoZSBsb3dlcgogICAgICAgICAgICAjIHRocmVzaG9sZCB2YWx1ZQogICAgICAgICAgICBsb3dlcl90aHJlc2hvbGRfcnVsZSA9ICdsb3dlcl90aHJlc2hvbGRfcnVsZScgKyBydWxlCiAgICAgICAgICAgIHNlbGYucnVsZXNbbG93ZXJfdGhyZXNob2xkX3J1bGVdID0gUnVsZSgKICAgICAgICAgICAgICAgICdSYXRpbyBvZiB7fSBvbiB0aGUgc3dpdGNoIHRvIFZTWCcKICAgICAgICAgICAgICAgICctcGVlciBydWxlJy5mb3JtYXQocnVsZSkpCiAgICAgICAgICAgIHNlbGYucnVsZXNbbG93ZXJfdGhyZXNob2xkX3J1bGVdLmNvbmRpdGlvbigKICAgICAgICAgICAgICAgICdyYXRpbyBvZiB7fSBhbmQge30gPCB7fScsCiAgICAgICAgICAgICAgICBbc3dpdGNoX21vbml0b3IsIHZzeF9wZWVyX21vbml0b3IsIHNlbGYuYWdlbnQucGFyYW1zW2xvd2VyX2tleV1dKQogICAgICAgICAgICBzZWxmLnJ1bGVzW2xvd2VyX3RocmVzaG9sZF9ydWxlXS5hY3Rpb24oc2VsZi5jcml0aWNhbF9hY3Rpb24pCiAgICAgICAgICAgIHNlbGYucnVsZXNbbG93ZXJfdGhyZXNob2xkX3J1bGVdLmNsZWFyX2NvbmRpdGlvbigKICAgICAgICAgICAgICAgICdyYXRpbyBvZiB7fSBhbmQge30gPiB7fScsCiAgICAgICAgICAgICAgICBbc3dpdGNoX21vbml0b3IsIHZzeF9wZWVyX21vbml0b3IsIHNlbGYuYWdlbnQucGFyYW1zW2xvd2VyX2tleV1dKQogICAgICAgICAgICBzZWxmLnJ1bGVzW2xvd2VyX3RocmVzaG9sZF9ydWxlXS5jbGVhcl9hY3Rpb24oc2VsZi5ub3JtYWxfYWN0aW9uKQogICAgICAgIHJldHVybiBsaXN0KHNlbGYucnVsZXMudmFsdWVzKCkpCgogICAgZGVmIGNyZWF0ZV9ncmFwaHMoc2VsZik6CiAgICAgICAgc2VsZi5ncmFwaHNbJ3ZzeF9tb25pdG9yJ10gPSBcCiAgICAgICAgICAgIEdyYXBoKFt2YWwgZm9yIHZhbCBpbiBzZWxmLm1vbml0b3JzLnZhbHVlcygpXSwKICAgICAgICAgICAgICAgICAgdGl0bGU9VGl0bGUoIlZTWCBIZWFsdGggTW9uaXRvciIpLAogICAgICAgICAgICAgICAgICBkYXNoYm9hcmRfZGlzcGxheT1GYWxzZSkKICAgICAgICByZXR1cm4gbGlzdChzZWxmLmdyYXBocy52YWx1ZXMoKSkKCiAgICBkZWYgcmVzdF9nZXQoc2VsZiwgdXJsKToKICAgICAgICByZXR1cm4gZ2V0KEhUVFBfQUREUkVTUyArIHVybCwgdmVyaWZ5PUZhbHNlLAogICAgICAgICAgICAgICAgICAgcHJveGllcz17J2h0dHAnOiBOb25lLCAnaHR0cHMnOiBOb25lfSkKCiAgICBkZWYgY3JpdGljYWxfYWN0aW9uKHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLnByb2Nlc3NfZXZlbnQoZXZlbnQsIEFsZXJ0TGV2ZWwuQ1JJVElDQUwpCgogICAgZGVmIG5vcm1hbF9hY3Rpb24oc2VsZiwgZXZlbnQpOgogICAgICAgIHNlbGYucHJvY2Vzc19ldmVudChldmVudCwgJ05vcm1hbCcpCgogICAgZGVmIHByb2Nlc3NfZXZlbnQoc2VsZiwgZXZlbnQsIGFsZXJ0X2xldmVsKToKICAgICAgICBydWxlX2Rlc2NyaXB0aW9uID0gZXZlbnRbJ3J1bGVfZGVzY3JpcHRpb24nXQogICAgICAgIGlmICdtYWNfYWRkcmVzc2VzJyBpbiBydWxlX2Rlc2NyaXB0aW9uOgogICAgICAgICAgICByZXNvdXJjZSA9ICdtYWNfYWRkcmVzc2VzJwogICAgICAgIGVsaWYgJ25laWdoYm9ycycgaW4gcnVsZV9kZXNjcmlwdGlvbjoKICAgICAgICAgICAgcmVzb3VyY2UgPSAnbmVpZ2hib3JzJwogICAgICAgIGVsaWYgJ3JvdXRlcycgaW4gcnVsZV9kZXNjcmlwdGlvbjoKICAgICAgICAgICAgcmVzb3VyY2UgPSAncm91dGVzJwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmVycm9yKAogICAgICAgICAgICAgICAgIkVycm9yIHdoaWxlIGdldHRpbmcgcmVzb3VyY2UgbmFtZSBmcm9tIGV2ZW50IikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGNvdW50X3ZhbHVlcyA9IHNlbGYuZ2V0X2NvdW50X3ZhbHVlcyhyZXNvdXJjZSkKCiAgICAgICAgaWYgKCdjb3VudCcgaW4gY291bnRfdmFsdWVzKSBhbmQgKCd2c3gtcGVlci1jb3VudCcgaW4gY291bnRfdmFsdWVzKToKICAgICAgICAgICAgcmF0aW8gPSAoY291bnRfdmFsdWVzWydjb3VudCddIC8gY291bnRfdmFsdWVzWyd2c3gtcGVlci1jb3VudCddKQogICAgICAgIGVsaWYgKCdjb3VudCcgbm90IGluIGNvdW50X3ZhbHVlcykgYW5kICgndnN4LXBlZXItY291bnQnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluIGNvdW50X3ZhbHVlcyk6CiAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmVycm9yKAogICAgICAgICAgICAgICAgJ0NvdWxkIG5vdCBnZXQge30gY291bnQgb24gdGhlIHN3aXRjaCcuZm9ybWF0KHJlc291cmNlKSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZWxpZiAoJ3ZzeC1wZWVyLWNvdW50JyBub3QgaW4gY291bnRfdmFsdWVzKSBhbmQgKAogICAgICAgICAgICAgICAgJ2NvdW50JyBpbiBjb3VudF92YWx1ZXMpOgogICAgICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5lcnJvcigKICAgICAgICAgICAgICAgICdDb3VsZCBub3QgZ2V0IHt9IGNvdW50IG9uIHRoZSBWU1gtcGVlcicKICAgICAgICAgICAgICAgICcgc3dpdGNoJy5mb3JtYXQocmVzb3VyY2UpKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5lcnJvcigKICAgICAgICAgICAgICAgICdDb3VsZCBub3QgZ2V0IHt9IGNvdW50IG9uIGJvdGgsIHRoZSBzd2l0Y2ggYW5kIG9uIHRoZScKICAgICAgICAgICAgICAgICdWU1gtcGVlciBzd2l0Y2gnLmZvcm1hdChyZXNvdXJjZSkpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB2YWxpZF9hbGVydCA9IHNlbGYudmFsaWRhdGVfYWxlcnQoCiAgICAgICAgICAgIHJhdGlvLCByZXNvdXJjZSwgYWxlcnRfbGV2ZWwpCgogICAgICAgIGlmIG5vdCB2YWxpZF9hbGVydDoKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHNlbGYudXBkYXRlX3ZhcmlhYmxlcyhyZXNvdXJjZSwgYWxlcnRfbGV2ZWwpCiAgICAgICAgc2VsZi5nZW5lcmF0ZV9hbGVydF9tZXNzYWdlKAogICAgICAgICAgICByZXNvdXJjZSwgcmF0aW8sIGNvdW50X3ZhbHVlcykKICAgICAgICBzZWxmLnVwZGF0ZV9hbGVydF9sZXZlbChydWxlX2Rlc2NyaXB0aW9uKQoKICAgIGRlZiB2YWxpZGF0ZV9hbGVydChzZWxmLCByYXRpbywgcmVzb3VyY2UsIGFsZXJ0X2xldmVsKToKCiAgICAgICAgdmFyaWFibGVfbWFwX2tleSA9ICd7fV9yYXRpbycuZm9ybWF0KHJlc291cmNlKQogICAgICAgIGlmIHZhcmlhYmxlX21hcF9rZXkgaW4gc2VsZi5hZ2VudC52YXJpYWJsZXM6CiAgICAgICAgICAgIGlmIHNlbGYuYWdlbnQudmFyaWFibGVzW3ZhcmlhYmxlX21hcF9rZXldID09IGFsZXJ0X2xldmVsOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZXJyb3IoCiAgICAgICAgICAgICAgICAnVW5hYmxlIHRvIGFjY2VzcyBOQUUgdmFyaWFibGUgY29udGFpbmluZyBhbGVydCBzdGF0dXMnCiAgICAgICAgICAgICAgICAnZm9yIHJlc291cmNlIHt9Jy5mb3JtYXQocmVzb3VyY2UpKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAga2V5ID0gJ3t9X2NvdW50X3JhdGlvX3VwcGVyX3RocmVzaG9sZCcuZm9ybWF0KHJlc291cmNlKQoKICAgICAgICBpZiBrZXkgaW4gc2VsZi5hZ2VudC5wYXJhbXM6CiAgICAgICAgICAgIHVwcGVyX3RocmVzaG9sZF92YWx1ZSA9IGZsb2F0KHNlbGYuYWdlbnQucGFyYW1zW2tleV0udmFsdWUpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZXJyb3IoIkVycm9yIHdoaWxlIGdldHRpbmcgdXBwZXIiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0aHJlc2hvbGQgZm9yIHt9IGNvdW50Ii5mb3JtYXQocmVzb3VyY2UpKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAga2V5ID0gJ3t9X2NvdW50X3JhdGlvX2xvd2VyX3RocmVzaG9sZCcuZm9ybWF0KHJlc291cmNlKQogICAgICAgIGlmIGtleSBpbiBzZWxmLmFnZW50LnBhcmFtczoKICAgICAgICAgICAgbG93ZXJfdGhyZXNob2xkX3ZhbHVlID0gZmxvYXQoc2VsZi5hZ2VudC5wYXJhbXNba2V5XS52YWx1ZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5lcnJvcigiRXJyb3Igd2hpbGUgZ2V0dGluZyBsb3dlciIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInRocmVzaG9sZCBmb3Ige30gY291bnQiLmZvcm1hdChyZXNvdXJjZSkpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBpZiAoYWxlcnRfbGV2ZWwgPT0gQWxlcnRMZXZlbC5DUklUSUNBTCkgYW5kICgKICAgICAgICAgICAgICAgIChyYXRpbyA+IHVwcGVyX3RocmVzaG9sZF92YWx1ZSkgb3IgKAogICAgICAgICAgICAgICAgICAgIHJhdGlvIDwgbG93ZXJfdGhyZXNob2xkX3ZhbHVlKSk6CiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZWxpZiAoYWxlcnRfbGV2ZWwgPT0gJ05vcm1hbCcpIGFuZCAoKHJhdGlvIDwgdXBwZXJfdGhyZXNob2xkX3ZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZCAocmF0aW8gPiBsb3dlcl90aHJlc2hvbGRfdmFsdWUpKToKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgdXBkYXRlX3ZhcmlhYmxlcyhzZWxmLCByZXNvdXJjZSwgYWxlcnRfbGV2ZWwpOgogICAgICAgIGlmIGFsZXJ0X2xldmVsID09IEFsZXJ0TGV2ZWwuQ1JJVElDQUw6CiAgICAgICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWyd7fV9yYXRpbycuZm9ybWF0KAogICAgICAgICAgICAgICAgcmVzb3VyY2UpXSA9IEFsZXJ0TGV2ZWwuQ1JJVElDQUwKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLmFnZW50LnZhcmlhYmxlc1sne31fcmF0aW8nLmZvcm1hdChyZXNvdXJjZSldID0gJ05vcm1hbCcKCiAgICBkZWYgZ2VuZXJhdGVfYWxlcnRfbWVzc2FnZShzZWxmLCByZXNvdXJjZSwgcmF0aW8sIGNvdW50X3ZhbHVlcyk6CiAgICAgICAgdmFyaWFibGVfbWFwX2tleSA9ICd7fV9yYXRpbycuZm9ybWF0KHJlc291cmNlKQogICAgICAgIGlmIHZhcmlhYmxlX21hcF9rZXkgaW4gc2VsZi5hZ2VudC52YXJpYWJsZXM6CiAgICAgICAgICAgIGlmIHNlbGYuYWdlbnQudmFyaWFibGVzW3ZhcmlhYmxlX21hcF9rZXldID09IEFsZXJ0TGV2ZWwuQ1JJVElDQUw6CiAgICAgICAgICAgICAgICByYW5nZV9wb3NpdGlvbiA9ICdvdXRzaWRlJwogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmFuZ2VfcG9zaXRpb24gPSAnaW5zaWRlJwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmVycm9yKAogICAgICAgICAgICAgICAgJ1VuYWJsZSB0byBhY2Nlc3MgTkFFIHZhcmlhYmxlIGNvbnRhaW5pbmcgYWxlcnQgc3RhdHVzJwogICAgICAgICAgICAgICAgJ2ZvciByZXNvdXJjZSB7fScuZm9ybWF0KHJlc291cmNlKSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgaWYgcmVzb3VyY2UgPT0gJ21hY19hZGRyZXNzZXMnOgogICAgICAgICAgICByZXNvdXJjZSA9ICdNQUMgYWRkcmVzc2VzJwoKICAgICAgICByYXRpb192YWx1ZSA9ICcgVGhlIHJhdGlvIG9mIHt9IGNvdW50IG9uIHRoZSBzd2l0Y2ggdG8gdGhlICcgXAogICAgICAgICAgICAne30gY291bnQgb24gdGhlIFZTWC1wZWVyICcgXAogICAgICAgICAgICAnaXMgezouM2Z9IHdoaWNoIGlzIHt9IHRoZSBhbGxvd2VkIGRldmlhdGlvbiAnLmZvcm1hdCgKICAgICAgICAgICAgICAgIHJlc291cmNlLCByZXNvdXJjZSwgcmF0aW8sIHJhbmdlX3Bvc2l0aW9uKQogICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmluZm8ocmF0aW9fdmFsdWUpCgogICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX2N1c3RvbV9yZXBvcnQocmF0aW9fdmFsdWUpCgogICAgICAgIHN3aXRjaF9jb3VudCA9ICdUaGUgY291bnQgb2Yge30gb24gdGhlIHN3aXRjaCBpcyB7fScuZm9ybWF0KAogICAgICAgICAgICByZXNvdXJjZSwgY291bnRfdmFsdWVzWydjb3VudCddKQogICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmluZm8oc3dpdGNoX2NvdW50KQogICAgICAgIHNlbGYuYWdlbnQuYWN0aW9uX2N1c3RvbV9yZXBvcnQoc3dpdGNoX2NvdW50KQoKICAgICAgICB2c3hfcGVlcl9jb3VudCA9ICdUaGUgY291bnQgb2Yge30gb24gdGhlIFZTWC1wZWVyIHN3aXRjaCBpcyB7fScuZm9ybWF0KAogICAgICAgICAgICByZXNvdXJjZSwgY291bnRfdmFsdWVzWyd2c3gtcGVlci1jb3VudCddKQogICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmluZm8odnN4X3BlZXJfY291bnQpCiAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fY3VzdG9tX3JlcG9ydCh2c3hfcGVlcl9jb3VudCkKCiAgICAgICAgc2VsZi5hZ2VudC5hY3Rpb25fY2xpKCdzaG93IHZzeCBicmllZicpCgogICAgZGVmIHVwZGF0ZV9hbGVydF9sZXZlbChzZWxmLCBydWxlX2Rlc2NyaXB0aW9uKToKICAgICAgICAiIiIKICAgICAgICBVcGRhdGVzIHRoZSBOQUUgQWdlbnQgYWxlcnQgbGV2ZWwgYmFzZWQgb24gdGhlIHN0YXR1cyBvZiB0aGUgTkFFIFJ1bGVzCiAgICAgICAgZm9yIHJvdXRlcyBjb3VudCwgbmVpZ2hib3JzIGNvdW50IGFuZCBNQUMgYWRkcmVzc2VzIGNvdW50LgogICAgICAgICIiIgogICAgICAgIHJvdXRlc19yYXRpbyA9IHNlbGYuYWdlbnQudmFyaWFibGVzWydyb3V0ZXNfcmF0aW8nXQogICAgICAgIG5laWdoYm9yc19yYXRpbyA9IHNlbGYuYWdlbnQudmFyaWFibGVzWyduZWlnaGJvcnNfcmF0aW8nXQogICAgICAgIG1hY19hZGRyZXNzZXNfcmF0aW8gPSBzZWxmLmFnZW50LnZhcmlhYmxlc1snbWFjX2FkZHJlc3Nlc19yYXRpbyddCgogICAgICAgIGlmIChuZWlnaGJvcnNfcmF0aW8gPT0gQWxlcnRMZXZlbC5DUklUSUNBTCBvciBtYWNfYWRkcmVzc2VzX3JhdGlvID09CiAgICAgICAgICAgICAgICBBbGVydExldmVsLkNSSVRJQ0FMKSBhbmQgKHNlbGYuYWdlbnQuZ2V0X2FsZXJ0X2xldmVsKCkgIT0gQWxlcnRMZXZlbC5DUklUSUNBTCk6CiAgICAgICAgICAgIHNlbGYuYWxtLnB1Ymxpc2hfYWxlcnRfbGV2ZWwoCiAgICAgICAgICAgICAgICBzZWxmLm5hbWUsIHJ1bGVfZGVzY3JpcHRpb24sICdDUklUSUNBTCcpCiAgICAgICAgZWxpZiAobmVpZ2hib3JzX3JhdGlvID09ICdOb3JtYWwnIGFuZCBtYWNfYWRkcmVzc2VzX3JhdGlvID09ICdOb3JtYWwnCiAgICAgICAgICAgICAgYW5kIHJvdXRlc19yYXRpbyA9PSBBbGVydExldmVsLkNSSVRJQ0FMKSBhbmQgXAogICAgICAgICAgICAgICAgKHNlbGYuYWdlbnQuZ2V0X2FsZXJ0X2xldmVsKCkgIT0gQWxlcnRMZXZlbC5DUklUSUNBTCk6CiAgICAgICAgICAgIHNlbGYuYWxtLnB1Ymxpc2hfYWxlcnRfbGV2ZWwoc2VsZi5uYW1lLCBydWxlX2Rlc2NyaXB0aW9uLCAnTUlOT1InKQogICAgICAgIGVsaWYgKG5laWdoYm9yc19yYXRpbyA9PSAnTm9ybWFsJyBhbmQgbWFjX2FkZHJlc3Nlc19yYXRpbyA9PSAnTm9ybWFsJwogICAgICAgICAgICAgIGFuZCByb3V0ZXNfcmF0aW8gPT0gJ05vcm1hbCcpOgogICAgICAgICAgICBzZWxmLmFnZW50LnJlbW92ZV9hbGVydF9sZXZlbCgpCiAgICAgICAgZWxpZiAocm91dGVzX3JhdGlvID09ICdOb3JtYWwnIG9yIG1hY19hZGRyZXNzZXNfcmF0aW8gPT0gJ05vcm1hbCcpIGFuZCBcCiAgICAgICAgICAgICAgICAoc2VsZi5hZ2VudC5nZXRfYWxlcnRfbGV2ZWwoKSA9PSBBbGVydExldmVsLkNSSVRJQ0FMKToKICAgICAgICAgICAgc2VsZi5hbG0ucHVibGlzaF9hbGVydF9sZXZlbCgKICAgICAgICAgICAgICAgIHNlbGYubmFtZSwgcnVsZV9kZXNjcmlwdGlvbiwgJ05vcm1hbCcpCgogICAgZGVmIGdldF9jb3VudF92YWx1ZXMoc2VsZiwgcmVzb3VyY2UpOgogICAgICAgICIiIgogICAgICAgIEdldCB0aGUgY291bnQgdmFsdWVzIGZvciB0aGUgcmVzb3VyY2Ugb24gdGhlIHN3aXRjaCBhbmQgdGhlIFZTWC1wZWVyCiAgICAgICAgOnBhcmFtIHJlc291cmNlOiBSZXNvdXJjZSBmb3Igd2hpY2ggdGhlIGNvdW50IHZhbHVlcyBuZWVkIHRvIGJlCiAgICAgICAgb2J0YWluZWQuCiAgICAgICAgIiIiCiAgICAgICAgY291bnRfdmFsdWVzID0ge30KICAgICAgICByZXN0X3VyaSA9IHNlbGYuUkVTT1VSQ0VfVVJJX01BUFtyZXNvdXJjZV0KICAgICAgICB2c3hfcmVzdF91cmkgPSBzZWxmLlZTWF9QRUVSICsgcmVzdF91cmkKICAgICAgICB0cnk6CiAgICAgICAgICAgIHIgPSBzZWxmLnJlc3RfZ2V0KHJlc3RfdXJpKQogICAgICAgICAgICByLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICBjb3VudCA9IHIuanNvbigpWyJjb3VudCJdCiAgICAgICAgICAgIGNvdW50X3ZhbHVlc1siY291bnQiXSA9IGNvdW50CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5kZWJ1ZygiRXJyb3Igd2hpbGUgbWFraW5nIFJFU1QgY2FsbCB0byBVUkkgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAie30gOiB7fSIuZm9ybWF0KHJlc3RfdXJpLCBzdHIoZSkpKQogICAgICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5lcnJvcigiRXJyb3Igd2hpbGUgbWFraW5nIFJFU1QgY2FsbCB0byBVUkkgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAie30iLmZvcm1hdChyZXN0X3VyaSkpCgogICAgICAgIHRyeToKICAgICAgICAgICAgciA9IHNlbGYucmVzdF9nZXQodnN4X3Jlc3RfdXJpKQogICAgICAgICAgICByLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICBjb3VudCA9IHIuanNvbigpWyJjb3VudCJdCiAgICAgICAgICAgIGNvdW50X3ZhbHVlc1sidnN4LXBlZXItY291bnQiXSA9IGNvdW50CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5kZWJ1ZygiRXJyb3Igd2hpbGUgbWFraW5nIFJFU1QgY2FsbCB0byBVUkkgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAie30gOiB7fSIuZm9ybWF0KHZzeF9yZXN0X3VyaSwgc3RyKGUpKSkKICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZXJyb3IoIkVycm9yIHdoaWxlIG1ha2luZyBSRVNUIGNhbGwgdG8gVVJJICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInt9Ii5mb3JtYXQodnN4X3Jlc3RfdXJpKSkKICAgICAgICByZXR1cm4gY291bnRfdmFsdWVzCgoKY2xhc3MgQWxlcnRNYW5hZ2VyOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGFnZW50KToKICAgICAgICBzZWxmLmFnZW50ID0gYWdlbnQKCiAgICBkZWYgZ2V0X3J1bGVfYWxlcnRfbGV2ZWwoc2VsZiwgbWV0cmljX2Rlc2MsIHJ1bGVfZGVzYyk6CiAgICAgICAgaWYgJ21ldHJpY3MnIG5vdCBpbiBzZWxmLmFnZW50LnZhcmlhYmxlcy5rZXlzKCk6CiAgICAgICAgICAgIHJldHVybiAnTk9ORScKCiAgICAgICAgbWV0cmljcyA9IGRpY3QoYXN0LmxpdGVyYWxfZXZhbChzZWxmLmFnZW50LnZhcmlhYmxlc1snbWV0cmljcyddKSkKCiAgICAgICAgaWYgbWV0cmljX2Rlc2Mgbm90IGluIG1ldHJpY3Mua2V5cygpOgogICAgICAgICAgICByZXR1cm4gJ05PTkUnCgogICAgICAgIGlmIHJ1bGVfZGVzYyBub3QgaW4gbWV0cmljc1ttZXRyaWNfZGVzY10ua2V5cygpOgogICAgICAgICAgICByZXR1cm4gJ05PTkUnCgogICAgICAgIHJldHVybiBtZXRyaWNzW21ldHJpY19kZXNjXVtydWxlX2Rlc2NdCgogICAgZGVmIHB1Ymxpc2hfYWxlcnRfbGV2ZWwoc2VsZiwgbWV0cmljX2Rlc2MsIHJ1bGVfZGVzYywgbGV2ZWwpOgogICAgICAgIGlmICdtZXRyaWNzJyBub3QgaW4gc2VsZi5hZ2VudC52YXJpYWJsZXMua2V5cygpOgogICAgICAgICAgICBtZXRyaWNzID0ge30KICAgICAgICAgICAgc2VsZi5hZ2VudC52YXJpYWJsZXNbJ21ldHJpY3MnXSA9IHN0cihtZXRyaWNzKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG1ldHJpY3MgPSBkaWN0KGFzdC5saXRlcmFsX2V2YWwoc2VsZi5hZ2VudC52YXJpYWJsZXNbJ21ldHJpY3MnXSkpCgogICAgICAgIGlmIG1ldHJpY19kZXNjIG5vdCBpbiBtZXRyaWNzLmtleXMoKToKICAgICAgICAgICAgbWV0cmljc1ttZXRyaWNfZGVzY10gPSB7fQogICAgICAgIG1ldHJpY3NbbWV0cmljX2Rlc2NdW3J1bGVfZGVzY10gPSBsZXZlbAogICAgICAgIHNlbGYuYWdlbnQudmFyaWFibGVzWydtZXRyaWNzJ10gPSBzdHIobWV0cmljcykKICAgICAgICBsZXZlbHMgPSBbXQoKICAgICAgICBpZiBsZXZlbCA9PSAnQ1JJVElDQUwnOgogICAgICAgICAgICBmb3IgbWV0cmljLCBydWxlcyBpbiBtZXRyaWNzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBmb3IgcnVsZSBpbiBydWxlczoKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpICE9IEFsZXJ0TGV2ZWwuQ1JJVElDQUw6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1ldHJpYyA9PSBtZXRyaWNfZGVzYzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKG1ldHJpYyArICIgQ1JJVElDQUwiKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LmxvZ2dlci5kZWJ1ZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzZXR0aW5nIENSSVRJQ0FMIGFsZXJ0IGxldmVsIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5zZXRfYWxlcnRfbGV2ZWwoQWxlcnRMZXZlbC5DUklUSUNBTCkKICAgICAgICBlbGlmIGxldmVsID09ICdNQUpPUic6CiAgICAgICAgICAgIGZvciBtZXRyaWMsIHJ1bGVzIGluIG1ldHJpY3MuaXRlbXMoKToKICAgICAgICAgICAgICAgIGZvciBydWxlIGluIHJ1bGVzOgogICAgICAgICAgICAgICAgICAgIGlmIHJ1bGVzW3J1bGVdID09ICdDUklUSUNBTCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuYWdlbnQuZ2V0X2FsZXJ0X2xldmVsKCkgIT0gQWxlcnRMZXZlbC5DUklUSUNBTDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQuc2V0X2FsZXJ0X2xldmVsKEFsZXJ0TGV2ZWwuQ1JJVElDQUwpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IChzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuQ1JJVElDQUwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuTUFKT1IpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWV0cmljID09IG1ldHJpY19kZXNjOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKG1ldHJpYyArICIgTUFKT1IiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNldHRpbmcgTUFKT1IgYWxlcnQgbGV2ZWwiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5zZXRfYWxlcnRfbGV2ZWwoQWxlcnRMZXZlbC5NQUpPUikKICAgICAgICBlbGlmIGxldmVsID09ICdNSU5PUic6CiAgICAgICAgICAgIGZvciBtZXRyaWMsIHJ1bGVzIGluIG1ldHJpY3MuaXRlbXMoKToKICAgICAgICAgICAgICAgIGZvciBydWxlIGluIHJ1bGVzOgogICAgICAgICAgICAgICAgICAgIGlmIHJ1bGVzW3J1bGVdID09ICdDUklUSUNBTCc6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuYWdlbnQuZ2V0X2FsZXJ0X2xldmVsKCkgIT0gQWxlcnRMZXZlbC5DUklUSUNBTDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQuc2V0X2FsZXJ0X2xldmVsKEFsZXJ0TGV2ZWwuQ1JJVElDQUwpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBydWxlc1tydWxlXSA9PSAnTUFKT1InOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgKHNlbGYuYWdlbnQuZ2V0X2FsZXJ0X2xldmVsKCkgPT0gQWxlcnRMZXZlbC5DUklUSUNBTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIHNlbGYuYWdlbnQuZ2V0X2FsZXJ0X2xldmVsKCkgPT0gQWxlcnRMZXZlbC5NQUpPUik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnNldF9hbGVydF9sZXZlbChBbGVydExldmVsLk1BSk9SKQogICAgICAgICAgICAgICAgICAgIGVsaWYgcnVsZXNbcnVsZV0gPT0gJ01JTk9SJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IChzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuQ1JJVElDQUwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuTUFKT1IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuTUlOT1IpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWV0cmljID09IG1ldHJpY19kZXNjOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQubG9nZ2VyLmRlYnVnKG1ldHJpYyArICIgTUlOT1IiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInNldHRpbmcgTUlOT1IgYWxlcnQgbGV2ZWwiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5zZXRfYWxlcnRfbGV2ZWwoQWxlcnRMZXZlbC5NSU5PUikKICAgICAgICBlbGlmIGxldmVsID09ICdOT05FJzoKICAgICAgICAgICAgZm9yIG1ldHJpYywgcnVsZXMgaW4gbWV0cmljcy5pdGVtcygpOgogICAgICAgICAgICAgICAgZm9yIHJ1bGUgaW4gcnVsZXM6CiAgICAgICAgICAgICAgICAgICAgbGV2ZWxzLmFwcGVuZChydWxlc1tydWxlXSkKICAgICAgICAgICAgICAgICAgICBpZiBydWxlc1tydWxlXSA9PSAnQ1JJVElDQUwnOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpICE9IEFsZXJ0TGV2ZWwuQ1JJVElDQUw6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFnZW50LnNldF9hbGVydF9sZXZlbChBbGVydExldmVsLkNSSVRJQ0FMKQogICAgICAgICAgICAgICAgICAgIGVsaWYgcnVsZXNbcnVsZV0gPT0gJ01BSk9SJzoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IChzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuQ1JJVElDQUwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBzZWxmLmFnZW50LmdldF9hbGVydF9sZXZlbCgpID09IEFsZXJ0TGV2ZWwuTUFKT1IpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5zZXRfYWxlcnRfbGV2ZWwoQWxlcnRMZXZlbC5NQUpPUikKICAgICAgICAgICAgICAgICAgICBlbGlmIHJ1bGVzW3J1bGVdID09ICdNSU5PUic6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCAoc2VsZi5hZ2VudC5nZXRfYWxlcnRfbGV2ZWwoKSA9PSBBbGVydExldmVsLkNSSVRJQ0FMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3Igc2VsZi5hZ2VudC5nZXRfYWxlcnRfbGV2ZWwoKSA9PSBBbGVydExldmVsLk1BSk9SCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3Igc2VsZi5hZ2VudC5nZXRfYWxlcnRfbGV2ZWwoKSA9PSBBbGVydExldmVsLk1JTk9SKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQuc2V0X2FsZXJ0X2xldmVsKEFsZXJ0TGV2ZWwuTUlOT1IpCiAgICAgICAgICAgICMgUmVtb3ZlIGFsZXJ0IGxldmVsIGlmIGFsbCBzdWItc2NyaXB0cyBhcmUgbm9ybWFsCiAgICAgICAgICAgIGlmIGxldmVscy5jb3VudCgnTk9ORScpID09IGxlbihsZXZlbHMpOgogICAgICAgICAgICAgICAgc2VsZi5hZ2VudC5sb2dnZXIuZGVidWcoInJlbW92aW5nIGFsZXJ0IGxldmVsIikKICAgICAgICAgICAgICAgIHNlbGYuYWdlbnQucmVtb3ZlX2FsZXJ0X2xldmVsKCkKCgpjbGFzcyBBZ2VudChOQUUpOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIGFsbSA9IEFsZXJ0TWFuYWdlcihzZWxmKQogICAgICAgIHNlbGYubWFjX2NvdW50ID0gTUFDQ291bnQoc2VsZiwgYWxtKQogICAgICAgIHNlbGYubWFjX2RlY3JlYXNlID0gTUFDRGVjcmVhc2VSYXRlKHNlbGYsIGFsbSkKICAgICAgICBzZWxmLmRhZW1vbl9yZXNvdXJjZSA9IERhZW1vblJlc291cmNlKHNlbGYsIGFsbSkKICAgICAgICBzZWxmLmZhdWx0X2ZpbmRlciA9IEZhdWx0RmluZGVyKHNlbGYsIGFsbSkKICAgICAgICBzZWxmLnZzeF9oZWFsdGggPSBWU1hIZWFsdGgoc2VsZiwgYWxtKQoKICAgICAgICBzZWxmLl9fbWVyZ2Uoc2VsZi5tYWNfY291bnQpCiAgICAgICAgc2VsZi5fX21lcmdlKHNlbGYubWFjX2RlY3JlYXNlKQogICAgICAgIHNlbGYuX19tZXJnZShzZWxmLmRhZW1vbl9yZXNvdXJjZSkKICAgICAgICBzZWxmLl9fbWVyZ2Uoc2VsZi5mYXVsdF9maW5kZXIpCiAgICAgICAgc2VsZi5fX21lcmdlKHNlbGYudnN4X2hlYWx0aCkKCiAgICBkZWYgX19tZXJnZShzZWxmLCBzY3JpcHQpOgogICAgICAgIHNlbGYuX19tZXJnZV9tb25pdG9ycyhzY3JpcHQuY3JlYXRlX21vbml0b3JzKCkpCiAgICAgICAgc2VsZi5fX21lcmdlX3J1bGVzKHNjcmlwdC5jcmVhdGVfcnVsZXMoKSkKICAgICAgICBzZWxmLl9fbWVyZ2VfZ3JhcGhzKHNjcmlwdC5jcmVhdGVfZ3JhcGhzKCkpCgogICAgZGVmIF9fbWVyZ2VfbW9uaXRvcnMoc2VsZiwgbW9uaXRvcnMpOgogICAgICAgIGZvciBpLCBfIGluIGVudW1lcmF0ZShtb25pdG9ycyk6CiAgICAgICAgICAgIGlkID0gdXVpZC51dWlkNCgpLmhleAogICAgICAgICAgICBtb24gPSAnbW9uaXRvcl97fScuZm9ybWF0KGlkKQogICAgICAgICAgICBzZXRhdHRyKHNlbGYsIG1vbiwgbW9uaXRvcnNbaV0pCiAgICAgICAgcmV0dXJuIG1vbml0b3JzCgogICAgZGVmIF9fbWVyZ2VfcnVsZXMoc2VsZiwgcnVsZXMpOgogICAgICAgIGZvciBpLCBfIGluIGVudW1lcmF0ZShydWxlcyk6CiAgICAgICAgICAgIGlkID0gdXVpZC51dWlkNCgpLmhleAogICAgICAgICAgICBydWxlID0gJ3J1bGVfe30nLmZvcm1hdChpZCkKICAgICAgICAgICAgc2V0YXR0cihzZWxmLCBydWxlLCBydWxlc1tpXSkKICAgICAgICByZXR1cm4gcnVsZXMKCiAgICBkZWYgX19tZXJnZV9ncmFwaHMoc2VsZiwgZ3JhcGhzKToKICAgICAgICBmb3IgaSwgXyBpbiBlbnVtZXJhdGUoZ3JhcGhzKToKICAgICAgICAgICAgaWQgPSB1dWlkLnV1aWQ0KCkuaGV4CiAgICAgICAgICAgIGdyYXBoID0gJ2dyYXBoX3t9Jy5mb3JtYXQoaWQpCiAgICAgICAgICAgIHNldGF0dHIoc2VsZiwgZ3JhcGgsIGdyYXBoc1tpXSkKICAgICAgICByZXR1cm4gZ3JhcGhzCgogICAgIyBDbGFzc3dpc2Ugd3JhcHBlciBtZXRob2RzIHRvIHRyaWdnZXIgY2FsbGJhY2sgYWN0aW9ucwogICAgZGVmIGFjdGlvbl9zeXNsb2coc2VsZiwgbWV0cmljX2FyZ3MpOgogICAgICAgIEFjdGlvblN5c2xvZyhtZXRyaWNfYXJncywgc2V2ZXJpdHk9U1lTTE9HX1dBUk5JTkcpCgogICAgZGVmIGFjdGlvbl9jbGkoc2VsZiwgbWV0cmljX2FyZ3MpOgogICAgICAgIEFjdGlvbkNMSShtZXRyaWNfYXJncykKCiAgICBkZWYgYWN0aW9uX2N1c3RvbV9yZXBvcnQoc2VsZiwgbWV0cmljX2FyZ3MpOgogICAgICAgIEFjdGlvbkN1c3RvbVJlcG9ydChtZXRyaWNfYXJncykKCiAgICBkZWYgc2V0X2FsZXJ0X2FjdGlvbihzZWxmLCBldmVudCk6CiAgICAgICAgc2VsZi5tYWNfY291bnQuc2V0X2FsZXJ0X2FjdGlvbihldmVudCkKCiAgICBkZWYgY2xlYXJfYWxlcnRfYWN0aW9uKHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLm1hY19jb3VudC5jbGVhcl9hbGVydF9hY3Rpb24oZXZlbnQpCgogICAgZGVmIGNhbGN1bGF0ZV9kZWNyZWFzZV9yYXRlKHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLm1hY19kZWNyZWFzZS5jYWxjdWxhdGVfZGVjcmVhc2VfcmF0ZShldmVudCkKCiAgICBkZWYgYWN0aW9uX2hpZ2hfY3B1KHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLmRhZW1vbl9yZXNvdXJjZS5hY3Rpb25faGlnaF9jcHUoZXZlbnQpCgogICAgZGVmIGFjdGlvbl9ub3JtYWxfY3B1KHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLmRhZW1vbl9yZXNvdXJjZS5hY3Rpb25fbm9ybWFsX2NwdShldmVudCkKCiAgICBkZWYgYWN0aW9uX2hpZ2hfbWVtb3J5KHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLmRhZW1vbl9yZXNvdXJjZS5hY3Rpb25faGlnaF9tZW1vcnkoZXZlbnQpCgogICAgZGVmIGFjdGlvbl9ub3JtYWxfbWVtb3J5KHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLmRhZW1vbl9yZXNvdXJjZS5hY3Rpb25fbm9ybWFsX21lbW9yeShldmVudCkKCiAgICBkZWYgYWN0aW9uX2Jyb2FkY2FzdF9zZW5zaXRpdml0eShzZWxmLCBldmVudCk6CiAgICAgICAgc2VsZi5mYXVsdF9maW5kZXIuYWN0aW9uX2Jyb2FkY2FzdF9zZW5zaXRpdml0eShldmVudCkKCiAgICBkZWYgYWN0aW9uX2NsZWFyX2Jyb2FkY2FzdF9zZW5zaXRpdml0eShzZWxmLCBldmVudCk6CiAgICAgICAgc2VsZi5mYXVsdF9maW5kZXIuYWN0aW9uX2NsZWFyX2Jyb2FkY2FzdF9zZW5zaXRpdml0eSgKICAgICAgICAgICAgZXZlbnQpCgogICAgZGVmIGFjdGlvbl9vdmVyX2JhbmR3aWR0aF9zZW5zaXRpdml0eShzZWxmLCBldmVudCk6CiAgICAgICAgc2VsZi5mYXVsdF9maW5kZXIuYWN0aW9uX292ZXJfYmFuZHdpZHRoX3NlbnNpdGl2aXR5KGV2ZW50KQoKICAgIGRlZiBhY3Rpb25fY2xlYXJfb3Zlcl9iYW5kd2lkdGhfc2Vuc2l0aXZpdHkoc2VsZiwgZXZlbnQpOgogICAgICAgIHNlbGYuZmF1bHRfZmluZGVyLmFjdGlvbl9jbGVhcl9vdmVyX2JhbmR3aWR0aF9zZW5zaXRpdml0eShldmVudCkKCiAgICBkZWYgY3JpdGljYWxfYWN0aW9uKHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLnZzeF9oZWFsdGguY3JpdGljYWxfYWN0aW9uKGV2ZW50KQoKICAgIGRlZiBub3JtYWxfYWN0aW9uKHNlbGYsIGV2ZW50KToKICAgICAgICBzZWxmLnZzeF9oZWFsdGgubm9ybWFsX2FjdGlvbihldmVudCk=
nae-agent hardware_device_health_monitor Hardware_Device_Health false
nae-agent interface_tx_rx_stats_monitor Interface_Monitor false rx_packets_threshold:MTAwMDA= tx_packets_threshold:MTAwMDA=
nae-agent interface_link_state_monitor Interface_State_Monitor false
nae-agent software_device_health_monitor Software_Device_Health false
